import{_ as n}from"./plugin-vue_export-helper.21dcd24c.js";import{o as s,c as a,e as t}from"./app.c91928b8.js";const e={},p=t(`<h4 id="_1-springboot\u81EA\u52A8\u914D\u7F6E\u7684\u539F\u7406\u521D\u63A2" tabindex="-1"><a class="header-anchor" href="#_1-springboot\u81EA\u52A8\u914D\u7F6E\u7684\u539F\u7406\u521D\u63A2" aria-hidden="true">#</a> 1. springboot\u81EA\u52A8\u914D\u7F6E\u7684\u539F\u7406\u521D\u63A2</h4><p>\u200B\u4EE5\u4E0B\u6CE8\u89E3\u90FD\u5728springboot\u7684\u81EA\u52A8\u5316\u914D\u7F6E\u5305\u4E2D\uFF1Aspring-boot-autoconfigure</p><ol><li><p>springboot\u7A0B\u5E8F\u7684\u5165\u53E3\u662F\u5728\u542F\u52A8\u7C7B\uFF0C\u8BE5\u7C7B\u6709\u4E2A\u5173\u952E\u6CE8\u89E3SpringBootApplication</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@SpringBootConfiguration</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">TypeExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">AutoConfigurationExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootApplication</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u7565\u2026\u2026</span>
<span class="token punctuation">}</span><span class="token class-name">Destruction</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u6253\u5F00SpringBootApplication\u6CE8\u89E3\uFF0C\u4E0A\u9762\u6709\u4E2A\u5173\u952E\u6CE8\u89E3EnableAutoConfiguration</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@AutoConfigurationPackage</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableAutoConfiguration</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u2026\u2026</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>EnableAutoConfiguration\u4E0A\u6709\u4E2A@Import(AutoConfigurationImportSelector.class)\uFF0C\u6CE8\u610FAutoConfigurationImportSelector\uFF0C</p><p>@Import\u4F5C\u7528\u521B\u5EFA\u4E00\u4E2AAutoConfigurationImportSelector\u7684bean\u5BF9\u8C61\uFF0C\u5E76\u4E14\u52A0\u5165IoC\u5BB9\u5668</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>	<span class="token comment">//org.springframework.boot.autoconfigure.AutoConfigurationImportSelector</span>
<span class="token comment">//\u6B64\u5904\u53EA\u8D34\u4E86\u5173\u952E\u65B9\u6CD5</span>
<span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">AnnotationAttributes</span> attributes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token class-name">SpringFactoriesLoader</span><span class="token punctuation">.</span><span class="token function">loadFactoryNames</span><span class="token punctuation">(</span><span class="token function">getSpringFactoriesLoaderFactoryClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> <span class="token string">&quot;No auto configuration classes found in META-INF/spring.factories. If you &quot;</span>
				<span class="token operator">+</span> <span class="token string">&quot;are using a custom packaging, make sure that file is correct.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> configurations<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>AutoConfigurationImportSelector\u7C7B\u4E2D\u7684getCandidateConfigurations\u65B9\u6CD5\u4EE3\u7801\u5982\u4E0A\uFF0C\u5176\u8C03\u7528\u4E86SpringFactoriesLoader\u7684loadFactoryNames\u65B9\u6CD5\uFF0C\u6765\u83B7\u53D6</p></li></ol><p>configurations\uFF0C\u6B64configurations\u5217\u8868\u5176\u5B9E\u5C31\u662F\u8981\u88AB\u81EA\u52A8\u82B1\u914D\u7F6E\u7684\u7C7B\u3002SpringFactoriesLoader\u7684\u4E24\u4E2A\u91CD\u8981\u65B9\u6CD5\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//org.springframework.core.io.support.SpringFactoriesLoader</span>
<span class="token comment">//\u53EA\u8D34\u4E86\u4E24\u4E2A\u5173\u952E\u65B9\u6CD5</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> FACTORIES_RESOURCE_LOCATION <span class="token operator">=</span> <span class="token string">&quot;META-INF/spring.factories&quot;</span><span class="token punctuation">;</span>

<span class="token comment">//\u6B64\u65B9\u6CD5\u8FD4\u56DE\u7684\u662F\u5373\u5C06\u8981\u88AB\u81EA\u52A8\u5316\u914D\u7F6E\u7684\u7C7B\u7684\u5168\u9650\u5B9A\u7C7B\u540D\uFF0C\u662F\u4ECEMETA-INF/spring.factories\u914D\u7F6E\u7684\uFF0C\u914D\u7F6E\u6587\u4EF6\u4E2D\u6709\u4E2Aorg.springframework.boot.autoconfigure.EnableAutoConfiguration \u5176\u540E\u9762\u53EF\u914D\u7F6E\u591A\u4E2A\u60F3\u88AB\u81EA\u52A8\u82B1\u914D\u7F6E\u7684\u7C7B</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadFactoryNames</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> factoryType<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullab</span>\u7B49le <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> factoryTypeName <span class="token operator">=</span> factoryType<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">loadSpringFactories</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>factoryTypeName<span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>


	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadSpringFactories</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> result<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> urls <span class="token operator">=</span> <span class="token punctuation">(</span>classLoader <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span>
					classLoader<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>FACTORIES_RESOURCE_LOCATION<span class="token punctuation">)</span> <span class="token operator">:</span>
					<span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemResources</span><span class="token punctuation">(</span>FACTORIES_RESOURCE_LOCATION<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//META-INF/spring.factories</span>
			result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedMultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">URL</span> url <span class="token operator">=</span> urls<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">UrlResource</span> resource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UrlResource</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token class-name">PropertiesLoaderUtils</span><span class="token punctuation">.</span><span class="token function">loadProperties</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> properties<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token class-name">String</span> factoryTypeName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> factoryImplementationName <span class="token operator">:</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">commaDelimitedListToStringArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>factoryTypeName<span class="token punctuation">,</span> factoryImplementationName<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> result<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to load factories from location [&quot;</span> <span class="token operator">+</span>
					FACTORIES_RESOURCE_LOCATION <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li><p>\u4E3E\u4F8B\u5206\u6790\uFF0C\u6211\u4EEC\u5728spring.factories\u4E2D\u53EF\u4EE5\u770B\u5230org.springframework.boot.autoconfigure.EnableAutoConfiguration\u540E\u6709\u4E00\u4E2Aorg.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration\uFF0C\u8BF4\u660Espringboot\u5E0C\u671Bredis\u80FD\u591F\u81EA\u52A8\u5316\u914D\u7F6E\u3002\u63A5\u7740\u6211\u4EEC\u6253\u5F00RedisAutoConfiguration\u6E90\u7801\u67E5\u770B\u3002\u6B64\u5904\u6211\u6545\u610F\u6CA1\u590D\u5236\u6E90\u7801\uFF0C\u7528\u7684\u622A\u56FE\uFF0C\u53EF\u4EE5\u770B\u5230\u622A\u56FE\u76F4\u63A5\u6709\u62A5\u9519\uFF0C\u7F16\u8BD1\u9519\u8BEF\uFF0C\u9519\u8BEF\u7684\u539F\u56E0\u662F\u6211\u4EEC\u8FD8\u6CA1\u6DFB\u52A0spring-boot-starter-data-redis\u7684\u4F9D\u8D56\u3002**\u8FD9\u91CC\u6709\u4E2A\u95EE\u9898\uFF0C\u4E3A\u4EC0\u4E48\u660E\u660E\u4EE3\u7801\u90FD\u62A5\u9519\uFF0CCannot resolve symbol xxx\uFF08\u672A\u627E\u5230\u7C7B\uFF09\uFF0C\u4F46\u662F\u6211\u4EEC\u7684\u9879\u76EE\u4F9D\u7136\u53EF\u4EE5\u542F\u52A8\uFF1F\u4E0D\u4FE1\u4F60\u5EFA\u7ACB\u4E00\u4E2A\u7B80\u5355\u7684springboot\u9879\u76EE\uFF0C\u53EA\u6DFB\u52A0web\u4F9D\u8D56\uFF0C\u624B\u52A8\u6253\u5F00RedisAutoConfiguration\uFF0C\u53D1\u73B0\u662F\u62A5\u7EA2\u9519\u7684\uFF0C\u4F46\u662F\u4F60\u542F\u52A8\u9879\u76EE\uFF0C\u53D1\u73B0\u6CA1\u4EFB\u4F55\u95EE\u9898\uFF0Cwhy\uFF1F\uFF1F**\u8FD9\u4E2A\u95EE\u9898\u540E\u9762\u518D\u89E3\u7B54\uFF0C\u5148\u63A5\u7740\u770B\u81EA\u52A8\u914D\u7F6E\u7684\u95EE\u9898\u3002</p></li><li><p>\u5148\u628ARedisAutoConfiguration\u6E90\u7801\u590D\u5236\u51FA\u6765\u65B9\u4FBF\u6211\u5199\u6CE8\u91CA\uFF0C\u4E0A\u9762\u7528\u622A\u56FE\u4E3B\u8981\u662F\u8BA9\u5927\u5BB6\u770B\u5230\u62A5\u9519</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">RedisOperations</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">RedisProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">LettuceConnectionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">JedisConnectionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisAutoConfiguration</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;redisTemplate&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">UnknownHostException</span> <span class="token punctuation">{</span>
		<span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> template<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token annotation punctuation">@ConditionalOnMissingBean</span>
	<span class="token keyword">public</span> <span class="token class-name">StringRedisTemplate</span> <span class="token function">stringRedisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">UnknownHostException</span> <span class="token punctuation">{</span>
		<span class="token class-name">StringRedisTemplate</span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> template<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u770B\u6E90\u7801\u53EF\u77E5RedisAutoConfiguration\u4E0A\u6709\u4E00\u4E2AConfiguration\u548CConditionalOnClass\u6CE8\u89E3\uFF0C\u5148\u5206\u6790\u8FD9\u4E24\u4E2A\u3002\u9996\u5148Configuration\u6CE8\u89E3\uFF0C\u4EE3\u8868\u8FD9\u662F\u4E2AJava config\u914D\u7F6E\u7C7B\uFF0C\u548Cspring\u914D\u7F6Ebean\u7684xml\u6587\u4EF6\u662F\u4E00\u4E2A\u4F5C\u7528\uFF0C\u90FD\u662F\u7528\u6765\u5B9E\u4F8B\u5316bean\u7684\uFF0C**\u4F46\u662F\u6CE8\u610F\u8FD8\u6709\u4E2A@ConditionalOnClass(RedisOperations.class)\u6CE8\u89E3\uFF0C\u8FD9\u4E2A\u6CE8\u89E3\u7684\u4F5C\u7528\u662F\u5F53RedisOperations.class\u8FD9\u4E2A\u7C7B\u88AB\u627E\u5230\u540E\u624D\u4F1A\u751F\u6548\uFF0C\u5982\u679C\u6CA1\u627E\u5230\u6B64\u7C7B\uFF0C\u90A3\u4E48\u6574\u4E2ARedisAutoConfiguration\u5C31\u4E0D\u4F1A\u751F\u6548\u3002**\u6240\u4EE5\u5F53\u6211\u4EEC\u5F15\u5165\u4E86redis\u7684\u4F9D\u8D56\uFF0Cspringboot\u9996\u5148\u4F1A\u901A\u8FC7RedisAutoConfiguration\u7684\u65B9\u6CD5redisTemplate\u7ED9\u6211\u4EEC\u8BBE\u7F6E\u4E00\u4E2A\u9ED8\u8BA4\u7684redis\u914D\u7F6E\uFF0C\u5F53\u7136\u8FD9\u4E2A\u65B9\u6CD5\u4E0A\u4E5F\u6709\u4E2A\u6CE8\u89E3<code> @ConditionalOnMissingBean(name = &quot;redisTemplate&quot;)</code>\uFF0C\u5C31\u662F\u5F53\u6211\u4EEC\u6CA1\u6709\u624B\u52A8\u914DredisTemplate\u8FD9\u4E2Abean\u5B83\u624D\u4F1A\u8C03\u7528\u8FD9\u4E2A\u9ED8\u8BA4\u7684\u65B9\u6CD5\uFF0C\u6CE8\u5165\u4E00\u4E2AredisTemplate\u5230IoC\u5BB9\u5668\uFF0C\u6240\u4EE5\u4E00\u822C\u60C5\u51B5\u6211\u4EEC\u90FD\u662F\u624B\u52A8\u914D\u7F6E\u8FD9\u4E2AredisTemplate\uFF0C\u65B9\u4FBF\u6211\u4EEC\u8BBE\u7F6E\u5E8F\u5217\u5316\u5668\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * \u8BBE\u7F6E redisTemplate \u7684\u5E8F\u5217\u5316\u8BBE\u7F6E
     *
     * <span class="token keyword">@param</span> <span class="token parameter">redisConnectionFactory</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.\u521B\u5EFA redisTemplate \u6A21\u7248</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.\u5173\u8054 redisConnectionFactory</span>
        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.\u521B\u5EFA \u5E8F\u5217\u5316\u7C7B</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.\u8BBE\u7F6E\u53EF\u89C1\u5EA6</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5.\u542F\u52A8\u9ED8\u8BA4\u7684\u7C7B\u578B</span>
        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6.\u5E8F\u5217\u5316\u7C7B\uFF0C\u5BF9\u8C61\u6620\u5C04\u8BBE\u7F6E</span>
        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 7.\u8BBE\u7F6E value \u7684\u8F6C\u5316\u683C\u5F0F\u548C key \u7684\u8F6C\u5316\u683C\u5F0F</span>
        template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        template<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>RedisAutoConfiguration\u4E0A\u8FD8\u6709\u4E00\u4E0B\u4E24\u4E2A\u6CE8\u89E3\uFF0C\u4F5C\u7528\u662F\u4ECE\u914D\u7F6E\u6587\u4EF6\u8BFB\u53D6redis\u76F8\u5173\u7684\u4FE1\u606F\uFF0Cip\u3001\u7AEF\u53E3\u3001\u5BC6\u7801\u7B49</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@EnableConfigurationProperties(RedisProperties.class)
@Import({ LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class })
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h4 id="_2-\u8865\u5145\u6269\u5C55-\u89E3\u91CA\u4E3A\u4EC0\u4E48\u5F15\u7528\u7684\u5305\u90FD\u62A5\u7EA2\u9519\u4E86-\u9879\u76EE\u8FD8\u80FD\u542F\u52A8" tabindex="-1"><a class="header-anchor" href="#_2-\u8865\u5145\u6269\u5C55-\u89E3\u91CA\u4E3A\u4EC0\u4E48\u5F15\u7528\u7684\u5305\u90FD\u62A5\u7EA2\u9519\u4E86-\u9879\u76EE\u8FD8\u80FD\u542F\u52A8" aria-hidden="true">#</a> 2. \u8865\u5145\u6269\u5C55\uFF08\u89E3\u91CA\u4E3A\u4EC0\u4E48\u5F15\u7528\u7684\u5305\u90FD\u62A5\u7EA2\u9519\u4E86\uFF0C\u9879\u76EE\u8FD8\u80FD\u542F\u52A8\uFF09</h4><p>\u6240\u6709\u7684@Condition\u6CE8\u89E3\uFF08\u5305\u62EC\u884D\u751F\u7684\uFF09\u5176\u5B9E\u90FD\u5BF9\u5E94\u4E00\u4E2A\u5177\u4F53\u7684\u5B9E\u73B0\uFF0C\u8FD9\u4E2A\u5B9E\u73B0\u7C7B\u91CC\u9762\u6709\u4E2A\u5224\u65AD\u65B9\u6CD5\u53EB\u505Amatches,\u8FD4\u56DE\u7684\u662F\u4E2A\u5E03\u5C14\u7C7B\u578B\u5224\u65AD\u503C\u3002</p><p>\u6253\u5F00ConditionalOnClass\u6E90\u7801\u5982\u4E0B\uFF0C\u5176Conditional\u6CE8\u89E3\u4F20\u9012\u7684\u662F\u4E2AOnClassCondition.class\uFF0C\u8FD9\u5C31\u5176\u5BF9\u5E94\u7684\u5224\u65AD\u7C7B\uFF0C\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5F53\u6211\u4EEC\u4F7F\u7528ConditionalOnClass\u6CE8\u89E3\u65F6\uFF0C\u5176\u5B9E\u9645\u4E0A\u8C03\u7528\u7684\u662FOnClassCondition\u6765\u5224\u65AD\u7684\u3002\u91CD\u70B9\u5C31\u662F\u4EE5\u4E0B\u7FFB\u8BD1\u7684\u6CE8\u91CA\u90E8\u5206\uFF0C<strong>\u56E0\u4E3A\u6CE8\u89E3\u5143\u6570\u636E\u662F\u7528ASM\u89E3\u6790\u7684\uFF0C\u5E76\u4E14\u5176\u89E3\u6790\u662F\u5728\u7C7B\u52A0\u8F7D\u4E4B\u524D\u5C31\u8FDB\u884C\u4E86</strong>\uFF0C\u6211\u4EEC\u518D\u767E\u5EA6\u4EE5\u4E0B\u8BF4\u660E\u662FASM\uFF0C\u53EF\u4EE5\u770B\u5230ASM\u662F\u80FD\u76F4\u63A5\u64CD\u4F5C\u4E8C\u8FDB\u5236\u6587\u4EF6\uFF0C\u6240\u4EE5\u5BF9\u5E94\u5230\u6211\u4EEC\u8FD9\u91CCRedisAutoConfiguretion\u4E0A\uFF0C\u5F53OnClassCondition\u6EE1\u8DB3classpath\u4E2D\u5DF2\u7ECF\u6709\u4E86RedisOperations\u7C7B\u65F6\u624D\u4F1A/\u624D\u4F1A\u89E6\u53D1\u7C7B\u52A0\u8F7D\uFF0C\u5F53RedisOperations\u4E0D\u5B58\u5728\u65F6\uFF0C\u5C31\u4E0D\u52A0\u8F7DRedisAutoConfiguretion\u7C7B\uFF0C\u65E2\u7136\u4E0D\u52A0\u8F7D\u4F60\uFF0C\u5373\u4F7F\u4F60\u7F16\u8BD1\u62A5\u9519\u53C8\u5173\u6211\u865A\u62DF\u673A\u5C41\u4E8B\uFF0C\u7231\u62A5\u4E0D\u62A5\u3002</p><blockquote><p>ASM \u662F\u4E00\u4E2A Java \u5B57\u8282\u7801\u64CD\u63A7\u6846\u67B6\u3002\u5B83\u80FD\u88AB\u7528\u6765\u52A8\u6001\u751F\u6210\u7C7B\u6216\u8005\u589E\u5F3A\u65E2\u6709\u7C7B\u7684\u529F\u80FD\u3002ASM \u53EF\u4EE5\u76F4\u63A5\u4EA7\u751F\u4E8C\u8FDB\u5236 class \u6587\u4EF6\uFF0C\u4E5F\u53EF\u4EE5\u5728\u7C7B\u88AB\u52A0\u8F7D\u5165 Java \u865A\u62DF\u673A\u4E4B\u524D\u52A8\u6001\u6539\u53D8\u7C7B\u884C\u4E3A\u3002Java class \u88AB\u5B58\u50A8\u5728\u4E25\u683C\u683C\u5F0F\u5B9A\u4E49\u7684 .class \u6587\u4EF6\u91CC\uFF0C\u8FD9\u4E9B\u7C7B\u6587\u4EF6\u62E5\u6709\u8DB3\u591F\u7684\u5143\u6570\u636E\u6765\u89E3\u6790\u7C7B\u4E2D\u7684\u6240\u6709\u5143\u7D20\uFF1A\u7C7B\u540D\u79F0\u3001\u65B9\u6CD5\u3001\u5C5E\u6027\u4EE5\u53CA Java \u5B57\u8282\u7801\uFF08\u6307\u4EE4\uFF09\u3002ASM \u4ECE\u7C7B\u6587\u4EF6\u4E2D\u8BFB\u5165\u4FE1\u606F\u540E\uFF0C\u80FD\u591F\u6539\u53D8\u7C7B\u884C\u4E3A\uFF0C\u5206\u6790\u7C7B\u4FE1\u606F\uFF0C\u751A\u81F3\u80FD\u591F\u6839\u636E\u7528\u6237\u8981\u6C42\u751F\u6210\u65B0\u7C7B\u3002</p><p>ASM \u80FD\u591F\u901A\u8FC7\u6539\u9020\u65E2\u6709\u7C7B\uFF0C\u76F4\u63A5\u751F\u6210\u9700\u8981\u7684\u4EE3\u7801\u3002\u589E\u5F3A\u7684\u4EE3\u7801\u662F\u786C\u7F16\u7801\u5728\u65B0\u751F\u6210\u7684\u7C7B\u6587\u4EF6\u5185\u90E8\u7684\uFF0C\u6CA1\u6709\u53CD\u5C04\u5E26\u6765\u6027\u80FD\u4E0A\u7684\u4ED8\u51FA\u3002\u540C\u65F6\uFF0CASM \u4E0E Proxy \u7F16\u7A0B\u4E0D\u540C\uFF0C\u4E0D\u9700\u8981\u4E3A\u589E\u5F3A\u4EE3\u7801\u800C\u65B0\u5B9A\u4E49\u4E00\u4E2A\u63A5\u53E3\uFF0C\u751F\u6210\u7684\u4EE3\u7801\u53EF\u4EE5\u8986\u76D6\u539F\u6765\u7684\u7C7B\uFF0C\u6216\u8005\u662F\u539F\u59CB\u7C7B\u7684\u5B50\u7C7B\u3002\u5B83\u662F\u4E00\u4E2A\u666E\u901A\u7684 Java \u7C7B\u800C\u4E0D\u662F proxy \u7C7B\uFF0C\u751A\u81F3\u53EF\u4EE5\u5728\u5E94\u7528\u7A0B\u5E8F\u7684\u7C7B\u6846\u67B6\u4E2D\u62E5\u6709\u81EA\u5DF1\u7684\u4F4D\u7F6E\uFF0C\u6D3E\u751F\u81EA\u5DF1\u7684\u5B50\u7C7B\u3002</p><p>\u76F8\u6BD4\u4E8E\u5176\u4ED6\u6D41\u884C\u7684 Java \u5B57\u8282\u7801\u64CD\u7EB5\u5DE5\u5177\uFF0CASM \u66F4\u5C0F\u66F4\u5FEB\u3002ASM \u5177\u6709\u7C7B\u4F3C\u4E8E BCEL \u6216\u8005 SERP \u7684\u529F\u80FD\uFF0C\u800C\u53EA\u6709 33k \u5927\u5C0F\uFF0C\u800C\u540E\u8005\u5206\u522B\u6709 350k \u548C 150k\u3002\u540C\u65F6\uFF0C\u540C\u6837\u7C7B\u8F6C\u6362\u7684\u8D1F\u8F7D\uFF0C\u5982\u679C ASM \u662F 60% \u7684\u8BDD\uFF0CBCEL \u9700\u8981 700%\uFF0C\u800C SERP \u9700\u8981 1100% \u6216\u8005\u66F4\u591A\u3002</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//\u91CD\u70B9\u770B\u6CE8\u91CA\uFF0C\u7B80\u5355\u7FFB\u8BD1\u4E00\u4E0B\uFF1A</span>
<span class="token comment">//value()\u53EF\u4EE5\u5B89\u5168\u5728\u6307\u5B9A\u5728\u4E00\u4E2A\u88AB@Configuration\u6CE8\u91CA\u7684\u7C7B\u4E0A\uFF0C\u6BD4\u5982\u6211\u4EEC\u7684RedisAutoConfiguretion\uFF0C\u56E0\u4E3A\u6CE8\u89E3\u5143\u6570\u636E\u662F\u7528ASM\u89E3\u6790\u7684\uFF0C\u5E76\u4E14\u5176\u89E3\u6790\u662F\u5728</span>
<span class="token comment">//\u7C7B\u52A0\u8F7D\u4E4B\u524D\u5C31\u8FDB\u884C\u4E86\u2026\u2026</span>
<span class="token doc-comment comment">/**
 * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Conditional</span></span> @Conditional<span class="token punctuation">}</span> that only matches when the specified classes are on
 * the classpath.
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * A <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> can be safely specified on <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token annotation punctuation">@Configuration</span></span></span><span class="token punctuation">}</span> classes as the
 * annotation metadata is parsed by using ASM before the class is loaded. Extra care is
 * required when placed on <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token annotation punctuation">@Bean</span></span></span><span class="token punctuation">}</span> methods, consider isolating the condition in a
 * separate <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Configuration</span></span></span><span class="token punctuation">}</span> class, in particular if the return type of the method
 * matches the <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">value</span></span> target of the condition<span class="token punctuation">}</span>.
 *
 * <span class="token keyword">@author</span> Phillip Webb
 * <span class="token keyword">@since</span> 1.0.0
 */</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">OnClassCondition</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">ConditionalOnClass</span> <span class="token punctuation">{</span>

	<span class="token doc-comment comment">/**
	 * The classes that must be present. Since this annotation is parsed by loading class
	 * bytecode, it is safe to specify classes here that may ultimately not be on the
	 * classpath, only if this annotation is directly on the affected component and
	 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>not<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> if this annotation is used as a composed, meta-annotation. In order to
	 * use this annotation as a meta-annotation, only use the <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">name</span></span><span class="token punctuation">}</span> attribute.
	 * <span class="token keyword">@return</span> the classes that must be present
	 */</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token doc-comment comment">/**
	 * The classes names that must be present.
	 * <span class="token keyword">@return</span> the class names that must be present.
	 */</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ConditionalOnClass\u7C7B\u56FE\u5982\u4E0B\uFF0C\u5B83\u7EE7\u627F\u4E86condition\u63A5\u53E3</p><p>\u6253\u5F00Condition\u63A5\u53E3\u5982\u4E0B\uFF0C\u67E5\u770B\u6CE8\u91CA\uFF0C\u6CE8\u91CA\u4E2D\u6709\u8BF4\u660E **\u6761\u4EF6\u5224\u65AD\u662F\u5728bean\u5B9A\u4E49\u5373\u5C06\u6CE8\u518C\u5230\u5BB9\u5668\u4E4B\u524D\u8FDB\u884C\u7684\uFF0C**\u770B\u8FC7springIoC\u6E90\u7801\u7684\u540C\u5B66\u5E94\u8BE5\u77E5\u9053\uFF0Cspring\u521B\u5EFA\u4E00\u4E2A\u5BF9\u8C61\u7684\u8FC7\u7A0B\u662F\u5F53\u670D\u52A1\u542F\u52A8\u540E\uFF0C\u5148\u8BFB\u53D6xml\u914D\u7F6E\u6587\u4EF6\uFF08\u6216\u8005\u901A\u8FC7\u6CE8\u89E3\uFF09\uFF0C\u6839\u636E\u914D\u7F6E\u6587\u4EF6\u5148\u5B9A\u4E49\u4E00\u4E2ABeanDefinition\uFF0C\u7136\u540E\u628A\u8FD9\u4E2Abean\u7ED9\u653E\u5230\u5BB9\u5668\uFF08\u5728spring\u4E2D\u5B9E\u9645\u5C31\u662F\u4E00\u4E2AMap\uFF09\uFF0C\u7136\u540E\u5728\u6839\u636Ebean\u5B9A\u4E49\uFF0C\u901A\u8FC7\u53CD\u5C04\u521B\u5EFA\u771F\u6B63\u7684\u5BF9\u8C61\u3002\u53CD\u5C04\u4F1A\u89E6\u53D1\u7C7B\u52A0\u8F7D\uFF0C\u5F53condition\u6761\u4EF6\u4E0D\u6EE1\u8DB3\u65F6\uFF0C\u6839\u636E\u5982\u4E0B\u6CE8\u91CA\u53EF\u77E5\uFF0Cbean\u5B9A\u4E49\u540E\u7EED\u90FD\u88AB\u62E6\u622A\u4E86\uFF0C\u8FDE\u6CE8\u518C\u90FD\u4E0D\u884C\uFF0C\u6240\u4EE5\u81EA\u7136\u5C31\u4E0D\u53EF\u80FD\u901A\u8FC7\u53CD\u5C04\u521B\u5EFA\u5BF9\u8C61\uFF0C\u4E0D\u53CD\u5C04\u81EA\u7136\u4E0D\u4F1A\u89E6\u53D1\u7C7B\u52A0\u8F7D\uFF0C\u4E0D\u89E6\u53D1\u7C7B\u52A0\u8F7D\u90A3\u4E48RedisAutoConfiguration\u5F53\u7136\u554A\u4E0D\u4F1A\u52A0\u8F7D\uFF0C\u5B83\u4E0D\u52A0\u8F7D\uFF0C\u90A3\u4E48\u5373\u4F7F\u5B83\u91CC\u9762\u5F15\u7528\u4E86\u4E00\u4E2A\u4E0D\u5B58\u5728\u7684\u7C7B\u4E5F\u4E0D\u4F1A\u6709\u5565\u95EE\u9898\u3002</p><p>\u4E0A\u9762\u8BF4\u7684\u5F88\u7ED5\uFF0C\u8868\u8FBE\u7684\u4E0D\u662F\u5F88\u597D\uFF0C\u8981\u60F3\u770B\u61C2\u4EE5\u4E0A\u90E8\u5206\u9700\u8981\u638C\u63E1\u4E24\u65B9\u9762\u7684\u77E5\u8BC6\uFF1A</p><ul><li>\u7C7B\u52A0\u8F7D\u539F\u7406\uFF0C\u63A8\u8350\u770B\u5468\u5FD7\u660E\u8001\u5E08\u7684\u300A\u6DF1\u5165\u7406\u89E3JVM\u865A\u62DF\u673A\u300B</li><li>spring IoC\u5BB9\u5668\u521B\u5EFAbean\u7684\u539F\u7406\uFF0C\u63A8\u8350\u300Aspring\u63ED\u79D8\u300B\uFF0C\u8BE6\u7EC6\u770B\u770BIoC\u90E8\u5206</li></ul><h4 id="_3\u3001\u53C8\u4E00\u4E2A\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u53C8\u4E00\u4E2A\u95EE\u9898" aria-hidden="true">#</a> 3\u3001\u53C8\u4E00\u4E2A\u95EE\u9898</h4><p>spring-boot-autoconfigure.jar\u8FD9\u4E2A\u5305\u4E2D\u7684RedisAutoConfiguration\u90FD\u62A5\u7EA2\u8272\u9519\u8BEF\u4E86\uFF0C\u90A3\u4E48spring\u5B98\u65B9\u662F\u600E\u4E48\u6253\u5305\u51FA\u6765spring-boot-autoconfigure.jar\u7684\uFF1F\uFF1F\u600E\u4E48\u7ED9\u6211\u4EEC\u63D0\u4F9B\u4E86\u4E00\u4E2A\u62A5\u9519\u7684\u5305\u5462</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u7B54\uFF1A\u56E0\u4E3Aspringboot\u5305\u4E2D\u5F15\u5165\u4E86redis\u7684\u5305\uFF0C\u4E0D\u8FC7\u5728pomx\u4E2D\u4F7F\u7528\u7684\u662Foptional,optional\u7684\u4F5C\u7528\u5C31\u662F\u5F53\u524D\u9879\u76EE\uFF08spring-boot-autoconfigure.\uFF09\u7F16\u8BD1class\u65F6\u4F1A\u4F7F\u7528\u6B64\u5305\uFF0C\u4F46\u662F\u6253jar\u5305\u65F6\u4E0D\u4F1A\u628A\u4ED6\u5305\u542B\u8FDB\u6765\uFF0C\u5E76\u4E14\u5982\u679C\u9879\u76EE\u4F9D\u8D56spring-boot-autoconfigure\uFF0C\u4E5F\u4E0D\u4F1A\u81EA\u52A8import\u88ABoptional\u4FEE\u9970\u7684\u5305\uFF0C\u56E0\u6B64\u6211\u4EEC\u9879\u76EE\u5982\u679C\u4E0D\u663E\u793A\u6307\u5B9Aspring-boot-starter-data-redis\u4F9D\u8D56\u5C31\u4F1A\u62A5\u7EA2\uFF0C\u81F3\u4E8E\u62A5\u7EA2\u4E3A\u5565\u9879\u76EE\u8FD8\u80FD\u542F\u52A8\u6DF1\u5C42\u539F\u7406\u4E0B\u4E00\u8282\u518D\u770B\u6E90\u7801\u5206\u6790\u3002
		&lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-conditionalonclass\u7684\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_4-conditionalonclass\u7684\u539F\u7406" aria-hidden="true">#</a> 4. @ConditionalOnClass\u7684\u539F\u7406</h4><p>\u6211\u4EEC\u5230\u81EA\u5DF1\u7684springboot\u9879\u76EE\u4E2D\u5148\u5F15\u5165redis\u4F9D\u8D56\uFF0C\u65B9\u4FBF\u770BRedisAutoConfiguration\u6E90\u7801</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7\u524D\u51E0\u7AE0\uFF0C\u6211\u4EEC\u77E5\u9053\u5728spring-boot-autoconfigure.jar\u4E2D\u7684META-INF/spring.factories\u4E2D\u914D\u7F6E\u4E86RedisAutoConfiguration\u7684\u81EA\u52A8\u914D\u7F6E</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># Auto Configure</span>
<span class="token key attr-name">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span><span class="token punctuation">=</span><span class="token value attr-value">org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration\u6253\u5F00RedisAutoConfiguration\u7684\u6E90\u7801\uFF0C\u53EF\u4EE5\u770B\u5230\u5B83\u6709\u4E00\u4E2A@ConditionalOnClass(RedisOperations.class)\u6CE8\u89E3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">RedisOperations</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">RedisProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">LettuceConnectionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">JedisConnectionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisAutoConfiguration</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;redisTemplate&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">UnknownHostException</span> <span class="token punctuation">{</span>
		<span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> template<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token annotation punctuation">@ConditionalOnMissingBean</span>
	<span class="token keyword">public</span> <span class="token class-name">StringRedisTemplate</span> <span class="token function">stringRedisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">UnknownHostException</span> <span class="token punctuation">{</span>
		<span class="token class-name">StringRedisTemplate</span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> template<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u5728<code>org.springframework.boot.autoconfigure.AutoConfigurationImportSelector#getAutoConfigurationEntry</code>\u65B9\u6CD5\u6253\u4E0A\u65AD\u70B9\u51C6\u5907debug,\u56E0springboot\u9879\u76EE\u542F\u52A8\u65F6\u4F1A\u81EA\u52A8\u8C03\u7528\u5B83\uFF0C\u81F3\u4E8E\u4E3A\u4EC0\u4E48\uFF0C\u4EE5\u540E\u518D\u7814\u7A76\u3002</p><p>\u5148\u8BF4\u4E00\u4E0Bdebug\u65F6\u65B9\u6CD5\u8C03\u7528\u94FE\uFF08\u53EA\u5217\u4E3E\u5173\u952E\u65B9\u6CD5\uFF09\uFF0C\u5927\u5BB6\u5148\u5728\u8C03\u7528\u8FD9\u4E9B\u65B9\u6CD5\u7684\u4F4D\u7F6E\u6253\u597D\u65AD\u70B9\uFF1A</p><p><code>org.springframework.boot.autoconfigure.AutoConfigurationImportSelector#getAutoConfigurationEntry</code></p><p><code>org.springframework.boot.autoconfigure.AutoConfigurationImportSelector.ConfigurationClassFilter#filter</code></p><p><code>org.springframework.boot.autoconfigure.condition.FilteringSpringBootCondition#match</code></p><p><code>org.springframework.boot.autoconfigure.condition.OnBeanCondition#getOutcomes</code></p><p><code>org.springframework.boot.autoconfigure.condition.OnBeanCondition#getOutcome</code></p>`,31),o=[p];function c(i,l){return s(),a("div",null,o)}var k=n(e,[["render",c],["__file","SpringBootAutoConfiguration.html.vue"]]);export{k as default};
