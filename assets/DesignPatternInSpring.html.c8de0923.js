import{_ as n}from"./plugin-vue_export-helper.21dcd24c.js";import{o as a,c as s,e as t}from"./app.3039e90b.js";const e={},p=t(`<h3 id="_1\u3001\u5DE5\u5382\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5DE5\u5382\u6A21\u5F0F" aria-hidden="true">#</a> 1\u3001\u5DE5\u5382\u6A21\u5F0F</h3><p>BeanFactory\u662F\u5178\u578B\u7684\u5DE5\u5382\u65B9\u6CD5\u6A21\u5F0F\uFF0C\u5176\u6709\u591A\u4E2A\u5B9E\u73B0\uFF0C\u4E0D\u540C\u7684\u5B9E\u73B0\u6709\u4E0D\u540C\u7684getBean\u65B9\u6CD5\uFF0C\u9ED8\u8BA4\u5B9E\u73B0\u662FDefaultListalbeBeanFactory,\u6211\u4EEC\u4E5F\u53EF\u4EE5\u5B9A\u4E49\u81EA\u5DF1\u7684\u5DE5\u5382\u5B9E\u73B0BeanFactory\u63A5\u53E3\uFF0C\u91CD\u5199\u91CC\u9762\u7684getBean\u65B9\u6CD5</p><h3 id="_2\u3001\u5355\u4F8B\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5355\u4F8B\u6A21\u5F0F" aria-hidden="true">#</a> 2\u3001\u5355\u4F8B\u6A21\u5F0F</h3><p>\u5728spring\u4E2D\u4F7F\u7528singleton\u4FEE\u9970\u7684bean\u90FD\u662F\u5355\u4F8B\u6A21\u5F0F\uFF0C<code>org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#addSingleton</code>\uFF0C\u5728spring\u5B9E\u4F8B\u5316\u51FA\u771F\u6B63\u7684\u5BF9\u8C61\u540E\uFF0C\u4F1A\u628A\u8FD9\u4E2A\u5BF9\u8C61\u52A0\u5230\u5BB9\u5668\u4E2D</p><blockquote><p>\u4FEE\u6B63\uFF0C\u4EE5\u4E0A\u8BF4singleton=\u5355\u4F8B\u6A21\u5F0F\uFF0C\u662F\u9519\u8BEF\u7684\uFF0Csingleton\u6307\u7684\u662F\u5BB9\u5668\u4E2D\u8BE5\u5BF9\u8C61\u7684bean\u53EA\u6709\u4E00\u4E2A\uFF0C\u548C\u5355\u4F8B\u6A21\u5F0F\u4E0D\u662F\u4E00\u56DE\u4E8B\uFF0C\u5355\u4F8B\u6A21\u5F0F\u6709\uFF1AMybatis\u7684\u8FDE\u63A5\u5DE5\u5382\u3001redis\u7684\u8FDE\u63A5\u5DE5\u5382\u7B49</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
<span class="token doc-comment comment">/**
* Add the given singleton object to the singleton cache of this factory.
* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>To be called for eager registration of singletons.
* <span class="token keyword">@param</span> <span class="token parameter">beanName</span> the name of the bean
* <span class="token keyword">@param</span> <span class="token parameter">singletonObject</span> the singleton object
*/</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">addSingleton</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">Object</span> singletonObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>singletonObjects<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> singletonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>singletonFactories<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>earlySingletonObjects<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>registeredSingletons<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3\u3001\u89C2\u5BDF\u8005\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u89C2\u5BDF\u8005\u6A21\u5F0F" aria-hidden="true">#</a> 3\u3001\u89C2\u5BDF\u8005\u6A21\u5F0F</h3><p>spring\u4E2D\u7684\u65F6\u95F4event\u90FD\u91C7\u7528\u7684\u89C2\u5BDF\u8005\u6A21\u5F0F <img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/20221226114253.png" alt="20221226114253" loading="lazy"></p><h3 id="_4\u3001\u9002\u914D\u5668\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u9002\u914D\u5668\u6A21\u5F0F" aria-hidden="true">#</a> 4\u3001\u9002\u914D\u5668\u6A21\u5F0F</h3><p>SpringMVC</p><h3 id="_5\u3001\u4EE3\u7406\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u4EE3\u7406\u6A21\u5F0F" aria-hidden="true">#</a> 5\u3001\u4EE3\u7406\u6A21\u5F0F</h3><p>SpringAOP\u6574\u4E2A\u5C31\u91C7\u7528\u7684\u4EE3\u7406\u6A21\u5F0F</p><h3 id="_6\u3001\u6A21\u677F\u65B9\u6CD5\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u6A21\u677F\u65B9\u6CD5\u6A21\u5F0F" aria-hidden="true">#</a> 6\u3001\u6A21\u677F\u65B9\u6CD5\u6A21\u5F0F</h3><h3 id="_7\u3001\u5305\u88C5\u6A21\u5F0F-\u88C5\u9970\u8005\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_7\u3001\u5305\u88C5\u6A21\u5F0F-\u88C5\u9970\u8005\u6A21\u5F0F" aria-hidden="true">#</a> 7\u3001\u5305\u88C5\u6A21\u5F0F\uFF08\u88C5\u9970\u8005\u6A21\u5F0F\uFF09</h3><p>\u5728IOC\u5BB9\u5668\u4E2D\uFF0C\u53CD\u5C04\u521B\u5EFA\u4E86\u5B9E\u4F8B\u5BF9\u8C61\u4EE5\u540E\uFF0C\u4F1A\u5BF9\u5176\u8FDB\u884C\u5305\u88C5\u3002\u53C2\u8003<code>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#instantiateBean</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
	<span class="token doc-comment comment">/**
	 * Instantiate the given bean using its default constructor.
	 * <span class="token keyword">@param</span> <span class="token parameter">beanName</span> the name of the bean
	 * <span class="token keyword">@param</span> <span class="token parameter">mbd</span> the bean definition for the bean
	 * <span class="token keyword">@return</span> a BeanWrapper for the new instance
	 */</span>
	<span class="token keyword">protected</span> <span class="token class-name">BeanWrapper</span> <span class="token function">instantiateBean</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">RootBeanDefinition</span> mbd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token class-name">Object</span> beanInstance<span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token class-name">BeanFactory</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				beanInstance <span class="token operator">=</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
						<span class="token function">getInstantiationStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">instantiate</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">,</span>
						<span class="token function">getAccessControlContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token punctuation">{</span>
				beanInstance <span class="token operator">=</span> <span class="token function">getInstantiationStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">instantiate</span><span class="token punctuation">(</span>mbd<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token class-name">BeanWrapper</span> bw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanWrapperImpl</span><span class="token punctuation">(</span>beanInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">initBeanWrapper</span><span class="token punctuation">(</span>bw<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> bw<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanCreationException</span><span class="token punctuation">(</span>
					mbd<span class="token punctuation">.</span><span class="token function">getResourceDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> <span class="token string">&quot;Instantiation of bean failed&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53E6\u5916BeanDefinitionHolder\u4E5F\u662F\u5305\u88C5\u4E86BeanDefinition\uFF0C\u4E5F\u662F\u88C5\u9970\u8005\u8BBE\u8BA1\u6A21\u5F0F</p><h3 id="_8\u3001\u539F\u578B\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_8\u3001\u539F\u578B\u6A21\u5F0F" aria-hidden="true">#</a> 8\u3001\u539F\u578B\u6A21\u5F0F</h3><p>spring\u4E2Dprototype\u7C7B\u578B\u7684bean\u91C7\u7528\u7684\u539F\u578B\u6A21\u5F0F</p><h3 id="_9\u3001\u5EFA\u9020\u8005\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_9\u3001\u5EFA\u9020\u8005\u6A21\u5F0F" aria-hidden="true">#</a> 9\u3001\u5EFA\u9020\u8005\u6A21\u5F0F</h3><p>\u5404\u79CD\u6846\u67B6\u4E2D\u7684builder\u57FA\u672C\u90FD\u662F\u5EFA\u9020\u8005\u6A21\u5F0F\uFF0C\u4E00\u822C\u5EFA\u9020\u8FD9\u6A21\u5F0F\u90FD\u662F\u901A\u8FC7\u94FE\u5F0F\u5199\u6CD5\u6765\u8BBE\u7F6E\u5B57\uFF0C\u5E76\u4E14\u8BBE\u7F6E\u5B8C\u5B57\u6BB5\u540E\u8FD4\u56DEBuilder\u672C\u8EAB\uFF0C\u6700\u540E\u8C03\u7528build\u65B9\u6CD5\uFF0C\u6700\u7EC8\u751F\u6210\u4E00\u4E2A\u6211\u4EEC\u9700\u8981\u7684\u5BF9\u8C61\u3002\u6BD4\u5982SpringSecurity\u4E2DAuthenticationManagerBuilder\uFF0C\u6E90\u7801\u5982\u4E0B\uFF1A</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/20221228145658.png" alt="20221228145658" loading="lazy"></p>`,22),o=[p];function c(i,l){return a(),s("div",null,o)}var d=n(e,[["render",c],["__file","DesignPatternInSpring.html.vue"]]);export{d as default};
