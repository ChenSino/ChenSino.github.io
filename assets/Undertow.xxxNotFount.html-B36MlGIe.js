import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as t,c as n,e as a}from"./app-Cs38sdJl.js";const o={},i=a(`<h2 id="背景" tabindex="-1"><a class="header-anchor" href="#背景"><span>背景</span></a></h2><p>用户反馈上传图片失败，查看日志报错<code>上传文件提示：java.nio.file.NoSuchFileException: /tmp/undertow.xxxx.xxxxx，解决方案</code>，问题是这个问题之前用户就反馈过，之前是直接重启就好了，之后也没深究。最近用户又反馈不行了，所以花了点时间深究一下从根源解决问题。</p><h2 id="原因" tabindex="-1"><a class="header-anchor" href="#原因"><span>原因</span></a></h2><p>在 Linux 系统中，Spring Boot 应用以 java -jar 命令启动时，会在操作系统的 /tmp 目录下随机生成一个 tomcat（或 undertow ）临时目录，上传的文件先要转换成临时文件保存在这个文件夹中。 由于临时 /tmp 目录下的文件，在长时间（默认10天）没有使用的情况下，操作系统会执行 tmp 目录清理服务（systemd-tmpfiles-clean.service），导致 /tmp/undertow.xxxx.xxxxxxx 文件被清理； 导致在上传文件时，java调用 Files.createFile(…) 在目录/tmp/undertow.xxxx.xxxxxxx下创建临时文件时，发现找不到目录，就会抛出以上的错误。</p><h2 id="解决方法" tabindex="-1"><a class="header-anchor" href="#解决方法"><span>解决方法</span></a></h2><h3 id="方法一" tabindex="-1"><a class="header-anchor" href="#方法一"><span>方法一</span></a></h3><p>可以根据报错信息，新建 /tmp/undertow.xxxx.xxxxxxxx 目录，不影响用户正常使用。 执行 mkdir -p /tmp/undertow.8760.570269926767628882命令;</p><h3 id="方法二" tabindex="-1"><a class="header-anchor" href="#方法二"><span>方法二</span></a></h3><p>先创建好文件，配置问yml中</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">multipart</span><span class="token punctuation">:</span>
      <span class="token key atrule">location</span><span class="token punctuation">:</span> xxxx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="方法三" tabindex="-1"><a class="header-anchor" href="#方法三"><span>方法三</span></a></h3><p><code>java -jar -Dspring.servlet.multipart.location=xxxx</code></p><h2 id="验证是否生效" tabindex="-1"><a class="header-anchor" href="#验证是否生效"><span>验证是否生效</span></a></h2><h3 id="方式1" tabindex="-1"><a class="header-anchor" href="#方式1"><span>方式1</span></a></h3><p>使用以上几个方法发现创建的目录在程序启动后里面还是空白，是因为还没有上传文件当然就没有东西了，可以使用<code>watch -n 1 &#39;ls -l&#39;</code>来查看，方法如下：</p><ol><li>先在对应路径下执行<code>watch -n 1 &#39;ls -l&#39;</code>,每秒打印一次</li><li>上传文件</li><li>运气好会看到watch的命令会打印出一个tmp文件，但是会马上被删除</li></ol><h3 id="方式2" tabindex="-1"><a class="header-anchor" href="#方式2"><span>方式2</span></a></h3><p>删除你新建的目录，上传文件，再次报之前的错误，说明我们的配置是生效的</p>`,18),l=[i];function r(x,s){return t(),n("div",null,l)}const d=e(o,[["render",r],["__file","Undertow.xxxNotFount.html.vue"]]),h=JSON.parse('{"path":"/java/other/locateproblem/Undertow.xxxNotFount.html","title":"undertow.xxx not found","lang":"zh-CN","frontmatter":{"title":"undertow.xxx not found","date":"2023-05-06T00:00:00.000Z","isOriginal":true,"description":"背景 用户反馈上传图片失败，查看日志报错上传文件提示：java.nio.file.NoSuchFileException: /tmp/undertow.xxxx.xxxxx，解决方案，问题是这个问题之前用户就反馈过，之前是直接重启就好了，之后也没深究。最近用户又反馈不行了，所以花了点时间深究一下从根源解决问题。 原因 在 Linux 系统中，Sprin...","head":[["meta",{"property":"og:url","content":"https://ChenSino.github.io/java/other/locateproblem/Undertow.xxxNotFount.html"}],["meta",{"property":"og:site_name","content":"ChenSino"}],["meta",{"property":"og:title","content":"undertow.xxx not found"}],["meta",{"property":"og:description","content":"背景 用户反馈上传图片失败，查看日志报错上传文件提示：java.nio.file.NoSuchFileException: /tmp/undertow.xxxx.xxxxx，解决方案，问题是这个问题之前用户就反馈过，之前是直接重启就好了，之后也没深究。最近用户又反馈不行了，所以花了点时间深究一下从根源解决问题。 原因 在 Linux 系统中，Sprin..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-05-06T03:01:44.000Z"}],["meta",{"property":"article:author","content":"ChenSino"}],["meta",{"property":"article:published_time","content":"2023-05-06T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-05-06T03:01:44.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"undertow.xxx not found\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-05-06T00:00:00.000Z\\",\\"dateModified\\":\\"2023-05-06T03:01:44.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"ChenSino\\",\\"url\\":\\"https://ChenSino.github.io\\"}]}"]]},"headers":[{"level":2,"title":"背景","slug":"背景","link":"#背景","children":[]},{"level":2,"title":"原因","slug":"原因","link":"#原因","children":[]},{"level":2,"title":"解决方法","slug":"解决方法","link":"#解决方法","children":[{"level":3,"title":"方法一","slug":"方法一","link":"#方法一","children":[]},{"level":3,"title":"方法二","slug":"方法二","link":"#方法二","children":[]},{"level":3,"title":"方法三","slug":"方法三","link":"#方法三","children":[]}]},{"level":2,"title":"验证是否生效","slug":"验证是否生效","link":"#验证是否生效","children":[{"level":3,"title":"方式1","slug":"方式1","link":"#方式1","children":[]},{"level":3,"title":"方式2","slug":"方式2","link":"#方式2","children":[]}]}],"git":{"createdTime":1683342104000,"updatedTime":1683342104000,"contributors":[{"name":"chenxk","email":"chenxk@sonoscape.net","commits":1}]},"readingTime":{"minutes":1.6,"words":480},"filePathRelative":"java/other/locateproblem/Undertow.xxxNotFount.md","localizedDate":"2023年5月6日","excerpt":"<h2>背景</h2>\\n<p>用户反馈上传图片失败，查看日志报错<code>上传文件提示：java.nio.file.NoSuchFileException: /tmp/undertow.xxxx.xxxxx，解决方案</code>，问题是这个问题之前用户就反馈过，之前是直接重启就好了，之后也没深究。最近用户又反馈不行了，所以花了点时间深究一下从根源解决问题。</p>\\n<h2>原因</h2>\\n<p>在 Linux 系统中，Spring Boot 应用以 java -jar 命令启动时，会在操作系统的 /tmp 目录下随机生成一个 tomcat（或 undertow ）临时目录，上传的文件先要转换成临时文件保存在这个文件夹中。\\n由于临时 /tmp 目录下的文件，在长时间（默认10天）没有使用的情况下，操作系统会执行 tmp 目录清理服务（systemd-tmpfiles-clean.service），导致 /tmp/undertow.xxxx.xxxxxxx 文件被清理；\\n导致在上传文件时，java调用 Files.createFile(…) 在目录/tmp/undertow.xxxx.xxxxxxx下创建临时文件时，发现找不到目录，就会抛出以上的错误。</p>","autoDesc":true}');export{d as comp,h as data};
