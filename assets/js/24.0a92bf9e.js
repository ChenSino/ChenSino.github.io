(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{581:function(s,a,e){"use strict";e.r(a);var t=e(10),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("blockquote",[e("p",[s._v("背景：")]),s._v(" "),e("p",[s._v("我有一个库A,这个库同时被两个服务使用（serviceA、serviceB），某天，因serviceA业务需要，必须更改数据库结构，导致serviceB无法使用，但是serviceB又不能停机，所以就考虑把数据库克隆一份给serviceB使用。在克隆使用的是mysqldump直接导出，然后再新建另一个库B,在库B导入sql，结果就悲剧了。")])]),s._v(" "),e("h2",{attrs:{id:"_1、库a导出"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、库a导出"}},[s._v("#")]),s._v(" 1、库A导出")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在服务器把写了个定时备份脚本，这个databaseA是未更新前备份的库")]),s._v("\nmysqldump -h localhost -uroot -p123456 databaseA"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("databaseA.sql\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"_2、使用source导入"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、使用source导入"}},[s._v("#")]),s._v(" 2、使用source导入")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 先创建databaseB（此步省略）")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. source命令导入")]),s._v("\nuse databaseB"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" databaseA.sql"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这一步就杯具了")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("这里对导出的sql文件不熟悉，导出的时候里面会自动有个"),e("code",[s._v("use 原数据库名")]),s._v("，所以即使你在导入到新库之前切换到了库B,但是当使用source命令时，它会自动切换到原库，所以实际上直接"),e("code",[s._v("source databaseA.sql")]),s._v("是导入到了原来的A库中，这就很苦比了，这个库会直接覆盖databaseA,前面我们说过，此时的A库因业务需要表结构已经发生变化了，然后source时又被覆盖，之前修改的表结构相当于白改了。")]),s._v(" "),e("p",[e("img",{attrs:{src:"http://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220412100355169.png",alt:"image-20220412100355169"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);