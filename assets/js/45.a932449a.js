(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{602:function(s,a,t){"use strict";t.r(a);var n=t(10),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("背景：有一个导出PDF的功能，在本地运行正常，在线上异常，抛出的异常无法直接定位到问题。")])]),s._v(" "),t("h2",{attrs:{id:"_1、使用arthas来跟踪"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、使用arthas来跟踪"}},[s._v("#")]),s._v(" 1、使用arthas来跟踪")]),s._v(" "),t("ol",[t("li",[s._v("进入arths,attach进入项目")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ as.sh\nArthas script version: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.5")]),s._v(".5\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" JAVA_HOME: /usr/local/jdk1.8.0_72\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Process "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("57135")]),s._v(" already using port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3658")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Process "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("57135")]),s._v(" already using port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8563")]),s._v("\nFound existing java process, please choose one and input the serial number of the process, eg "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". Then hit ENTER.\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("134242")]),s._v(" ccs-gateway.jar\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("47802")]),s._v(" ccs-data-biz.jar\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("根据线上log定位到异常大致的位置")])]),s._v(" "),t("p",[t("img",{attrs:{src:"http://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220428111351818.png",alt:"image-20220428111351818"}})]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[s._v("到本地IDE打开源码")])]),s._v(" "),t("p",[t("img",{attrs:{src:"http://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220428111556978.png",alt:"image-20220428111556978"}})]),s._v(" "),t("p",[s._v("createPDF方法空指针，那首先肯定想到的是参数htmlStr是null")]),s._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[s._v("进入freemarkerRender方法查看，为何返回null")])]),s._v(" "),t("p",[t("img",{attrs:{src:"http://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220428112248916.png",alt:"image-20220428112248916"}})]),s._v(" "),t("ol",{attrs:{start:"5"}},[t("li",[t("p",[s._v("直接查看关键处理函数"),t("code",[s._v("template.process(dataMap, out);")])])]),s._v(" "),t("li",[t("p",[s._v("使用arthas的watch命令，追踪参数、返回值、异常信息")])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" freemarker.template.Template process "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{params,returnObj,throwExp}'")]),s._v("  -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  -x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1==1'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("追踪发现")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220428113034007.png",alt:"image-20220428113034007"}})]),s._v(" "),t("ol",{attrs:{start:"7"}},[t("li",[t("p",[s._v("源码中因为异常未指定捕获"),t("code",[s._v("TemplateModelException")]),s._v("所以"),t("code",[s._v("template.process(dataMap, out);")]),s._v("方法报错后直接返回了null，所以直接把异常捕获改成"),t("code",[s._v("ExcelpTion")]),s._v("即可")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220428113408828.png",alt:"image-20220428113408828"}})])])])])}),[],!1,null,null,null);a.default=e.exports}}]);