<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mysql8搭建主从复制 | Cute baby Sino Chen</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Good good study ,day day up!">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.f3a5b470.css" as="style"><link rel="preload" href="/assets/js/app.a73c779d.js" as="script"><link rel="preload" href="/assets/js/3.0f19326b.js" as="script"><link rel="preload" href="/assets/js/1.7c96b034.js" as="script"><link rel="preload" href="/assets/js/41.9d8cf17e.js" as="script"><link rel="prefetch" href="/assets/js/10.faaef915.js"><link rel="prefetch" href="/assets/js/11.981233be.js"><link rel="prefetch" href="/assets/js/12.3e2f1dee.js"><link rel="prefetch" href="/assets/js/13.a4996a46.js"><link rel="prefetch" href="/assets/js/14.27d3cc00.js"><link rel="prefetch" href="/assets/js/15.62c1e221.js"><link rel="prefetch" href="/assets/js/16.9231dc90.js"><link rel="prefetch" href="/assets/js/17.cacca4ae.js"><link rel="prefetch" href="/assets/js/18.07c622ad.js"><link rel="prefetch" href="/assets/js/19.83f6564b.js"><link rel="prefetch" href="/assets/js/20.76f975f8.js"><link rel="prefetch" href="/assets/js/21.4726b157.js"><link rel="prefetch" href="/assets/js/22.2873b557.js"><link rel="prefetch" href="/assets/js/23.4a00a5d4.js"><link rel="prefetch" href="/assets/js/24.0ff4cae8.js"><link rel="prefetch" href="/assets/js/25.3b823323.js"><link rel="prefetch" href="/assets/js/26.9e14f449.js"><link rel="prefetch" href="/assets/js/27.fbf9def2.js"><link rel="prefetch" href="/assets/js/28.9916f382.js"><link rel="prefetch" href="/assets/js/29.369c9b5e.js"><link rel="prefetch" href="/assets/js/30.a000b56d.js"><link rel="prefetch" href="/assets/js/31.d7bbcb7e.js"><link rel="prefetch" href="/assets/js/32.46d097e3.js"><link rel="prefetch" href="/assets/js/33.ee21cd5c.js"><link rel="prefetch" href="/assets/js/34.06cbf5ec.js"><link rel="prefetch" href="/assets/js/35.2e261d0a.js"><link rel="prefetch" href="/assets/js/36.8c4073a3.js"><link rel="prefetch" href="/assets/js/37.2a109f8e.js"><link rel="prefetch" href="/assets/js/38.2cf03d85.js"><link rel="prefetch" href="/assets/js/39.9845f6e3.js"><link rel="prefetch" href="/assets/js/4.3b1a6363.js"><link rel="prefetch" href="/assets/js/40.2ddb5e46.js"><link rel="prefetch" href="/assets/js/42.c6c11ba0.js"><link rel="prefetch" href="/assets/js/43.f9b419b2.js"><link rel="prefetch" href="/assets/js/44.653fb0e7.js"><link rel="prefetch" href="/assets/js/45.86fec259.js"><link rel="prefetch" href="/assets/js/46.82cebd01.js"><link rel="prefetch" href="/assets/js/47.0aae4d08.js"><link rel="prefetch" href="/assets/js/48.a7333d44.js"><link rel="prefetch" href="/assets/js/49.e9c36560.js"><link rel="prefetch" href="/assets/js/5.9b33242c.js"><link rel="prefetch" href="/assets/js/50.e88e83b9.js"><link rel="prefetch" href="/assets/js/51.85bf4061.js"><link rel="prefetch" href="/assets/js/52.660da5aa.js"><link rel="prefetch" href="/assets/js/53.08072954.js"><link rel="prefetch" href="/assets/js/54.b2935c8b.js"><link rel="prefetch" href="/assets/js/55.462e01ee.js"><link rel="prefetch" href="/assets/js/56.0acdc905.js"><link rel="prefetch" href="/assets/js/57.8251d8f1.js"><link rel="prefetch" href="/assets/js/58.301f8221.js"><link rel="prefetch" href="/assets/js/59.667ce35e.js"><link rel="prefetch" href="/assets/js/6.9f0ac686.js"><link rel="prefetch" href="/assets/js/60.d5bb2641.js"><link rel="prefetch" href="/assets/js/61.8fe8a281.js"><link rel="prefetch" href="/assets/js/62.5dfc7d12.js"><link rel="prefetch" href="/assets/js/63.976d2811.js"><link rel="prefetch" href="/assets/js/64.fe8f16f0.js"><link rel="prefetch" href="/assets/js/65.d4c8a27b.js"><link rel="prefetch" href="/assets/js/66.8b443e9f.js"><link rel="prefetch" href="/assets/js/67.fd4a7632.js"><link rel="prefetch" href="/assets/js/68.aad48d8e.js"><link rel="prefetch" href="/assets/js/69.a26a0925.js"><link rel="prefetch" href="/assets/js/7.8c8f1c63.js"><link rel="prefetch" href="/assets/js/8.ba82d863.js"><link rel="prefetch" href="/assets/js/9.6cb8358d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f3a5b470.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1aefc0b4><div data-v-1aefc0b4><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1aefc0b4 data-v-1aefc0b4><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Cute baby Sino Chen</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>Good good study ,day day up!</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>chenkun</span>
            
          <span data-v-25ba6db2>2017 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-1aefc0b4><header class="navbar" data-v-1aefc0b4><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Cute baby Sino Chen" class="logo"> <span class="site-name">Cute baby Sino Chen</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/category1/" class="nav-link"><i class="undefined"></i>
  category1
</a></li><li class="dropdown-item"><!----> <a href="/categories/category2/" class="nav-link"><i class="undefined"></i>
  category2
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/杂记/" class="nav-link"><i class="undefined"></i>
  杂记
</a></li><li class="dropdown-item"><!----> <a href="/categories/运维/" class="nav-link"><i class="undefined"></i>
  运维
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue知识点/" class="nav-link"><i class="undefined"></i>
  vue知识点
</a></li><li class="dropdown-item"><!----> <a href="/categories/集合/" class="nav-link"><i class="undefined"></i>
  集合
</a></li><li class="dropdown-item"><!----> <a href="/categories/线程池/" class="nav-link"><i class="undefined"></i>
  线程池
</a></li><li class="dropdown-item"><!----> <a href="/categories/多线程/" class="nav-link"><i class="undefined"></i>
  多线程
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/java基础/" class="nav-link"><i class="undefined"></i>
  java基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/框架/" class="nav-link"><i class="undefined"></i>
  框架
</a></li><li class="dropdown-item"><!----> <a href="/categories/jvm/" class="nav-link"><i class="undefined"></i>
  jvm
</a></li><li class="dropdown-item"><!----> <a href="/categories/软件/" class="nav-link"><i class="undefined"></i>
  软件
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-blog"></i>
      Java
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java Core</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs/java/base/" class="nav-link"><i class="undefined"></i>
  Java基础
</a></li><li class="dropdown-subitem"><a href="/docs/java/jvm/" class="nav-link"><i class="undefined"></i>
  Jvm
</a></li><li class="dropdown-subitem"><a href="/docs/java/advance/" class="nav-link"><i class="undefined"></i>
  Java进阶
</a></li></ul></li><li class="dropdown-item"><h4>Java FrameWork</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs/java/framework/spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-subitem"><a href="/docs/java/framework/springboot/SpringBootAutoConfiguration.html" class="nav-link"><i class="undefined"></i>
  SpringBoot
</a></li><li class="dropdown-subitem"><a href="/docs/java/framework/mybatis/mybatis.html" class="nav-link"><i class="undefined"></i>
  Mybatis
</a></li></ul></li><li class="dropdown-item"><h4>分布式微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs/distributeservice/" class="nav-link"><i class="undefined"></i>
  分布式
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-blog"></i>
      web前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/frontWeb/javascript/" class="nav-link"><i class="undefined"></i>
  javascript基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontWeb/vue/" class="nav-link"><i class="undefined"></i>
  vue知识点
</a></li></ul></div></div><div class="nav-item"><a href="/docs/linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></div><div class="nav-item"><a href="/docs/tools/" class="nav-link"><i class="undefined"></i>
  工具软件
</a></div><div class="nav-item"><a href="/docs/daily/" class="nav-link"><i class="undefined"></i>
  每日一记
</a></div><div class="nav-item"><a href="/docs/essay/" class="nav-link"><i class="undefined"></i>
  随笔杂记
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/chensino" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1aefc0b4></div> <aside class="sidebar" data-v-1aefc0b4><div class="personal-info-wrapper" data-v-39576ba9 data-v-1aefc0b4><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-39576ba9> <h3 class="name" data-v-39576ba9>
    chenkun
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>58</h3> <h6 data-v-39576ba9>Articles</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>16</h3> <h6 data-v-39576ba9>Tags</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/category1/" class="nav-link"><i class="undefined"></i>
  category1
</a></li><li class="dropdown-item"><!----> <a href="/categories/category2/" class="nav-link"><i class="undefined"></i>
  category2
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/杂记/" class="nav-link"><i class="undefined"></i>
  杂记
</a></li><li class="dropdown-item"><!----> <a href="/categories/运维/" class="nav-link"><i class="undefined"></i>
  运维
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue知识点/" class="nav-link"><i class="undefined"></i>
  vue知识点
</a></li><li class="dropdown-item"><!----> <a href="/categories/集合/" class="nav-link"><i class="undefined"></i>
  集合
</a></li><li class="dropdown-item"><!----> <a href="/categories/线程池/" class="nav-link"><i class="undefined"></i>
  线程池
</a></li><li class="dropdown-item"><!----> <a href="/categories/多线程/" class="nav-link"><i class="undefined"></i>
  多线程
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/java基础/" class="nav-link"><i class="undefined"></i>
  java基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/框架/" class="nav-link"><i class="undefined"></i>
  框架
</a></li><li class="dropdown-item"><!----> <a href="/categories/jvm/" class="nav-link"><i class="undefined"></i>
  jvm
</a></li><li class="dropdown-item"><!----> <a href="/categories/软件/" class="nav-link"><i class="undefined"></i>
  软件
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-blog"></i>
      Java
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java Core</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs/java/base/" class="nav-link"><i class="undefined"></i>
  Java基础
</a></li><li class="dropdown-subitem"><a href="/docs/java/jvm/" class="nav-link"><i class="undefined"></i>
  Jvm
</a></li><li class="dropdown-subitem"><a href="/docs/java/advance/" class="nav-link"><i class="undefined"></i>
  Java进阶
</a></li></ul></li><li class="dropdown-item"><h4>Java FrameWork</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs/java/framework/spring/" class="nav-link"><i class="undefined"></i>
  Spring
</a></li><li class="dropdown-subitem"><a href="/docs/java/framework/springboot/SpringBootAutoConfiguration.html" class="nav-link"><i class="undefined"></i>
  SpringBoot
</a></li><li class="dropdown-subitem"><a href="/docs/java/framework/mybatis/mybatis.html" class="nav-link"><i class="undefined"></i>
  Mybatis
</a></li></ul></li><li class="dropdown-item"><h4>分布式微服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs/distributeservice/" class="nav-link"><i class="undefined"></i>
  分布式
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-blog"></i>
      web前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/frontWeb/javascript/" class="nav-link"><i class="undefined"></i>
  javascript基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/frontWeb/vue/" class="nav-link"><i class="undefined"></i>
  vue知识点
</a></li></ul></div></div><div class="nav-item"><a href="/docs/linux/" class="nav-link"><i class="undefined"></i>
  Linux
</a></div><div class="nav-item"><a href="/docs/tools/" class="nav-link"><i class="undefined"></i>
  工具软件
</a></div><div class="nav-item"><a href="/docs/daily/" class="nav-link"><i class="undefined"></i>
  每日一记
</a></div><div class="nav-item"><a href="/docs/essay/" class="nav-link"><i class="undefined"></i>
  随笔杂记
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/chensino" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><a href="/docs/java/advance/" class="sidebar-link">java进阶知识点学习</a></li><li><a href="/pages/555bf2/" class="sidebar-link">彻底理清Java中的几种代理</a></li><li><a href="/pages/256670/" aria-current="page" class="active sidebar-link">mysql8搭建主从复制</a></li><li><a href="/docs/java/advance/ThreadPool.html" class="sidebar-link">线程池总结</a></li><li><a href="/docs/java/advance/ParentDelegationClassloader.html" class="sidebar-link">证明SPI打破双亲委派模式</a></li><li><a href="/docs/java/advance/Collection.html" class="sidebar-link">java集合源码分析</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-1aefc0b4><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>mysql8搭建主从复制</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>chenkun</span>
            
          <span data-v-25ba6db2>2017 - </span>
          2022
        </a></span></div></div> <div data-v-1aefc0b4><main class="page"><section><div class="page-title"><h1 class="title">mysql8搭建主从复制</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>chenkun</span></i> <!----> <!----> <i class="tags iconfont reco-tag" data-v-f875f3fc><span class="tag-item" data-v-f875f3fc>部署搭建</span></i></div></div> <div class="theme-reco-content content__default"><h3 id="_1、mysql主从复制"><a href="#_1、mysql主从复制" class="header-anchor">#</a> 1、mysql主从复制</h3> <h5 id="_1-1-搭建主从复制目的"><a href="#_1-1-搭建主从复制目的" class="header-anchor">#</a> 1.1 搭建主从复制目的？</h5> <blockquote><p>为了实现读写分离，解决数据库性能问题，读写分离中，“读”的数据是从哪里来呢？其实他是从“写”库copy过来的</p></blockquote> <h5 id="_1-2-使用docker搭建基于mysql8的主从复制"><a href="#_1-2-使用docker搭建基于mysql8的主从复制" class="header-anchor">#</a> 1.2 使用docker搭建基于mysql8的主从复制</h5> <ol><li><p>创建容器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run --name mysql_master -p <span class="token number">3001</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root -d mysql:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这一步创建容器的目的是查看那以及获取mysql配置文件，然后把它的配置文件copy到宿主机，这样方便直接在宿主机修改mysql配置，如果不事先把mysql配置文件获取出来，直接用docker的-v去挂载的话会有问题，无法达到把docker容器配置映射到宿主机的目的（可能是我的方式不对）</p></li> <li><p>把容器内mysql配置copy到宿主机，配置文件在/etc/mysql，直接把整个目录copy到宿主机</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">cp</span> 容器ID@:/etc/mysql /home/user/master <span class="token comment">#master 库的配置，路径可以自由在指定</span>
<span class="token function">docker</span> <span class="token function">cp</span> 容器ID@:/etc/mysql /home/user/slave  <span class="token comment">#slave库配置</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>分别修改master和slave的配置文件my.cnf，在mysqld下增加以下内容</p> <p>master配置</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token comment">## 设置server_id，一般设置为IP最后一位，直接写ip会报错，同一局域网内注意要唯一</span>
<span class="token assign-left variable">server_id</span><span class="token operator">=</span><span class="token number">100</span>  
<span class="token comment">## 复制过滤：也就是指定哪个数据库不用同步（mysql库一般不同步）</span>
binlog-ignore-db<span class="token operator">=</span>mysql  
<span class="token comment">## 开启二进制日志功能，可以随便取，最好有含义（关键就是这里了）</span>
log-bin<span class="token operator">=</span>edu-mysql-bin  
<span class="token comment">## 为每个session 分配的内存，在事务过程中用来存储二进制日志的缓存</span>
<span class="token assign-left variable">binlog_cache_size</span><span class="token operator">=</span>1M  
<span class="token comment">## 主从复制的格式（mixed,statement,row，默认格式是statement）</span>
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>mixed  
<span class="token comment">## 二进制日志自动删除/过期的天数。默认值为0，表示不自动删除。</span>
<span class="token assign-left variable">expire_logs_days</span><span class="token operator">=</span><span class="token number">7</span>  
<span class="token comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span>
<span class="token comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span>
<span class="token assign-left variable">slave_skip_errors</span><span class="token operator">=</span><span class="token number">1062</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>slave配置</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token comment">## 设置server_id，一般设置为IP最后一位，直接写ip会报错，同一局域网内注意要唯一</span>
<span class="token assign-left variable">server_id</span><span class="token operator">=</span><span class="token number">101</span>  
<span class="token comment">## 复制过滤：也就是指定哪个数据库不用同步（mysql库一般不同步）</span>
binlog-ignore-db<span class="token operator">=</span>mysql  
<span class="token comment">## 开启二进制日志功能，以备Slave作为其它Slave的Master时使用</span>
log-bin<span class="token operator">=</span>edu-mysql-slave1-bin  
<span class="token comment">## 为每个session 分配的内存，在事务过程中用来存储二进制日志的缓存</span>
<span class="token assign-left variable">binlog_cache_size</span><span class="token operator">=</span>1M  
<span class="token comment">## 主从复制的格式（mixed,statement,row，默认格式是statement）</span>
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>mixed  
<span class="token comment">## 二进制日志自动删除/过期的天数。默认值为0，表示不自动删除。</span>
<span class="token assign-left variable">expire_logs_days</span><span class="token operator">=</span><span class="token number">7</span>  
<span class="token comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span>
<span class="token comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span>
<span class="token assign-left variable">slave_skip_errors</span><span class="token operator">=</span><span class="token number">1062</span>  
<span class="token comment">## relay_log配置中继日志</span>
<span class="token assign-left variable">relay_log</span><span class="token operator">=</span>edu-mysql-relay-bin  
<span class="token comment">## log_slave_updates表示slave将复制事件写进自己的二进制日志</span>
<span class="token assign-left variable">log_slave_updates</span><span class="token operator">=</span><span class="token number">1</span>  
<span class="token comment">## 防止改变数据(除了特殊的线程)</span>
<span class="token assign-left variable">read_only</span><span class="token operator">=</span><span class="token number">1</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li> <li><p>删除刚启动的容器，当然不删除也无所谓，我们启动它主要是获取里面的mysql配置，好方便映射出来</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">ps</span> <span class="token comment">#查看容器id</span>
<span class="token function">docker</span> <span class="token function">rm</span> -f mysql容器id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>启动master</p> <p><code>/home/chenkun/DockerConfigs/mysql-cluster/master/mysql</code>是第二步设置的</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run --name mysql_master -p <span class="token number">3001</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root -v /home/chenkun/DockerConfigs/mysql-cluster/master/mysql:/etc/mysql -d mysql:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>查看master的状态，这一步查询结果后续第9步slave会用到</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ mysql -h <span class="token number">127.0</span>.0.1 -P <span class="token number">3001</span> -uroot -proot

mysql<span class="token operator">&gt;</span> show master status<span class="token punctuation">;</span>
+----------------------+----------+--------------+------------------+-------------------+
<span class="token operator">|</span> File                 <span class="token operator">|</span> Position <span class="token operator">|</span> Binlog_Do_DB <span class="token operator">|</span> Binlog_Ignore_DB <span class="token operator">|</span> Executed_Gtid_Set <span class="token operator">|</span>
+----------------------+----------+--------------+------------------+-------------------+
<span class="token operator">|</span> edu-mysql-bin.000003 <span class="token operator">|</span>      <span class="token number">396</span> <span class="token operator">|</span>              <span class="token operator">|</span> mysql            <span class="token operator">|</span>                   <span class="token operator">|</span>
+----------------------+----------+--------------+------------------+-------------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>在master添加一个账户，并给用户授权，目的是给slave用来从master同步数据用的（创建用户建议用navicat，因为要选择插件为mysql_native_password）</p> <p><img src="/home/chenkun/TyporaProjects/%E5%AD%A6%E4%B9%A0/mysql8%E6%90%AD%E5%BB%BA%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.assets/image-20210930101337807.png" alt="image-20210930101337807"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#如果非要使用命令行创建用户使用以下命令（推荐使用navicat）</span>
mysql<span class="token operator">&gt;</span>CREATE <span class="token environment constant">USER</span> <span class="token string">'slave'</span>@<span class="token string">'%'</span> IDENTIFIED BY <span class="token string">'root'</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span>user mysql
mysql<span class="token operator">&gt;</span>update user <span class="token builtin class-name">set</span> <span class="token assign-left variable">plugin</span><span class="token operator">=</span><span class="token string">'mysql_native_password'</span> where user <span class="token operator">=</span> slave<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO <span class="token string">'slave'</span>@<span class="token string">'%'</span><span class="token punctuation">;</span>   <span class="token comment"># 授权给slave</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>启动slave</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 映射到宿主机3002端口，挂载其对应的配置目录</span>
<span class="token function">docker</span> run --name mysql_slave -p <span class="token number">3002</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root -v /home/chenkun/DockerConfigs/mysql-cluster/slave/mysql:/etc/mysql -d mysql:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>查看宿主机的ip,设置和master的关联（注意此处不能用localhost以及127.0.0.1，在容器中使用localhost指向的是容器而不是宿主机）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> inspect 容器id <span class="token comment">#在返回结果找ip,172.17.x.x</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>172.17.0.2是master容器的ip,slave是第7步在master建立的用户，root是密码  ，edu-mysql-bin.000003和master_log_pos是第6步查询的解雇哦</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">##记得先进入先进入slave库，在mysql命令行执行以下</span>
mysql<span class="token operator">&gt;</span> change master to <span class="token assign-left variable">master_host</span><span class="token operator">=</span><span class="token string">'172.17.0.2'</span>, <span class="token assign-left variable">master_user</span><span class="token operator">=</span><span class="token string">'slave'</span>, <span class="token assign-left variable">master_password</span><span class="token operator">=</span><span class="token string">'root'</span>, <span class="token assign-left variable">master_port</span><span class="token operator">=</span><span class="token number">3306</span>, <span class="token assign-left variable">master_log_file</span><span class="token operator">=</span><span class="token string">'edu-mysql-bin.000003'</span>, <span class="token assign-left variable">master_log_pos</span><span class="token operator">=</span><span class="token number">156</span>, <span class="token assign-left variable">master_connect_retry</span><span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>启动slave</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span>start slave<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>查看slave状态，13、14行为yes就ok了，如果连接失败在47行Slave_SQL_Running_State会报失败原因</p></li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> show slave status<span class="token punctuation">\</span>G<span class="token punctuation">;</span>
*************************** <span class="token number">1</span>. row ***************************
               Slave_IO_State: Waiting <span class="token keyword">for</span> <span class="token builtin class-name">source</span> to send event
                  Master_Host: <span class="token number">172.17</span>.0.2
                  Master_User: slave
                  Master_Port: <span class="token number">3306</span>
                Connect_Retry: <span class="token number">30</span>
              Master_Log_File: edu-mysql-bin.000003
          Read_Master_Log_Pos: <span class="token number">396</span>
               Relay_Log_File: edu-mysql-relay-bin.000002
                Relay_Log_Pos: <span class="token number">568</span>
        Relay_Master_Log_File: edu-mysql-bin.000003
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes啦v哦
              Replicate_Do_DB:
          Replicate_Ignore_DB:
           Replicate_Do_Table:
       Replicate_Ignore_Table:
      Replicate_Wild_Do_Table:
  Replicate_Wild_Ignore_Table:
                   Last_Errno: <span class="token number">0</span>
                   Last_Error:
                 Skip_Counter: <span class="token number">0</span>
          Exec_Master_Log_Pos: <span class="token number">396</span>
              Relay_Log_Space: <span class="token number">781</span>
              Until_Condition: None
               Until_Log_File:
                Until_Log_Pos: <span class="token number">0</span>
           Master_SSL_Allowed: No
           Master_SSL_CA_File:
           Master_SSL_CA_Path:
              Master_SSL_Cert:
            Master_SSL_Cipher:
               Master_SSL_Key:
        Seconds_Behind_Master: <span class="token number">0</span>
Master_SSL_Verify_Server_Cert: No
                Last_IO_Errno: <span class="token number">0</span>
                Last_IO_Error:
               Last_SQL_Errno: <span class="token number">0</span>
               Last_SQL_Error:
  Replicate_Ignore_Server_Ids:
             Master_Server_Id: <span class="token number">2</span>
                  Master_UUID: dc6dff8a-218e-11ec-b936-0242ac110002
             Master_Info_File: mysql.slave_master_info
                    SQL_Delay: <span class="token number">0</span>
          SQL_Remaining_Delay: NULL
      Slave_SQL_Running_State: Replica has <span class="token builtin class-name">read</span> all relay log<span class="token punctuation">;</span> waiting <span class="token keyword">for</span> <span class="token function">more</span> updates
           Master_Retry_Count: <span class="token number">86400</span>
                  Master_Bind:
      Last_IO_Error_Timestamp:
     Last_SQL_Error_Timestamp:
               Master_SSL_Crl:
           Master_SSL_Crlpath:
           Retrieved_Gtid_Set:
            Executed_Gtid_Set:
                Auto_Position: <span class="token number">0</span>
         Replicate_Rewrite_DB:
                 Channel_Name:
           Master_TLS_Version:
       Master_public_key_path:
        Get_master_public_key: <span class="token number">0</span>
            Network_Namespace:
<span class="token number">1</span> row <span class="token keyword">in</span> set, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><ol start="12"><li><p>测试主从同步</p> <p>在master随便加一个库看看能否自动同步到slave</p></li></ol> <h3 id="_2、使用mybatis-plus实现读写分离-mysql的主从复制是实现读写分离的基础"><a href="#_2、使用mybatis-plus实现读写分离-mysql的主从复制是实现读写分离的基础" class="header-anchor">#</a> 2、使用mybatis-plus实现读写分离（mysql的主从复制是实现读写分离的基础）</h3> <h5 id="_2-1-参考文档"><a href="#_2-1-参考文档" class="header-anchor">#</a> 2.1 参考文档</h5> <p><a href="https://mp.baomidou.com/guide/dynamic-datasource.html#%E6%96%87%E6%A1%A3-documentation" target="_blank" rel="noopener noreferrer">mybatis-plus多数据源<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h5 id="_2-2-java工程"><a href="#_2-2-java工程" class="header-anchor">#</a> 2.2 java工程</h5> <p>mybatis-plus实现多数据源特别简单，只需要引入多数据源的包，再到springboot配置文件配置一下就ok了</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dynamic-datasource-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> mybatisplus
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">dynamic</span><span class="token punctuation">:</span>
      <span class="token key atrule">primary</span><span class="token punctuation">:</span> master
      <span class="token key atrule">strict</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">master</span><span class="token punctuation">:</span>
          <span class="token comment">#    url: jdbc:mysql:///mybatis_p</span>
          <span class="token comment">#    driver-class-name: com.p6spy.engine.spy.P6SpyDriver</span>
          <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>p6spy<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3001/mybatis_p  <span class="token comment">#使用p6spy在开发环境监控，生产环境不要使用</span>
          <span class="token key atrule">username</span><span class="token punctuation">:</span> root
          <span class="token key atrule">password</span><span class="token punctuation">:</span> root
          <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.p6spy.engine.spy.P6SpyDriver
        <span class="token key atrule">slave_1</span><span class="token punctuation">:</span>
          <span class="token comment">#    url: jdbc:mysql:///mybatis_p</span>
          <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>p6spy<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3002/mybatis_p
          <span class="token key atrule">username</span><span class="token punctuation">:</span> queryUser
          <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
          <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.p6spy.engine.spy.P6SpyDriver
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h5 id="_2-3-数据库设置"><a href="#_2-3-数据库设置" class="header-anchor">#</a> 2.3 数据库设置</h5> <ol><li>在master库使用脚本创建一个数据库，会自动同步到slave</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'主键ID'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'年龄'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>email<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'邮箱'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>grade<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1443412902525784067</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_general_ci<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li><p>用管理员主那个胡登陆到slave库创建一个用户，给其设置只查询权限（和之前slave帐号是两回事）防止在slave库写入数据</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> CREATE <span class="token environment constant">USER</span> <span class="token string">'queryUser'</span>@<span class="token string">'host'</span> IDENTIFIED BY <span class="token string">'123456'</span><span class="token punctuation">;</span>  <span class="token comment"># 添加用户</span>
mysql<span class="token operator">&gt;</span> GRANT SElECT ON *.* TO <span class="token string">'queryUser'</span>@<span class="token string">'%'</span><span class="token punctuation">;</span>					<span class="token comment"># 设置查询权限</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <h5 id="_2-4-测试通过java读写分离是否成功"><a href="#_2-4-测试通过java读写分离是否成功" class="header-anchor">#</a> 2.4 测试通过java读写分离是否成功</h5> <ol><li><p>在master随便加一个user用户（会自动同步到slave）</p></li> <li><p>到slave库中用管理员用户修改一下同步过来的数据（和master进行区分，方便知道查询的哪个库）</p></li> <li><p>分别查询两个库，看看是否得到的不一样的结果。这一步用@DS(&quot;slave_1&quot;)切换到从库，<strong>注意不要在单元测试中使用@DS,不会生效的</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/slave-list&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@DS</span><span class="token punctuation">(</span><span class="token string">&quot;slave_1&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">userListSlave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/master-list&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">userListMaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>对比请求结果，发现两次查询的name不一样，说明成功了</p> <p>http://192.168.92.31:8080/slave-list 访问结果</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1443412093146714113</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;aaa.@com&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;grade&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SECONDARY&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>http://192.168.92.31:8080/master-list 访问结果</p></li></ol> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1443412093146714113</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;aaa.@com&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;grade&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SECONDARY&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="_2-5-、测试代码地址"><a href="#_2-5-、测试代码地址" class="header-anchor">#</a> 2.5 、测试代码地址</h5> <p><a href="https://github.com/chen462488588/afatpig" target="_blank" rel="noopener noreferrer">github<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">3/15/2022, 6:37:46 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/pages/555bf2/" class="prev">
            彻底理清Java中的几种代理
          </a></span> <span class="next"><a href="/docs/java/advance/ThreadPool.html">
            线程池总结
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-3" data-v-cb1513f6><a href="/pages/256670/#_1、mysql主从复制" class="sidebar-link reco-side-_1、mysql主从复制" data-v-cb1513f6>1、mysql主从复制</a></li><li class="level-3" data-v-cb1513f6><a href="/pages/256670/#_2、使用mybatis-plus实现读写分离-mysql的主从复制是实现读写分离的基础" class="sidebar-link reco-side-_2、使用mybatis-plus实现读写分离-mysql的主从复制是实现读写分离的基础" data-v-cb1513f6>2、使用mybatis-plus实现读写分离（mysql的主从复制是实现读写分离的基础）</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.a73c779d.js" defer></script><script src="/assets/js/3.0f19326b.js" defer></script><script src="/assets/js/1.7c96b034.js" defer></script><script src="/assets/js/41.9d8cf17e.js" defer></script>
  </body>
</html>
