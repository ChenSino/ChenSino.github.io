---
title: 网络设置
date: 2024-03-22
author: chensino
publish: true
isOriginal: true
---

本篇介绍我的网络配置过程,如何获得公网ip,以及升级我的家庭路由,mesh组网，我的网络是湖北电信500m，光猫一开始是天翼网关3.0，
后来咸鱼买了一个二手的4.0的花了50，曾打电话给电信客服升级4.0的是不是免费，他说199元。
家庭组网章节适合所有用户阅读，公网部分适合程序员朋友参考。

## 家庭组网

### 为什么要组网

    我家套内93平，一个无线路由器无法覆盖整个房间，起初是在每个房间放一个路由器，每次从一个房间到另一房间都要切换网络，即使手机有
    自动切换网络功能，但是总是不丝滑，我想做到wifi切换无感知，所以就生出组网的想法。

### 家庭网线图

下图我虽然在每个房间留了网口，但是电信的猫只有3个网口，还有一个是iptv的口，所以我有个房间是用不了（确实有需要的可以加交换机）

![20240322142629](https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/20240322142629.png)

网上的组网教程比较多，会让你看的眼花缭乱，并且有的组网是要求你预埋网线，并且走线还有要求，比如如果你想通过有线组网，那么你的各个网孔节点要能实现串联，就是“有线回程”，这个是
组网效果最好的，另外还有各种无线组网等的等，但是我的网线布局是从弱电箱分别分一个网口到各个房间，并没有串联，我想90%的家庭装修应该都是这样留的。如果你这种走线有个简单的方法实现组网，
可以使用电信的elink协议实现组网，天翼网关3.0以及4.0都有这个功能，你要做的就是买几个电信路由器直接插在光猫的网口，注意别插到iptv的口了，至于需要几个，根据自己的情况，一般情况下买
两个就够了，我是在咸鱼买的二手路由器，tplink和电信合作的（型号wta301 ax3000 支持wifi6+），60块钱买的。

所以组网后我家实际拓扑图如下，买了两个二手的wta301总共花了120，实现全屋wifi漫游

![20240322144108](https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/20240322144108.png)

wta301设置也比较简单，买回来后先重置一下，再用网线到光猫，然后手机连接到它发射的wifi根据提示设置elink组网就行了，设置好以后手机
会掉线，因为天翼网关会把主路由的wifi名字同步过来，两个wta301设置方式一样，组网完成以后整个家里形成一主两副的拓扑结构，一共三个无线
路由器，120平的房间够用了。

## 桥接拨号还是光猫拨号

一开始我不知道光猫下直连几个路由器也可以组网，所以我一直在研究自己的路由器桥接到光猫，然后拨号，但是一直没搞定，一直无法进入天翼网关的超级管理界面，
只能进入普通路由器设置界面。后来无意间从咸鱼买了一个4.0版本的网关，神奇的是它居然可以直接进入管理界面，也不像网上说的超级管理员密码是动态变化的，
就很神奇。后来发现电信本身elink也可以组网，我就没有折腾桥接拨号了

## 开通公网

:::note
    公网适合有主机的朋友折腾，如果你仅仅是用一个nas，家庭影院简单看看电影，感觉没必要折腾，耗时耗力。
:::

我的网络是湖北电信,打电话给客服要求开通公网,客户问你干嘛,你就说家庭nas,我打完电话就给我开了,包括ipv4和ipv6公网。
开通公网后可以在外面访问到家里的服务，对我个人而言，我有一个小mini主机，在上面部署了各种服务，家庭影院、nas、博客、
chatgpt等等，我开外网就可以随时访问，比较方便，有时候晚上没看完的电影，在公司午休的时候还可以接着看，以下是我的几个
服务：

![20240322145826](https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/20240322145826.png)

### ipv4玩法

#### 申请一个ddns

众所周知，ipv4地址是很稀缺的，所以运营商即使给你开通了公网ip，也不会给你一个固定ip，它是一直i动态变化的，隔几天就要变，这对我们外网访问
很不友好，所以你需要一个ddns，它的作用就是把你的动态的ip和一个域名绑定，其实原理也很简单，就是一直轮询，定时发送你的ip到ddns运营商，然后
进行绑定。最简单的ddns就是买个带ddns的路由器，tplink一般都有，或者你自己找一个免费ddns运营商，我用的是dynv6他家的，免费的，自己写了一个
脚本定时获取我本地的ip发送到服务器进行绑定。

### ipv6玩法

我的ipv6地址是固定的，天翼网关4.0里面可以设置ipv6前缀，然后在客户端（你的服务器）绑定一个ipv6地址，这个我依然用的是ddns，毕竟免费，如果要
绑定到一个标准域名还得备案，麻烦

要想使用ipv6从外部访问到家里的服务器，需要天翼网关4.0关闭ipv6防火墙，这里切忌要把服务器防火墙打开，不必要的端口一律关闭访问权限，一旦在天翼
网关关闭了防火墙，那么你的电脑如果通过ipv6联网，那么它就暴露在公网之上了，所有的人都可以直接访问你的电脑了，所以如果关闭天翼网关这道防火墙，务必
把电脑本身防火墙开启，不然就是裸奔。

天翼网关4.0关闭ipv6防火墙的方法（前提是你已经能进入超级管理页面）：

访问你的路由管理页面192.168.1.1，点击快速装维入口，输入超级管理员的账号密码登录：

![20240322151706](https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/20240322151706.png)

登录后，点击安全---防火墙----ipv6防火墙：

![20240322151834](https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/20240322151834.png)

正常情况下你的 “使能IPv6防火墙控制转发报文”是勾选上的，我们要给他去掉勾选，但是它是灰色的，无法点击，所以需要懂点前端知识，
也比较简单，按F12（或者ctrl+shift+i）打开浏览器调试界面，使用元素选择器定位到复选框以及“应用”按钮，把disabled去掉，然后就可以点击应用了。

![20240322152203](https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/20240322152203.png)

然后让天翼网关给客户端分配ipv6地址，设置如下，主要是前缀来源选择static，启用dhcpv6就行了，其他你的界面是什么不重要，不要动它。

![20240322152428](https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/20240322152428.png)