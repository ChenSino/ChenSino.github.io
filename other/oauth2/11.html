<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.31" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://ChenSino.github.io/other/oauth2/11.html"><meta property="og:site_name" content="ChenSino"><meta property="og:title" content="11 | å®æˆ˜æ¡ˆä¾‹ï¼šä½¿ç”¨Spring Securityæ­å»ºä¸€å¥—åŸºäºJWTçš„OAuth 2.0æ¶æ„"><meta property="og:description" content="ä½ å¥½ï¼Œæˆ‘æœ±æ™”ï¼Œæ˜¯ã€ŠJava ä¸šåŠ¡å¼€å‘å¸¸è§é”™è¯¯ 100 ä¾‹ã€‹ä¸“æ è¯¾ç¨‹çš„ä½œè€…ã€‚ ã€ŠOAuth 2.0 å®æˆ˜è¯¾ã€‹ä¸Šçº¿ä¹‹åï¼Œæˆ‘ä¹Ÿç¬¬ä¸€æ—¶é—´å…³æ³¨äº†è¿™é—¨è¯¾ã€‚åœ¨å¼€ç¯‡è¯ä¸­ï¼Œæˆ‘çœ‹åˆ°æœ‰ä¸€äº›åŒå­¦ç•™è¨€é—®é“ï¼šâ€œå¦‚ä½•ä½¿ç”¨ Spring Security æ¥å®ç° OAuth 2.0ï¼Ÿâ€è¿™æ—¶ï¼Œæˆ‘æƒ³åˆ°ä¹‹å‰è‡ªå·±å†™è¿‡ä¸€ç¯‡ç›¸å…³çš„æ–‡ç« ï¼Œäºæ˜¯å°±ç›´æ¥åœ¨å¼€ç¯‡è¯ä¸‹ç•™äº†è¨€ã€‚åé¢æˆ‘å¾ˆå¿«æ”¶åˆ°äº†ä¸å°‘ç”¨æˆ·çš„ç‚¹èµå’Œ..."><meta property="og:type" content="article"><meta property="og:image" content="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/18cd7b24ff152e28806b1176b0a560e4.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2022-11-08T08:17:56.000Z"><meta property="article:author" content="ChenSino"><meta property="article:published_time" content="2022-11-08T00:00:00.000Z"><meta property="article:modified_time" content="2022-11-08T08:17:56.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"11 | å®æˆ˜æ¡ˆä¾‹ï¼šä½¿ç”¨Spring Securityæ­å»ºä¸€å¥—åŸºäºJWTçš„OAuth 2.0æ¶æ„","image":["https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/18cd7b24ff152e28806b1176b0a560e4.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/8e4c2dd1931a31197df55cc251b2a07e.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/4d701319144d3de7c5d743f59e4991ae.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/4d701319144d3de7c5d743f59e4991ae.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/2835c0d2b49ac515c9f6c537dd2f7195.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/81722855fd6935aea594ec62b64bf0e9.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/fcf2b1c1a53ecc33d3a0abc72b6d83da.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/ce391c3c93e2131e1cf8fb4e3324b66f.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/73c3bd926e4e350b220447cd8b97d811.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/9cac3b06b632220166d7e43607da4901.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/9e942cc7c22ff8b4540e9f6736d56b6f.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/eff235ff90aafb559d6e45b07a4d173e.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/ea401694bf55f83353f7db65d17ab6d7.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/7646fe1e6e4cc9914f79881576126459.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/3b22a89392c92187960aecd4bc3cf8f6.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/0606fbb094de245d346ed17d9yycd6d5.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/a71bcef74da7577aa1529bf2d9546588.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/a754a6fdcb9666e07f1b820052a4e2fc.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/05b76f316304e3ef2d1494bae501c381.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/7d24bc73267506c15f9feyy546557237.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/7a50619ace3e40c8ff7c0aa860f11246.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/016f28b7161d2c600197aa2392b0de27.png","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/yy2bca66c45cefa56d2d727c3a136a84.png"],"datePublished":"2022-11-08T00:00:00.000Z","dateModified":"2022-11-08T08:17:56.000Z","author":[{"@type":"Person","name":"ChenSino"}]}</script><title>11 | å®æˆ˜æ¡ˆä¾‹ï¼šä½¿ç”¨Spring Securityæ­å»ºä¸€å¥—åŸºäºJWTçš„OAuth 2.0æ¶æ„ | ChenSino</title><meta name="description" content="ä½ å¥½ï¼Œæˆ‘æœ±æ™”ï¼Œæ˜¯ã€ŠJava ä¸šåŠ¡å¼€å‘å¸¸è§é”™è¯¯ 100 ä¾‹ã€‹ä¸“æ è¯¾ç¨‹çš„ä½œè€…ã€‚ ã€ŠOAuth 2.0 å®æˆ˜è¯¾ã€‹ä¸Šçº¿ä¹‹åï¼Œæˆ‘ä¹Ÿç¬¬ä¸€æ—¶é—´å…³æ³¨äº†è¿™é—¨è¯¾ã€‚åœ¨å¼€ç¯‡è¯ä¸­ï¼Œæˆ‘çœ‹åˆ°æœ‰ä¸€äº›åŒå­¦ç•™è¨€é—®é“ï¼šâ€œå¦‚ä½•ä½¿ç”¨ Spring Security æ¥å®ç° OAuth 2.0ï¼Ÿâ€è¿™æ—¶ï¼Œæˆ‘æƒ³åˆ°ä¹‹å‰è‡ªå·±å†™è¿‡ä¸€ç¯‡ç›¸å…³çš„æ–‡ç« ï¼Œäºæ˜¯å°±ç›´æ¥åœ¨å¼€ç¯‡è¯ä¸‹ç•™äº†è¨€ã€‚åé¢æˆ‘å¾ˆå¿«æ”¶åˆ°äº†ä¸å°‘ç”¨æˆ·çš„ç‚¹èµå’Œ...">
    <link rel="preload" href="/assets/style-CIxWDlQE.css" as="style"><link rel="stylesheet" href="/assets/style-CIxWDlQE.css">
    <link rel="modulepreload" href="/assets/app-Cs38sdJl.js"><link rel="modulepreload" href="/assets/11.html-CerYIfrP.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-037NXhwR.js" as="script"><link rel="prefetch" href="/assets/home.html-TM3qyuC9.js" as="script"><link rel="prefetch" href="/assets/slide.html-D_ObUdYy.js" as="script"><link rel="prefetch" href="/assets/index.html-qoFKOXCJ.js" as="script"><link rel="prefetch" href="/assets/å»ºé€ è€…æ¨¡å¼.html-DVZq7hmo.js" as="script"><link rel="prefetch" href="/assets/æ¨¡æ¿æ–¹æ³•æ¨¡å¼.html-Bz0Sfn-C.js" as="script"><link rel="prefetch" href="/assets/ç­–ç•¥æ¨¡å¼.html-BYZrIt7T.js" as="script"><link rel="prefetch" href="/assets/è£…é¥°æ¨¡å¼.html-Cr2v-D7q.js" as="script"><link rel="prefetch" href="/assets/è´£ä»»é“¾æ¨¡å¼.html-BudxvRxz.js" as="script"><link rel="prefetch" href="/assets/index.html-B3CVcNmY.js" as="script"><link rel="prefetch" href="/assets/index.html-CO8SxG_n.js" as="script"><link rel="prefetch" href="/assets/disable.html-BN61wYHt.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-p_zRl7yM.js" as="script"><link rel="prefetch" href="/assets/markdown.html-CRAiLFzA.js" as="script"><link rel="prefetch" href="/assets/page.html-iyjtBsLH.js" as="script"><link rel="prefetch" href="/assets/index.html-CvtZs12C.js" as="script"><link rel="prefetch" href="/assets/index.html-v51-OoAV.js" as="script"><link rel="prefetch" href="/assets/index.html-CEaRBcG1.js" as="script"><link rel="prefetch" href="/assets/1.html-CzXP54Z6.js" as="script"><link rel="prefetch" href="/assets/2.html-r4Tju-Bl.js" as="script"><link rel="prefetch" href="/assets/index.html-DoV_7Tzp.js" as="script"><link rel="prefetch" href="/assets/index.html-BUzB9aAv.js" as="script"><link rel="prefetch" href="/assets/aboutAsync.html-vL4oFR6v.js" as="script"><link rel="prefetch" href="/assets/aboutEvent.html-CdQlPenM.js" as="script"><link rel="prefetch" href="/assets/aboutThis.html-DC1OQ0cP.js" as="script"><link rel="prefetch" href="/assets/asyncError.html-DZgHvkvs.js" as="script"><link rel="prefetch" href="/assets/crossDomain.html-B0XpYwHd.js" as="script"><link rel="prefetch" href="/assets/crossDomain2.html-O8Z_ko0n.js" as="script"><link rel="prefetch" href="/assets/lazyLoad.html-hvebH1EU.js" as="script"><link rel="prefetch" href="/assets/throttle.html-JTGiCNYR.js" as="script"><link rel="prefetch" href="/assets/index.html-BflHFO6N.js" as="script"><link rel="prefetch" href="/assets/jsä¸­æ•´æ•°çš„æœ€å¤§å€¼.html-DOa4eXjX.js" as="script"><link rel="prefetch" href="/assets/promise.html-DZg1FHK-.js" as="script"><link rel="prefetch" href="/assets/useModule.html-BwiJryzG.js" as="script"><link rel="prefetch" href="/assets/useNpm.html-BRhFow3T.js" as="script"><link rel="prefetch" href="/assets/usePnpm.html-iUG8MIzM.js" as="script"><link rel="prefetch" href="/assets/useYarn.html-Cqxxoelb.js" as="script"><link rel="prefetch" href="/assets/index.html-BF3xLdM2.js" as="script"><link rel="prefetch" href="/assets/action-usage.html-j3OmgQ1N.js" as="script"><link rel="prefetch" href="/assets/axios.html-CfGgtQRK.js" as="script"><link rel="prefetch" href="/assets/basic-usage.html-CwmSXYKP.js" as="script"><link rel="prefetch" href="/assets/fanType.html-Ieer0drS.js" as="script"><link rel="prefetch" href="/assets/tsAndvue3.html-ciCREPdy.js" as="script"><link rel="prefetch" href="/assets/index.html-DonN2FVb.js" as="script"><link rel="prefetch" href="/assets/index.html-BK2a59AC.js" as="script"><link rel="prefetch" href="/assets/eventBus.html-C3vZuJgT.js" as="script"><link rel="prefetch" href="/assets/vue-Direactive.html-BKQcqbAJ.js" as="script"><link rel="prefetch" href="/assets/vue-authority.html-DqlF9WCO.js" as="script"><link rel="prefetch" href="/assets/vue-in-action.html-C0NR5Coj.js" as="script"><link rel="prefetch" href="/assets/vue-nextTick.html-TMYWbTf9.js" as="script"><link rel="prefetch" href="/assets/vue-pic.html-CdCRMkNC.js" as="script"><link rel="prefetch" href="/assets/vue-router1.html-sKWUT9zW.js" as="script"><link rel="prefetch" href="/assets/vue-router2.html-eSduR2z0.js" as="script"><link rel="prefetch" href="/assets/vue3Emit.html-CTEeNthx.js" as="script"><link rel="prefetch" href="/assets/vue3LifeTime.html-Csna2gVT.js" as="script"><link rel="prefetch" href="/assets/vueExtend.html-C4olEF5a.js" as="script"><link rel="prefetch" href="/assets/Arthas.html-D90Cthy9.js" as="script"><link rel="prefetch" href="/assets/Collection.html-BwHOCi5I.js" as="script"><link rel="prefetch" href="/assets/CompileJdk11.html-svfbaUYc.js" as="script"><link rel="prefetch" href="/assets/Concurrent.html-Ci3xTqeF.js" as="script"><link rel="prefetch" href="/assets/Future.html-DRTDTVED.js" as="script"><link rel="prefetch" href="/assets/IO-Model.html-DWw5j237.js" as="script"><link rel="prefetch" href="/assets/IO-model1.html-Bm1y8xza.js" as="script"><link rel="prefetch" href="/assets/ImplementSameInterface.html-C1Qn8hnQ.js" as="script"><link rel="prefetch" href="/assets/MysqlMasterSlave.html-Bn7YTXeZ.js" as="script"><link rel="prefetch" href="/assets/NativeMethod.html-DAd0jEVq.js" as="script"><link rel="prefetch" href="/assets/ParentDelegationClassLoader.html-DMlTj9WG.js" as="script"><link rel="prefetch" href="/assets/ProxyInJava.html-BVsPidbx.js" as="script"><link rel="prefetch" href="/assets/index.html-CBJZv3_I.js" as="script"><link rel="prefetch" href="/assets/Synchronized.html-CRzd_uDM.js" as="script"><link rel="prefetch" href="/assets/ThreadLocal.html-QebANZ5Q.js" as="script"><link rel="prefetch" href="/assets/ThreadPool.html-CHojiIVb.js" as="script"><link rel="prefetch" href="/assets/io.html-DXnUS2XQ.js" as="script"><link rel="prefetch" href="/assets/ConstantPool.html-Bi4gRMd0.js" as="script"><link rel="prefetch" href="/assets/CustomLRU.html-DA-5cM8I.js" as="script"><link rel="prefetch" href="/assets/IntegerConstantPool.html-DbaJcFQx.js" as="script"><link rel="prefetch" href="/assets/index.html-DInKQxUZ.js" as="script"><link rel="prefetch" href="/assets/Serialization.html-Sb37Y7_j.js" as="script"><link rel="prefetch" href="/assets/String.html-AvdIbTn7.js" as="script"><link rel="prefetch" href="/assets/ClassLoader.html-BlGPppNa.js" as="script"><link rel="prefetch" href="/assets/MemoryModel.html-DeuwBbba.js" as="script"><link rel="prefetch" href="/assets/NewObject.html-DxXhkugo.js" as="script"><link rel="prefetch" href="/assets/ObjectReference.html-A6MGepPx.js" as="script"><link rel="prefetch" href="/assets/index.html-C0hOPUD8.js" as="script"><link rel="prefetch" href="/assets/SetObjectNull.html-C6RSXgE-.js" as="script"><link rel="prefetch" href="/assets/StringAdd.html-xTQxhRpy.js" as="script"><link rel="prefetch" href="/assets/volatile.html-2_FfdPb-.js" as="script"><link rel="prefetch" href="/assets/JdkVersion.html-NmLTolUG.js" as="script"><link rel="prefetch" href="/assets/index.html-C6-kYBpT.js" as="script"><link rel="prefetch" href="/assets/index.html-CwWS6Mge.js" as="script"><link rel="prefetch" href="/assets/ebooks.html-lso4L_C5.js" as="script"><link rel="prefetch" href="/assets/TCP-IP.html-Bsm-eyhg.js" as="script"><link rel="prefetch" href="/assets/CPUOverLoad.html-Dld0f6vb.js" as="script"><link rel="prefetch" href="/assets/MysqlCollate.html-C2oYVbL_.js" as="script"><link rel="prefetch" href="/assets/MysqlNote.html-Bv926dzs.js" as="script"><link rel="prefetch" href="/assets/MysqlRemoteConnect.html-DHf_evF4.js" as="script"><link rel="prefetch" href="/assets/index.html-X9LmZ3Sw.js" as="script"><link rel="prefetch" href="/assets/Recurse.html-BWMs80-1.js" as="script"><link rel="prefetch" href="/assets/SQLOptimization.html-B3-uylgO.js" as="script"><link rel="prefetch" href="/assets/DistributeLock.html-DcWhYNfX.js" as="script"><link rel="prefetch" href="/assets/Nacos.html-BSrktywy.js" as="script"><link rel="prefetch" href="/assets/index.html-D19PEsSt.js" as="script"><link rel="prefetch" href="/assets/Docker.html-BmS0ibtd.js" as="script"><link rel="prefetch" href="/assets/ServiceInstall.html-Z8opbfBK.js" as="script"><link rel="prefetch" href="/assets/2022-04-12.html-B5PKYyjF.js" as="script"><link rel="prefetch" href="/assets/BTree.html-buyVbzcg.js" as="script"><link rel="prefetch" href="/assets/CDN.html-BHny2PFi.js" as="script"><link rel="prefetch" href="/assets/ChromeDevTools.html-DX4X6h_8.js" as="script"><link rel="prefetch" href="/assets/CloudService.html-DOhS-qqj.js" as="script"><link rel="prefetch" href="/assets/DeployGithubPage.html-B7db5I40.js" as="script"><link rel="prefetch" href="/assets/GreatWallProxy.html-DbxIPb5b.js" as="script"><link rel="prefetch" href="/assets/Jenkins.html-BQcXUwsh.js" as="script"><link rel="prefetch" href="/assets/index.html-DyfKxzbe.js" as="script"><link rel="prefetch" href="/assets/Service.html-BHVESlTL.js" as="script"><link rel="prefetch" href="/assets/TyporaPicgo.html-CEoR1KNu.js" as="script"><link rel="prefetch" href="/assets/BatchDeleteGitHubRepo.html-CwlRwF9F.js" as="script"><link rel="prefetch" href="/assets/GitCommands.html-CNSgiDiO.js" as="script"><link rel="prefetch" href="/assets/index.html-CV6zdk6b.js" as="script"><link rel="prefetch" href="/assets/branch01.html-CjKxvE0x.js" as="script"><link rel="prefetch" href="/assets/branch02.html-Bs0XU6W6.js" as="script"><link rel="prefetch" href="/assets/fatal.html-C_y_z6VF.js" as="script"><link rel="prefetch" href="/assets/gitConflict.html-DpWsJVkZ.js" as="script"><link rel="prefetch" href="/assets/gitRebase.html-CdwDL6IC.js" as="script"><link rel="prefetch" href="/assets/gitwork.html-De1_B9E-.js" as="script"><link rel="prefetch" href="/assets/mergeBranch.html-sjBU1VG4.js" as="script"><link rel="prefetch" href="/assets/proxy.html-CiJNIT50.js" as="script"><link rel="prefetch" href="/assets/rebaseAndMerge.html-B4O72TPO.js" as="script"><link rel="prefetch" href="/assets/reset.html-Dpcf7a21.js" as="script"><link rel="prefetch" href="/assets/stash.html-DDQ-Vwvv.js" as="script"><link rel="prefetch" href="/assets/CPU.html-MGD58Kd6.js" as="script"><link rel="prefetch" href="/assets/CentOS.html-CUGT4eY4.js" as="script"><link rel="prefetch" href="/assets/CommonUsedCMD.html-BxFELV-s.js" as="script"><link rel="prefetch" href="/assets/Curl.html-CvZVIk5u.js" as="script"><link rel="prefetch" href="/assets/InstallMysqlWithDocker.html-BVYjc5uf.js" as="script"><link rel="prefetch" href="/assets/Manjaro.html-D_rh3eIH.js" as="script"><link rel="prefetch" href="/assets/MountDisk.html-B32zOiO8.js" as="script"><link rel="prefetch" href="/assets/MultiNetworkCard.html-y2DFjD73.js" as="script"><link rel="prefetch" href="/assets/index.html-DHjyqm8t.js" as="script"><link rel="prefetch" href="/assets/Samba.html-BmrokcZk.js" as="script"><link rel="prefetch" href="/assets/ShareBetweenWindowsAndLinux.html-CBVUfgsM.js" as="script"><link rel="prefetch" href="/assets/TcpDump.html-CKkO3CJO.js" as="script"><link rel="prefetch" href="/assets/Wifi.html-B2dy8DTF.js" as="script"><link rel="prefetch" href="/assets/firewall.html-p6_H9GBp.js" as="script"><link rel="prefetch" href="/assets/wsl.html-BygKf5nP.js" as="script"><link rel="prefetch" href="/assets/index.html-d7UFkRKA.js" as="script"><link rel="prefetch" href="/assets/01.html-BQvcet4Q.js" as="script"><link rel="prefetch" href="/assets/02.html-DglioaTH.js" as="script"><link rel="prefetch" href="/assets/03.html-sYx4IyyI.js" as="script"><link rel="prefetch" href="/assets/04.html-Dnbu5DPj.js" as="script"><link rel="prefetch" href="/assets/05.html-BBx8smMU.js" as="script"><link rel="prefetch" href="/assets/06.html-B2VuXqs2.js" as="script"><link rel="prefetch" href="/assets/07.html-JzEtSxeD.js" as="script"><link rel="prefetch" href="/assets/08.html-B-dI4VI2.js" as="script"><link rel="prefetch" href="/assets/09.html-DIwVSc7D.js" as="script"><link rel="prefetch" href="/assets/10.html-DhjH576d.js" as="script"><link rel="prefetch" href="/assets/12.html-BDb1MVf9.js" as="script"><link rel="prefetch" href="/assets/13.html-U9h-NApa.js" as="script"><link rel="prefetch" href="/assets/14.html-CjRMjqWo.js" as="script"><link rel="prefetch" href="/assets/index.html-DN2HsHYF.js" as="script"><link rel="prefetch" href="/assets/index.html-CotFs2eZ.js" as="script"><link rel="prefetch" href="/assets/ç ´è§£è½¯ä»¶.html-DOnaB9xU.js" as="script"><link rel="prefetch" href="/assets/SUC.html-IoAuwkbQ.js" as="script"><link rel="prefetch" href="/assets/Idea.html-DugwieqB.js" as="script"><link rel="prefetch" href="/assets/index.html-D3H50Vne.js" as="script"><link rel="prefetch" href="/assets/SoftWare.html-DLULHtV9.js" as="script"><link rel="prefetch" href="/assets/VsCode.html-CSyNlpHv.js" as="script"><link rel="prefetch" href="/assets/CloudServiceTraining.html-Djk9hAB0.js" as="script"><link rel="prefetch" href="/assets/index.html-CLV5wWxF.js" as="script"><link rel="prefetch" href="/assets/SSO.html-CHDng92K.js" as="script"><link rel="prefetch" href="/assets/UserService.html-q5xQ-vbC.js" as="script"><link rel="prefetch" href="/assets/draw.html-BbeE6vcR.js" as="script"><link rel="prefetch" href="/assets/ç”¨æœbomç³»ç»Ÿ.html-BWv48FUl.js" as="script"><link rel="prefetch" href="/assets/BuildWebProject.html-CX-UlzVv.js" as="script"><link rel="prefetch" href="/assets/Cookie.html-B-VfHTG8.js" as="script"><link rel="prefetch" href="/assets/Http.html-_MMuiYWN.js" as="script"><link rel="prefetch" href="/assets/Jwt.html-BNzquB6I.js" as="script"><link rel="prefetch" href="/assets/OAUTH_LOGIN.html-CCFYRTR1.js" as="script"><link rel="prefetch" href="/assets/index.html-CL5_NCSi.js" as="script"><link rel="prefetch" href="/assets/RefreshToken.html-Hp0wuKwS.js" as="script"><link rel="prefetch" href="/assets/Restful.html-Bcj9c05M.js" as="script"><link rel="prefetch" href="/assets/MybatisPlusDataSource.html-BRmPgTTx.js" as="script"><link rel="prefetch" href="/assets/index.html-bLlX8kWc.js" as="script"><link rel="prefetch" href="/assets/mybatis.html-RpKVQbhZ.js" as="script"><link rel="prefetch" href="/assets/Authorization.html-iofOklLd.js" as="script"><link rel="prefetch" href="/assets/CustomAuthenticationProvider.html-suyiC0vD.js" as="script"><link rel="prefetch" href="/assets/CustomLoginPage.html-CRD6r_N-.js" as="script"><link rel="prefetch" href="/assets/CustomTokenAuthentication.html-DtRwkGDF.js" as="script"><link rel="prefetch" href="/assets/OAuth2Authentication.html-A5YxurRe.js" as="script"><link rel="prefetch" href="/assets/OncePerRequestFilter.html-DarFJUpW.js" as="script"><link rel="prefetch" href="/assets/PreAuthorize.html-CISa6OUO.js" as="script"><link rel="prefetch" href="/assets/index.html-Cr1xYQVG.js" as="script"><link rel="prefetch" href="/assets/SSO.html-DIf9dOSR.js" as="script"><link rel="prefetch" href="/assets/SecurityFilterChain.html-DHcq5pOG.js" as="script"><link rel="prefetch" href="/assets/Session.html-dUNZXL0e.js" as="script"><link rel="prefetch" href="/assets/note.html-CuUeNbmo.js" as="script"><link rel="prefetch" href="/assets/spring-security-oauth2-authorization-server.html-nJOZWwYZ.js" as="script"><link rel="prefetch" href="/assets/Annotation.html-D-eM9ksH.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor.html-_7nDVpWu.js" as="script"><link rel="prefetch" href="/assets/CircularDependency.html-BYgucym4.js" as="script"><link rel="prefetch" href="/assets/DesignPatternInSpring.html-CCDji3GN.js" as="script"><link rel="prefetch" href="/assets/OncePerRequestFilter.html-D04uNlu1.js" as="script"><link rel="prefetch" href="/assets/index.html-CaEzVj8L.js" as="script"><link rel="prefetch" href="/assets/SpringAOP.html-CrKq2xPP.js" as="script"><link rel="prefetch" href="/assets/SpringCache.html-Ba54VKDx.js" as="script"><link rel="prefetch" href="/assets/SpringExtensionPoint.html-fzEuvRii.js" as="script"><link rel="prefetch" href="/assets/SpringIOC.html-ClT6-S7y.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-CdgV-wXt.js" as="script"><link rel="prefetch" href="/assets/SpringSourceAnalize.html-ClA91YOB.js" as="script"><link rel="prefetch" href="/assets/Validator.html-B4rhWxaQ.js" as="script"><link rel="prefetch" href="/assets/AOPLog.html-C4uHFG9z.js" as="script"><link rel="prefetch" href="/assets/CollectionInject.html-BP3p7e8W.js" as="script"><link rel="prefetch" href="/assets/Http2.html-W0dRorZl.js" as="script"><link rel="prefetch" href="/assets/index.html-aIOqteOY.js" as="script"><link rel="prefetch" href="/assets/SpringBootAutoConfiguration.html-DHd7IWnQ.js" as="script"><link rel="prefetch" href="/assets/Swagger.html-Bmy100Nt.js" as="script"><link rel="prefetch" href="/assets/éƒ¨ç½².html-CBCjjl7v.js" as="script"><link rel="prefetch" href="/assets/SpringCloudGateway.html-BCvrWrCp.js" as="script"><link rel="prefetch" href="/assets/index.html-C9y4P83F.js" as="script"><link rel="prefetch" href="/assets/wrapper.html-DRw6T63D.js" as="script"><link rel="prefetch" href="/assets/index.html-oTjvjxtI.js" as="script"><link rel="prefetch" href="/assets/TooManyOpenFiles.html-B1mo3lJ4.js" as="script"><link rel="prefetch" href="/assets/Undertow.xxxNotFount.html-B36MlGIe.js" as="script"><link rel="prefetch" href="/assets/å„ç§æ¡†æ¶ç‰ˆæœ¬çš„å‘.html-BtXEFgm3.js" as="script"><link rel="prefetch" href="/assets/å„ç§é—®é¢˜.html-Oe9fNdIN.js" as="script"><link rel="prefetch" href="/assets/logback.html-dwW91qwK.js" as="script"><link rel="prefetch" href="/assets/index.html-OyEmDRzQ.js" as="script"><link rel="prefetch" href="/assets/buildæ ‡ç­¾.html-DLLmjd3o.js" as="script"><link rel="prefetch" href="/assets/import.html-CsQKTzX0.js" as="script"><link rel="prefetch" href="/assets/multiModule.html-O1Y0LcXI.js" as="script"><link rel="prefetch" href="/assets/problem.html-B3KHRMas.js" as="script"><link rel="prefetch" href="/assets/ç”Ÿå‘½å‘¨æœŸ.html-BzUVW8Ts.js" as="script"><link rel="prefetch" href="/assets/404.html-CU140ziM.js" as="script"><link rel="prefetch" href="/assets/index.html-Dn7rMbVQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DXP36Xqi.js" as="script"><link rel="prefetch" href="/assets/index.html-gNCLwPok.js" as="script"><link rel="prefetch" href="/assets/index.html-C_j3fvyI.js" as="script"><link rel="prefetch" href="/assets/index.html-BBslSSGT.js" as="script"><link rel="prefetch" href="/assets/index.html-39lKWLoM.js" as="script"><link rel="prefetch" href="/assets/index.html-B3qo8lLI.js" as="script"><link rel="prefetch" href="/assets/index.html-CTaT1Afk.js" as="script"><link rel="prefetch" href="/assets/index.html-DX1wDgrK.js" as="script"><link rel="prefetch" href="/assets/index.html-CyNALyNq.js" as="script"><link rel="prefetch" href="/assets/index.html-BLrXpjKW.js" as="script"><link rel="prefetch" href="/assets/index.html-DdxIk1ic.js" as="script"><link rel="prefetch" href="/assets/index.html-Bcp3kArb.js" as="script"><link rel="prefetch" href="/assets/index.html-CBglL-1z.js" as="script"><link rel="prefetch" href="/assets/index.html-Bpo3Q0WY.js" as="script"><link rel="prefetch" href="/assets/index.html-URllbDtb.js" as="script"><link rel="prefetch" href="/assets/index.html-rtyDe0se.js" as="script"><link rel="prefetch" href="/assets/index.html-CKmnC3m0.js" as="script"><link rel="prefetch" href="/assets/index.html-BOdcicIE.js" as="script"><link rel="prefetch" href="/assets/index.html-CnWmNUA9.js" as="script"><link rel="prefetch" href="/assets/index.html-DdFNHPNP.js" as="script"><link rel="prefetch" href="/assets/index.html-C9Gq7WTp.js" as="script"><link rel="prefetch" href="/assets/index.html-BL-4oTq6.js" as="script"><link rel="prefetch" href="/assets/index.html-C92D_vZ-.js" as="script"><link rel="prefetch" href="/assets/index.html-B_IrK4jm.js" as="script"><link rel="prefetch" href="/assets/index.html-DngsrJq8.js" as="script"><link rel="prefetch" href="/assets/index.html-yFtXpxn1.js" as="script"><link rel="prefetch" href="/assets/index.html-BlDFUPXR.js" as="script"><link rel="prefetch" href="/assets/index.html-CjdKHbnQ.js" as="script"><link rel="prefetch" href="/assets/index.html-D3cJLqRl.js" as="script"><link rel="prefetch" href="/assets/index.html-D2VoWMfG.js" as="script"><link rel="prefetch" href="/assets/index.html-B8FJ-FVL.js" as="script"><link rel="prefetch" href="/assets/index.html-C6YWMTUY.js" as="script"><link rel="prefetch" href="/assets/index.html-BAVZVYzs.js" as="script"><link rel="prefetch" href="/assets/index.html-c2I4Ciyn.js" as="script"><link rel="prefetch" href="/assets/index.html-BP1CQFrt.js" as="script"><link rel="prefetch" href="/assets/index.html-BA7F0BUW.js" as="script"><link rel="prefetch" href="/assets/index.html-DDXlWYbI.js" as="script"><link rel="prefetch" href="/assets/index.html-cTFsV8MB.js" as="script"><link rel="prefetch" href="/assets/index.html-hM-0nSMd.js" as="script"><link rel="prefetch" href="/assets/index.html-5dmUOavy.js" as="script"><link rel="prefetch" href="/assets/index.html-5dmUOavy.js" as="script"><link rel="prefetch" href="/assets/index.html-cTFsV8MB.js" as="script"><link rel="prefetch" href="/assets/index.html-hU8dqH8n.js" as="script"><link rel="prefetch" href="/assets/index.html-BDgUJoIJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DpPtaNnU.js" as="script"><link rel="prefetch" href="/assets/index.html-DPL1jTg-.js" as="script"><link rel="prefetch" href="/assets/index.html-DbsHWWvr.js" as="script"><link rel="prefetch" href="/assets/index.html-D_awEXpO.js" as="script"><link rel="prefetch" href="/assets/index.html-Bph6lp8z.js" as="script"><link rel="prefetch" href="/assets/index.html-yZGCB8gA.js" as="script"><link rel="prefetch" href="/assets/index.html-YPMtL1dY.js" as="script"><link rel="prefetch" href="/assets/index.html-ZAKYlJAr.js" as="script"><link rel="prefetch" href="/assets/index.html-CK3zitb4.js" as="script"><link rel="prefetch" href="/assets/index.html-79LYGNuo.js" as="script"><link rel="prefetch" href="/assets/index.html-DNwkwbum.js" as="script"><link rel="prefetch" href="/assets/index.html-BI7BHSL2.js" as="script"><link rel="prefetch" href="/assets/index.html-BwnPIKvI.js" as="script"><link rel="prefetch" href="/assets/index.html-BDjYMLNc.js" as="script"><link rel="prefetch" href="/assets/index.html-DV7urP2Z.js" as="script"><link rel="prefetch" href="/assets/index.html-tD0b6rxd.js" as="script"><link rel="prefetch" href="/assets/index.html-DdVVCS8w.js" as="script"><link rel="prefetch" href="/assets/index.html-0v-e3C_A.js" as="script"><link rel="prefetch" href="/assets/index.html-B3GsESJF.js" as="script"><link rel="prefetch" href="/assets/index.html-DK0S-uNi.js" as="script"><link rel="prefetch" href="/assets/index.html-W8yJ8JPU.js" as="script"><link rel="prefetch" href="/assets/index.html-B8KUzHPO.js" as="script"><link rel="prefetch" href="/assets/index.html-BMYtRGQl.js" as="script"><link rel="prefetch" href="/assets/index.html-ChcC4EfY.js" as="script"><link rel="prefetch" href="/assets/index.html-DYINwBJj.js" as="script"><link rel="prefetch" href="/assets/index.html-_HZzNyRJ.js" as="script"><link rel="prefetch" href="/assets/index.html-00tBTPd_.js" as="script"><link rel="prefetch" href="/assets/index.html-D59bHlFj.js" as="script"><link rel="prefetch" href="/assets/index.html-CJTtPiB_.js" as="script"><link rel="prefetch" href="/assets/index.html-Bph6lp8z.js" as="script"><link rel="prefetch" href="/assets/index.html-AlyJcqth.js" as="script"><link rel="prefetch" href="/assets/index.html-DnRQ7vcM.js" as="script"><link rel="prefetch" href="/assets/index.html-CUbHtDGI.js" as="script"><link rel="prefetch" href="/assets/index.html-BbQyZyDj.js" as="script"><link rel="prefetch" href="/assets/index.html-wsdyR0R3.js" as="script"><link rel="prefetch" href="/assets/index.html-C8uBwiUq.js" as="script"><link rel="prefetch" href="/assets/index.html-Cjn0is8S.js" as="script"><link rel="prefetch" href="/assets/index.html-DV2cwfXv.js" as="script"><link rel="prefetch" href="/assets/giscus-7BMGhbDA.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">ChenSino</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/home.html" aria-label="Home"><span class="font-icon icon iconfont icon-home" style=""></span>Home<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="ChenSino"><span class="font-icon icon iconfont icon-home" style=""></span>ChenSino<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Java"><span class="title"><span class="font-icon icon iconfont icon-java" style=""></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/java/base/Serialization.html" aria-label="JavaåŸºç¡€"><span class="font-icon icon iconfont icon-java" style=""></span>JavaåŸºç¡€<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/java/advance/ProxyInJava.html" aria-label="Javaè¿›é˜¶"><span class="font-icon icon iconfont icon-java" style=""></span>Javaè¿›é˜¶<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/java/jvm/NewObject.html" aria-label="Javaè™šæ‹Ÿæœº"><span class="font-icon icon iconfont icon-java" style=""></span>Javaè™šæ‹Ÿæœº<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Javaæ¡†æ¶</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/framework/spring/" aria-label="Spring"><!---->Spring<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/framework/security/" aria-label="Security"><!---->Security<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/framework/springboot/" aria-label="SpringBoot"><!---->SpringBoot<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/framework/mybatis/" aria-label="Mybatis"><!---->Mybatis<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å…¶ä»–</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/other/maven/" aria-label="Maven"><!---->Maven<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/other/gradle/" aria-label="Gradle"><span class="font-icon icon iconfont icon-java" style=""></span>Gradle<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/other/locateproblem/" aria-label="Javaé—®é¢˜å®šä½"><span class="font-icon icon iconfont icon-java" style=""></span>Javaé—®é¢˜å®šä½<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/other/JdkVersion.html" aria-label="Javaç‰ˆæœ¬"><span class="font-icon icon iconfont icon-java" style=""></span>Javaç‰ˆæœ¬<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="å‰ç«¯"><span class="title"><span class="font-icon icon iconfont icon-javascript" style=""></span>å‰ç«¯</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/frontweb/vue/" aria-label="Vue"><span class="font-icon icon iconfont icon-vue" style=""></span>Vue<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/frontweb/vite/" aria-label="Vite"><span class="font-icon icon iconfont icon-vue" style=""></span>Vite<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/frontweb/es5/" aria-label="ES5"><span class="font-icon icon iconfont icon-javascript" style=""></span>ES5<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/frontweb/es6/" aria-label="ES6"><span class="font-icon icon iconfont icon-javascript" style=""></span>ES6<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/frontweb/typeScript/" aria-label="TypeScript"><span class="font-icon icon iconfont icon-javascript" style=""></span>TypeScript<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/designpattern.html" aria-label="è®¾è®¡æ¨¡å¼"><span class="font-icon icon iconfont icon-java" style=""></span>è®¾è®¡æ¨¡å¼<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/other/web/" aria-label="å‰ååˆ†ç¦»é¡¹ç›®æ­å»º"><span class="font-icon icon iconfont icon-app" style=""></span>å‰ååˆ†ç¦»é¡¹ç›®æ­å»º<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/cpp/study/" aria-label="C++å­¦ä¹ "><span class="font-icon icon iconfont icon-app" style=""></span>C++å­¦ä¹ <!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/cpp/study/" aria-label="å®¶åº­æœåŠ¡å™¨"><!---->å®¶åº­æœåŠ¡å™¨<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="å…¶ä»–"><span class="title"><span class="font-icon icon iconfont icon-others" style=""></span>å…¶ä»–</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/other/web/" aria-label="Web"><span class="font-icon icon iconfont icon-vue" style=""></span>Web<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/git/GitCommands.html" aria-label="Git"><span class="font-icon icon iconfont icon-git" style=""></span>Git<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/linux/CommonUsedCMD.html" aria-label="Linux"><span class="font-icon icon iconfont icon-linux" style=""></span>Linux<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/docker/Docker.html" aria-label="Docker"><span class="font-icon icon iconfont icon-ubuntu" style=""></span>Docker<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/database/CPUOverLoad.html" aria-label="DataBase"><span class="font-icon icon iconfont icon-java" style=""></span>DataBase<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/markdown/" aria-label="MarkDown"><span class="font-icon icon iconfont icon-markdown" style=""></span>MarkDown<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/tools/idea.html" aria-label="å·¥å…·è½¯ä»¶"><span class="font-icon icon iconfont icon-software" style=""></span>å·¥å…·è½¯ä»¶<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/training/CloudServiceTraining.html" aria-label="å°ç»„åˆ†äº«"><span class="font-icon icon iconfont icon-share" style=""></span>å°ç»„åˆ†äº«<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/essay/2022-04-12.html" aria-label="éšç¬”æ‚è®°"><span class="font-icon icon iconfont icon-activity" style=""></span>éšç¬”æ‚è®°<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/books/ebooks.html" aria-label="ç”µå­ä¹¦èµ„æº"><span class="font-icon icon iconfont icon-app" style=""></span>ç”µå­ä¹¦èµ„æº<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/distributeservice/DistributeLock.html" aria-label="åˆ†å¸ƒå¼å¾®æœåŠ¡"><span class="font-icon icon iconfont icon-class" style=""></span>åˆ†å¸ƒå¼å¾®æœåŠ¡<!----></a></li><li class="dropdown-item"><a class="route-link nav-link active" href="/other/oauth2/" aria-label="OAuth2.0"><span class="font-icon icon iconfont icon-class" style=""></span>OAuth2.0<!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/ChenSino/ChenSino.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-git" style=""></span><span class="vp-sidebar-title">Git</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-linux" style=""></span><span class="vp-sidebar-title">Linux</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-repo" style=""></span><span class="vp-sidebar-title">æ•°æ®åº“</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-markdown" style=""></span><span class="vp-sidebar-title">MarkDown</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-software" style=""></span><span class="vp-sidebar-title">å·¥å…·è½¯ä»¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-share" style=""></span><span class="vp-sidebar-title">å°ç»„åˆ†äº«</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-share" style=""></span><span class="vp-sidebar-title">éšç¬”åˆ†äº«</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-share" style=""></span><span class="vp-sidebar-title">web</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-share" style=""></span><span class="vp-sidebar-title">åˆ†å¸ƒå¼å¾®æœåŠ¡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon iconfont icon-share" style=""></span><span class="vp-sidebar-title">OAuth2.0</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/" aria-label="å¼€ç¯‡è¯ | ä¸ºä»€ä¹ˆè¦å­¦OAuth 2.0ï¼Ÿ"><!---->å¼€ç¯‡è¯ | ä¸ºä»€ä¹ˆè¦å­¦OAuth 2.0ï¼Ÿ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/01.html" aria-label="01 | OAuth 2.0æ˜¯è¦é€šè¿‡ä»€ä¹ˆæ–¹å¼è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><!---->01 | OAuth 2.0æ˜¯è¦é€šè¿‡ä»€ä¹ˆæ–¹å¼è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/02.html" aria-label="02 | æˆæƒç è®¸å¯ç±»å‹ä¸­ï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦æœ‰æˆæƒç ï¼Ÿ"><!---->02 | æˆæƒç è®¸å¯ç±»å‹ä¸­ï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦æœ‰æˆæƒç ï¼Ÿ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/03.html" aria-label="03 | æˆæƒæœåŠ¡ï¼šæˆæƒç å’Œè®¿é—®ä»¤ç‰Œçš„é¢å‘æµç¨‹æ˜¯æ€æ ·"><!---->03 | æˆæƒæœåŠ¡ï¼šæˆæƒç å’Œè®¿é—®ä»¤ç‰Œçš„é¢å‘æµç¨‹æ˜¯æ€æ ·<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/04.html" aria-label="04 | åœ¨OAuth 2.0ä¸­ï¼Œå¦‚ä½•ä½¿ç”¨JWTç»“æ„åŒ–ä»¤ç‰Œï¼Ÿ"><!---->04 | åœ¨OAuth 2.0ä¸­ï¼Œå¦‚ä½•ä½¿ç”¨JWTç»“æ„åŒ–ä»¤ç‰Œï¼Ÿ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/05.html" aria-label="05 | å¦‚ä½•å®‰å…¨ã€å¿«é€Ÿåœ°æ¥å…¥OAuth 2.0ï¼Ÿ"><!---->05 | å¦‚ä½•å®‰å…¨ã€å¿«é€Ÿåœ°æ¥å…¥OAuth 2.0ï¼Ÿ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/06.html" aria-label="06 | é™¤äº†æˆæƒç è®¸å¯ç±»å‹ï¼ŒOAuth 2.0è¿˜æ”¯æŒä»€ä¹ˆæˆæƒæµç¨‹ï¼Ÿ"><!---->06 | é™¤äº†æˆæƒç è®¸å¯ç±»å‹ï¼ŒOAuth 2.0è¿˜æ”¯æŒä»€ä¹ˆæˆæƒæµç¨‹ï¼Ÿ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/07.html" aria-label="07 | å¦‚ä½•åœ¨ç§»åŠ¨Appä¸­ä½¿ç”¨OAuth 2.0ï¼Ÿ"><!---->07 | å¦‚ä½•åœ¨ç§»åŠ¨Appä¸­ä½¿ç”¨OAuth 2.0ï¼Ÿ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/08.html" aria-label="08 | å®è·µOAuth 2.0æ—¶ï¼Œä½¿ç”¨ä¸å½“å¯èƒ½ä¼šå¯¼è‡´å“ªäº›å®‰å…¨æ¼æ´ï¼Ÿ"><!---->08 | å®è·µOAuth 2.0æ—¶ï¼Œä½¿ç”¨ä¸å½“å¯èƒ½ä¼šå¯¼è‡´å“ªäº›å®‰å…¨æ¼æ´ï¼Ÿ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/09.html" aria-label="09 | å®æˆ˜ï¼šåˆ©ç”¨OAuth 2.0å®ç°ä¸€ä¸ªOpenID Connectç”¨æˆ·èº«ä»½è®¤è¯åè®®"><!---->09 | å®æˆ˜ï¼šåˆ©ç”¨OAuth 2.0å®ç°ä¸€ä¸ªOpenID Connectç”¨æˆ·èº«ä»½è®¤è¯åè®®<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/10.html" aria-label="10 | ä¸²è®²ï¼šOAuth 2.0çš„å·¥ä½œæµç¨‹ä¸å®‰å…¨é—®é¢˜"><!---->10 | ä¸²è®²ï¼šOAuth 2.0çš„å·¥ä½œæµç¨‹ä¸å®‰å…¨é—®é¢˜<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/other/oauth2/11.html" aria-label="11 | å®æˆ˜æ¡ˆä¾‹ï¼šä½¿ç”¨Spring Securityæ­å»ºä¸€å¥—åŸºäºJWTçš„OAuth 2.0æ¶æ„"><!---->11 | å®æˆ˜æ¡ˆä¾‹ï¼šä½¿ç”¨Spring Securityæ­å»ºä¸€å¥—åŸºäºJWTçš„OAuth 2.0æ¶æ„<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/12.html" aria-label="12 | æ¶æ„æ¡ˆä¾‹ï¼šåŸºäºOAuth 2.0/JWTçš„å¾®æœåŠ¡å‚è€ƒæ¶æ„"><!---->12 | æ¶æ„æ¡ˆä¾‹ï¼šåŸºäºOAuth 2.0/JWTçš„å¾®æœåŠ¡å‚è€ƒæ¶æ„<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/13.html" aria-label="13 | å„å¤§å¼€æ”¾å¹³å°æ˜¯å¦‚ä½•ä½¿ç”¨OAuth 2.0çš„ï¼Ÿ"><!---->13 | å„å¤§å¼€æ”¾å¹³å°æ˜¯å¦‚ä½•ä½¿ç”¨OAuth 2.0çš„ï¼Ÿ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/14.html" aria-label="14 | æŸ¥æ¼è¡¥ç¼ºï¼šOAuth 2.0 å¸¸è§é—®é¢˜ç­”ç–‘"><!---->14 | æŸ¥æ¼è¡¥ç¼ºï¼šOAuth 2.0 å¸¸è§é—®é¢˜ç­”ç–‘<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-ubuntu" style=""></span><span class="vp-sidebar-title">Docker</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->11 | å®æˆ˜æ¡ˆä¾‹ï¼šä½¿ç”¨Spring Securityæ­å»ºä¸€å¥—åŸºäºJWTçš„OAuth 2.0æ¶æ„</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">ChenSino</span></span><span property="author" content="ChenSino"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-11-08T00:00:00.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 26 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT26M"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#é¡¹ç›®å‡†å¤‡å·¥ä½œ">é¡¹ç›®å‡†å¤‡å·¥ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ­å»ºæˆæƒæœåŠ¡å™¨">æ­å»ºæˆæƒæœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ­å»ºå—ä¿æŠ¤èµ„æºæœåŠ¡å™¨">æ­å»ºå—ä¿æŠ¤èµ„æºæœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#åˆå§‹åŒ–æ•°æ®é…ç½®">åˆå§‹åŒ–æ•°æ®é…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ¼”ç¤ºä¸‰ç§æˆæƒè®¸å¯ç±»å‹">æ¼”ç¤ºä¸‰ç§æˆæƒè®¸å¯ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#èµ„æºæ‹¥æœ‰è€…å‡­æ®è®¸å¯ç±»å‹">èµ„æºæ‹¥æœ‰è€…å‡­æ®è®¸å¯ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#å®¢æˆ·ç«¯æˆæƒè®¸å¯ç±»å‹">å®¢æˆ·ç«¯æˆæƒè®¸å¯ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æˆæƒç è®¸å¯ç±»å‹">æˆæƒç è®¸å¯ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ¼”ç¤ºæƒé™æ§åˆ¶">æ¼”ç¤ºæƒé™æ§åˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ­å»ºå®¢æˆ·ç«¯ç¨‹åº">æ­å»ºå®¢æˆ·ç«¯ç¨‹åº</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ¼”ç¤ºå•ç‚¹ç™»å½•">æ¼”ç¤ºå•ç‚¹ç™»å½•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ¼”ç¤ºå®¢æˆ·ç«¯è¯·æ±‚èµ„æºæœåŠ¡å™¨èµ„æº">æ¼”ç¤ºå®¢æˆ·ç«¯è¯·æ±‚èµ„æºæœåŠ¡å™¨èµ„æº</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#æ€»ç»“">æ€»ç»“</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><p>ä½ å¥½ï¼Œæˆ‘æœ±æ™”ï¼Œæ˜¯ã€Š<a href="https://time.geekbang.org/column/intro/294" target="_blank" rel="noopener noreferrer">Java ä¸šåŠ¡å¼€å‘å¸¸è§é”™è¯¯ 100 ä¾‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‹ä¸“æ è¯¾ç¨‹çš„ä½œè€…ã€‚</p><p>ã€ŠOAuth 2.0 å®æˆ˜è¯¾ã€‹ä¸Šçº¿ä¹‹åï¼Œæˆ‘ä¹Ÿç¬¬ä¸€æ—¶é—´å…³æ³¨äº†è¿™é—¨è¯¾ã€‚åœ¨å¼€ç¯‡è¯ä¸­ï¼Œæˆ‘çœ‹åˆ°æœ‰ä¸€äº›åŒå­¦ç•™è¨€é—®é“ï¼šâ€œå¦‚ä½•ä½¿ç”¨ Spring Security æ¥å®ç° OAuth 2.0ï¼Ÿâ€è¿™æ—¶ï¼Œæˆ‘æƒ³åˆ°ä¹‹å‰è‡ªå·±å†™è¿‡ä¸€ç¯‡ç›¸å…³çš„æ–‡ç« ï¼Œäºæ˜¯å°±ç›´æ¥åœ¨å¼€ç¯‡è¯ä¸‹ç•™äº†è¨€ã€‚åé¢æˆ‘å¾ˆå¿«æ”¶åˆ°äº†ä¸å°‘ç”¨æˆ·çš„ç‚¹èµå’Œè‚¯å®šï¼Œç´§æ¥ç€æå®¢æ—¶é—´ç¼–è¾‘ä¹Ÿé‚€è¯·æˆ‘ä»è‡ªå·±çš„è§’åº¦ä¸ºä¸“æ å†™ç¯‡åŠ é¤ã€‚å¥½å§ï¼ŒåŠŸä¸å”æï¼Œäºæ˜¯æˆ‘å°±å°†ä¹‹å‰æˆ‘å†™çš„é‚£ç¯‡è€æ–‡ç« å†æ¬¡è¿­ä»£ã€æ•´ç†ä¸ºä»Šå¤©çš„è¿™ä¸€è®²å†…å®¹ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©ä½ æŒæ¡ OAuth 2.0ã€‚</p><p>å¦‚æœä½ ç†Ÿæ‚‰ Spring Security çš„è¯ï¼Œè‚¯å®šçŸ¥é“å®ƒå› ä¸ºåŠŸèƒ½å¤šã€ç»„ä»¶æŠ½è±¡ç¨‹åº¦é«˜ã€é…ç½®æ–¹å¼å¤šæ ·ï¼Œå¯¼è‡´äº†å¼ºå¤§ä¸”å¤æ‚çš„ç‰¹æ€§ã€‚ä¹Ÿå› æ­¤ï¼ŒSpring Security çš„å­¦ä¹ æˆæœ¬å‡ ä¹æ˜¯ Spring å®¶æ—ä¸­æœ€é«˜çš„ã€‚ä½†ä¸ä»…äºæ­¤ï¼Œåœ¨ç»“åˆå®é™…çš„å¤æ‚ä¸šåŠ¡åœºæ™¯ä½¿ç”¨ Spring Security æ—¶ï¼Œæˆ‘ä»¬è¿˜è¦å»ç†è§£ä¸€äº›ç»„ä»¶çš„å·¥ä½œåŸç†å’Œæµç¨‹ï¼Œä¸ç„¶éœ€è¦è‡ªå®šä¹‰å’Œæ‰©å±•æ¡†æ¶çš„æ—¶å€™å°±ä¼šæ‰‹è¶³æ— æªã€‚è¿™å°±è®©ä½¿ç”¨ Spring Security çš„é—¨æ§›æ›´é«˜äº†ã€‚</p><p>å› æ­¤ï¼Œåœ¨å†³å®šä½¿ç”¨ Spring Security æ­å»ºæ•´å¥—å®‰å…¨ä½“ç³»ï¼ˆæˆæƒã€è®¤è¯ã€æƒé™ã€å®¡è®¡ï¼‰ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘çš„æ˜¯ï¼šå°†æ¥æˆ‘ä»¬çš„ä¸šåŠ¡ä¼šå¤šå¤æ‚ï¼Œå¾’æ‰‹å†™ä¸€å¥—å®‰å…¨ä½“ç³»æ¥å¾—åˆ’ç®—ï¼Œè¿˜æ˜¯ä½¿ç”¨ Spring Security æ›´å¥½ï¼Ÿæˆ‘ç›¸ä¿¡ï¼Œè¿™ä¹Ÿæ˜¯ç‹è€å¸ˆç»™å‡ºè¯¾ç¨‹é…å¥—ä»£ç ä¸­ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ Spring Security æ¥æ¼”ç¤º OAuth 2.0 æµç¨‹çš„åŸå› ä¹‹ä¸€ã€‚</p><p>åè¿‡æ¥è¯´ï¼Œå¦‚æœä½ çš„åº”ç”¨å·²ç»ä½¿ç”¨äº† Spring Security æ¥åšé‰´æƒã€è®¤è¯å’Œæƒé™ç®¡ç†çš„è¯ï¼Œé‚£ä¹ˆä»ç„¶ä½¿ç”¨ Spring Security æ¥å®ç° OAuth çš„æˆæœ¬æ˜¯å¾ˆä½çš„ã€‚è€Œä¸”ï¼Œåœ¨å­¦ä¹ äº† OAuth 2.0 çš„æµç¨‹æ‰“ä¸‹æ‰å®çš„åŸºç¡€ä¹‹åï¼Œæˆ‘ä»¬å†ä½¿ç”¨ Spring Security æ¥é…ç½® OAuth 2.0 å°±ä¸ä¼šé‚£ä¹ˆè¿·èŒ«äº†ã€‚è¿™ä¹Ÿæ˜¯æˆ‘åœ¨å·¥ä½œä¸­ä½¿ç”¨ Spring Security æ¥å®ç° OAuth 2.0 çš„ç›´è§‚æ„Ÿå—ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘å°±ç»“åˆè‡ªå·±çš„å®è·µå’Œç§¯ç´¯ï¼Œå¸¦ä½ ä½¿ç”¨ Spring Security æ¥ä¸€æ­¥ä¸€æ­¥åœ°æ­å»ºä¸€å¥—åŸºäº JWT çš„ OAuth 2.0 æˆæƒä½“ç³»ã€‚è¿™äº›å†…å®¹ä¼šæ¶‰åŠ OAuth 2.0 çš„ä¸‰è§’è‰²ï¼ˆå®¢æˆ·ç«¯ã€æˆæƒæœåŠ¡ã€å—ä¿æŠ¤èµ„æºï¼‰ï¼Œä»¥åŠèµ„æºæ‹¥æœ‰è€…å‡­æ®è®¸å¯ã€å®¢æˆ·ç«¯å‡­æ®è®¸å¯å’Œæˆæƒç è®¸å¯è¿™ä¸‰ç§å¸¸ç”¨çš„æˆæƒè®¸å¯ç±»å‹ï¼ˆéšå¼è®¸å¯ç±»å‹ï¼Œä¸å¤ªå®‰å…¨ä¹Ÿä¸å¤ªå¸¸ç”¨ï¼‰ã€‚åŒæ—¶ï¼Œæˆ‘è¿˜ä¼šæ¼”ç¤º OAuth 2.0 çš„æƒé™æ§åˆ¶ï¼Œä»¥åŠä½¿ç”¨ OAuth 2.0 å®ç° SSO å•ç‚¹ç™»å½•ä½“ç³»ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œä»Šå¤©è¿™ä¸€è®²æ¶‰åŠåˆ°çš„æµç¨‹å°±ä¼šæ¯”è¾ƒå¤šï¼Œå†…å®¹ä¹Ÿä¼šå¾ˆé•¿ã€‚ä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä¼šæ‰‹æŠŠæ‰‹å¸¦ä½ ä»é›¶å¼€å§‹ï¼Œå®Œæˆæ•´ä¸ªç¨‹åºçš„æ­å»ºï¼Œå¹¶ç»™å‡ºæ‰€æœ‰æµç¨‹çš„æ¼”ç¤ºã€‚</p><h3 id="é¡¹ç›®å‡†å¤‡å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#é¡¹ç›®å‡†å¤‡å·¥ä½œ"><span>é¡¹ç›®å‡†å¤‡å·¥ä½œ</span></a></h3><p>å®æˆ˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ­å»ºé¡¹ç›®çˆ¶ä¾èµ–å’Œåˆå§‹åŒ–æ•°æ®åº“ç»“æ„ï¼Œä¸ºåé¢å…·ä½“çš„ç¼–ç åšå‡†å¤‡ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªçˆ¶ POMï¼Œå†…å«ä¸‰ä¸ªæ¨¡å—ï¼š</p><ul><li><p>springsecurity101-cloud-oauth2-clientï¼Œç”¨æ¥æ‰®æ¼”å®¢æˆ·ç«¯è§’è‰²ï¼›</p></li><li><p>springsecurity101-cloud-oauth2-serverï¼Œç”¨æ¥æ‰®æ¼”æˆæƒæœåŠ¡å™¨è§’è‰²ï¼›</p></li><li><p>springsecurity101-cloud-oauth2-userserviceï¼Œæ˜¯ç”¨æˆ·æœåŠ¡ï¼Œç”¨æ¥æ‰®æ¼”èµ„æºæä¾›è€…è§’è‰²ã€‚</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>me.josephzhu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springsecurity101<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.1.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modules</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">&gt;</span></span>springsecurity101-cloud-oauth2-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">&gt;</span></span>springsecurity101-cloud-oauth2-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">&gt;</span></span>springsecurity101-cloud-oauth2-userservice<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modules</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>Greenwich.SR4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>ç„¶åï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª oauth æ•°æ®åº“ï¼Œåˆå§‹åŒ–å°†æ¥ä¼šç”¨åˆ°çš„ 5 ä¸ªè¡¨ã€‚</p><ul><li>authorities è¡¨ï¼šè®°å½•è´¦å·çš„æƒé™ï¼Œéœ€è¦æˆ‘ä»¬åœ¨åé¢é…ç½®ã€‚</li><li>oauth_approvals è¡¨ï¼šè®°å½•æˆæƒæ‰¹å‡†çš„çŠ¶æ€ã€‚</li><li>oauth_client_details è¡¨ï¼šè®°å½• OAuth çš„å®¢æˆ·ç«¯ï¼Œéœ€è¦æˆ‘ä»¬åœ¨åé¢åšé…ç½®ã€‚</li><li>oauth_code è¡¨ï¼šè®°å½•æˆæƒç ã€‚</li><li>users è¡¨ï¼šè®°å½•è´¦å·ï¼Œéœ€è¦æˆ‘ä»¬åœ¨åé¢åšåˆå§‹åŒ–ã€‚</li></ul><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>
<span class="token keyword">SET</span> NAMES utf8mb4<span class="token punctuation">;</span>
<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for authorities</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>authorities<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>authorities<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>authority<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>ix_auth_username<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>authority<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span> <span class="token identifier"><span class="token punctuation">`</span>fk_authorities_users<span class="token punctuation">`</span></span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for oauth_approvals</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>oauth_approvals<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>oauth_approvals<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>userId<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>clientId<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>partnerKey<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>scope<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>expiresAt<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>lastModifiedAt<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for oauth_client_details</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>oauth_client_details<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>oauth_client_details<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>resource_ids<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>client_secret<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>scope<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>authorized_grant_types<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>web_server_redirect_uri<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>authorities<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>access_token_validity<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>refresh_token_validity<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>additional_information<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>autoapprove<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for oauth_code</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>oauth_code<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>oauth_code<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>code<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>authentication<span class="token punctuation">`</span></span> <span class="token keyword">blob</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for users</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>enabled<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>

<span class="token keyword">SET</span> FOREIGN_KEY_CHECKS <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ 5 ä¸ªè¡¨æ˜¯ Spring Security OAuth éœ€è¦ç”¨åˆ°çš„å­˜å‚¨è¡¨ï¼Œæˆ‘ä»¬ä¸è¦å»ä¿®æ”¹æ—¢æœ‰çš„è¡¨ç»“æ„ã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨æ•°æ®åº“ä¸­åˆ›å»ºç›¸åº”çš„è¡¨ï¼Œæ¥å­˜æ”¾è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œã€‚è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬ä¹‹åçš„å®ç°ä¼šä½¿ç”¨ JWT æ¥ä¼ è¾“ä»¤ç‰Œä¿¡æ¯ï¼Œä»¥ä¾¿è¿›è¡Œæœ¬åœ°æ ¡éªŒï¼Œæ‰€ä»¥å¹¶ä¸ä¸€å®šè¦å°†å…¶å­˜æ”¾åˆ°æ•°æ®åº“ä¸­ã€‚åŸºæœ¬ä¸Šæ‰€æœ‰çš„è¿™äº›è¡¨éƒ½æ˜¯å¯ä»¥è‡ªå·±æ‰©å±•çš„ï¼Œåªéœ€è¦ç»§æ‰¿å®ç° Spring çš„ä¸€äº›æ—¢æœ‰ç±»å³å¯ï¼Œè¿™é‡Œä¸åšå±•å¼€ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼€å§‹æ­å»ºæˆæƒæœåŠ¡å™¨å’Œå—ä¿æŠ¤èµ„æºæœåŠ¡å™¨ã€‚</p><h3 id="æ­å»ºæˆæƒæœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#æ­å»ºæˆæƒæœåŠ¡å™¨"><span>æ­å»ºæˆæƒæœåŠ¡å™¨</span></a></h3><p>æˆ‘ä»¬å…ˆåˆ›å»ºç¬¬ä¸€ä¸ªæ¨¡å—ï¼Œä¹Ÿå°±æ˜¯æˆæƒæœåŠ¡å™¨ã€‚é¦–å…ˆåˆ›å»º POMï¼Œé…ç½®ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>
<span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springsecurity101<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>me.josephzhu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springsecurity101-cloud-oauth2-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-oauth2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Spring Cloud çš„ spring-cloud-starter-oauth2 ç»„ä»¶ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨çš„ Spring Securityï¼Œå› ä¸ºå‰è€…åšäº†ä¸€äº›è‡ªåŠ¨åŒ–é…ç½®çš„å·¥ä½œï¼Œä½¿ç”¨èµ·æ¥ä¼šæ›´æ–¹ä¾¿ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜åœ¨ POM ä¸­åŠ å…¥äº†æ•°æ®è®¿é—®ã€Web ç­‰ä¾èµ–ï¼Œå› ä¸ºæˆ‘ä»¬çš„å—ä¿æŠ¤èµ„æºæœåŠ¡å™¨éœ€è¦ä½¿ç”¨æ•°æ®åº“æ¥ä¿å­˜å®¢æˆ·ç«¯çš„ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯ç­‰æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿä¼šå¼•å…¥ thymeleaf æ¨¡æ¿å¼•æ“ä¾èµ–ï¼Œæ¥ç¨ç¨ç¾åŒ–ä¸€ä¸‹ç™»å½•é¡µé¢ã€‚</p><p>ç„¶ååˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ application.yml å®ç°ç¨‹åºé…ç½®ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> oauth2<span class="token punctuation">-</span>server
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>6657/oauth<span class="token punctuation">?</span>useSSL=false
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> kIo9u7Oi0eg
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬é…ç½®äº† oauth æ•°æ®åº“çš„è¿æ¥å­—ç¬¦ä¸²ï¼Œå®šä¹‰äº†æˆæƒæœåŠ¡å™¨çš„ç›‘å¬ç«¯å£æ˜¯ 8080ã€‚</p><p>æœ€åï¼Œä½¿ç”¨ keytool å·¥å…·ç”Ÿæˆå¯†é’¥å¯¹ï¼ŒæŠŠå¯†é’¥æ–‡ä»¶ jks ä¿å­˜åˆ°èµ„æºç›®å½•ä¸‹ï¼Œå¹¶è¦å¯¼å‡ºä¸€ä¸ªå…¬é’¥ç•™ä½œä»¥åä½¿ç”¨ã€‚</p><p>ä»¥ä¸Šå®Œæˆäº†é¡¹ç›®æ¡†æ¶æ­å»ºå·¥ä½œï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ­£å¼å¼€å§‹ç¼–ç ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªæœ€æ ¸å¿ƒçš„ç±»ç”¨äºé…ç½®æˆæƒæœåŠ¡å™¨ã€‚æˆ‘æŠŠæ¯æ®µä»£ç çš„ä½œç”¨æ”¾åœ¨äº†æ³¨é‡Šé‡Œï¼Œä½ å¯ä»¥ç›´æ¥çœ‹ä¸‹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableAuthorizationServer</span> <span class="token comment">//å¼€å¯æˆæƒæœåŠ¡å™¨</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OAuth2ServerConfiguration</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizationServerConfigurerAdapter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthenticationManager</span> authenticationManager<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æˆ‘ä»¬é…ç½®äº†ä½¿ç”¨æ•°æ®åº“æ¥ç»´æŠ¤å®¢æˆ·ç«¯ä¿¡æ¯ã€‚è™½ç„¶åœ¨å„ç§Demoä¸­æˆ‘ä»¬ç»å¸¸çœ‹åˆ°çš„æ˜¯åœ¨å†…å­˜ä¸­ç»´æŠ¤å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œé€šè¿‡é…ç½®ç›´æ¥å†™æ­»åœ¨è¿™é‡Œã€‚
     * ä½†æ˜¯ï¼Œå¯¹äºå®é™…çš„åº”ç”¨æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šç”¨æ•°æ®åº“æ¥ç»´æŠ¤è¿™ä¸ªä¿¡æ¯ï¼Œç”šè‡³è¿˜ä¼šå»ºç«‹ä¸€å¥—å·¥ä½œæµæ¥å…è®¸å®¢æˆ·ç«¯è‡ªå·±ç”³è¯·ClientIDï¼Œå®ç°OAuthå®¢æˆ·ç«¯æ¥å…¥çš„å®¡æ‰¹ã€‚
     * <span class="token keyword">@param</span> <span class="token parameter">clients</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">ClientDetailsServiceConfigurer</span> clients<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        clients<span class="token punctuation">.</span><span class="token function">jdbc</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¿™é‡Œå¹²äº†ä¸¤ä»¶äº‹å„¿ã€‚é¦–å…ˆï¼Œæ‰“å¼€äº†éªŒè¯Tokençš„è®¿é—®æƒé™ï¼ˆä»¥ä¾¿ä¹‹åæˆ‘ä»¬æ¼”ç¤ºï¼‰ã€‚
     * ç„¶åï¼Œå…è®¸ClientSecretæ˜æ–‡æ–¹å¼ä¿å­˜ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è¡¨å•æäº¤ï¼ˆè€Œä¸ä»…ä»…æ˜¯Basic Authæ–¹å¼æäº¤ï¼‰ï¼Œä¹‹åä¼šæ¼”ç¤ºåˆ°è¿™ä¸ªã€‚
     * <span class="token keyword">@param</span> <span class="token parameter">security</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationServerSecurityConfigurer</span> security<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        security<span class="token punctuation">.</span><span class="token function">checkTokenAccess</span><span class="token punctuation">(</span><span class="token string">&quot;permitAll()&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">allowFormAuthenticationForClients</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token class-name">NoOpPasswordEncoder</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å¹²äº†ä»¥ä¸‹4ä»¶äº‹å„¿ï¼š
     * 1. é…ç½®æˆ‘ä»¬çš„ä»¤ç‰Œå­˜æ”¾æ–¹å¼ä¸ºJWTæ–¹å¼ï¼Œè€Œä¸æ˜¯å†…å­˜ã€æ•°æ®åº“æˆ–Redisæ–¹å¼ã€‚
     * JWTæ˜¯Json Web Tokençš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨JSONæ•°æ®æ ¼å¼åŒ…è£…çš„ä»¤ç‰Œï¼Œç”±.å·æŠŠæ•´ä¸ªJWTåˆ†éš”ä¸ºå¤´ã€æ•°æ®ä½“ã€ç­¾åä¸‰éƒ¨åˆ†ã€‚
     * JWTä¿å­˜Tokenè™½ç„¶æ˜“äºä½¿ç”¨ä½†æ˜¯ä¸æ˜¯é‚£ä¹ˆå®‰å…¨ï¼Œä¸€èˆ¬ç”¨äºå†…éƒ¨ï¼Œä¸”éœ€è¦èµ°HTTPSå¹¶é…ç½®æ¯”è¾ƒçŸ­çš„å¤±æ•ˆæ—¶é—´ã€‚
     * 2. é…ç½®JWT Tokençš„éå¯¹ç§°åŠ å¯†æ¥è¿›è¡Œç­¾å
     * 3. é…ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„Tokenå¢å¼ºå™¨ï¼ŒæŠŠæ›´å¤šä¿¡æ¯æ”¾å…¥Tokenä¸­
     * 4. é…ç½®ä½¿ç”¨JDBCæ•°æ®åº“æ–¹å¼æ¥ä¿å­˜ç”¨æˆ·çš„æˆæƒæ‰¹å‡†è®°å½•
     * <span class="token keyword">@param</span> <span class="token parameter">endpoints</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthorizationServerEndpointsConfigurer</span> endpoints<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TokenEnhancerChain</span> tokenEnhancerChain <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TokenEnhancerChain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokenEnhancerChain<span class="token punctuation">.</span><span class="token function">setTokenEnhancers</span><span class="token punctuation">(</span>
                <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token function">tokenEnhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">jwtTokenEnhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        endpoints<span class="token punctuation">.</span><span class="token function">approvalStore</span><span class="token punctuation">(</span><span class="token function">approvalStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authorizationCodeServices</span><span class="token punctuation">(</span><span class="token function">authorizationCodeServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">tokenStore</span><span class="token punctuation">(</span><span class="token function">tokenStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">tokenEnhancer</span><span class="token punctuation">(</span>tokenEnhancerChain<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authenticationManager</span><span class="token punctuation">(</span>authenticationManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ä½¿ç”¨JDBCæ•°æ®åº“æ–¹å¼æ¥ä¿å­˜æˆæƒç 
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthorizationCodeServices</span> <span class="token function">authorizationCodeServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcAuthorizationCodeServices</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ä½¿ç”¨JWTå­˜å‚¨
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TokenStore</span> <span class="token function">tokenStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JwtTokenStore</span><span class="token punctuation">(</span><span class="token function">jwtTokenEnhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ä½¿ç”¨JDBCæ•°æ®åº“æ–¹å¼æ¥ä¿å­˜ç”¨æˆ·çš„æˆæƒæ‰¹å‡†è®°å½•
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">JdbcApprovalStore</span> <span class="token function">approvalStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcApprovalStore</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è‡ªå®šä¹‰çš„Tokenå¢å¼ºå™¨ï¼ŒæŠŠæ›´å¤šä¿¡æ¯æ”¾å…¥Tokenä¸­
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TokenEnhancer</span> <span class="token function">tokenEnhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomTokenEnhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * é…ç½®JWTä½¿ç”¨éå¯¹ç§°åŠ å¯†æ–¹å¼æ¥éªŒè¯
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">protected</span> <span class="token class-name">JwtAccessTokenConverter</span> <span class="token function">jwtTokenEnhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">KeyStoreKeyFactory</span> keyStoreKeyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeyStoreKeyFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;jwt.jks&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;mySecretKey&quot;</span><span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JwtAccessTokenConverter</span> converter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JwtAccessTokenConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        converter<span class="token punctuation">.</span><span class="token function">setKeyPair</span><span class="token punctuation">(</span>keyStoreKeyFactory<span class="token punctuation">.</span><span class="token function">getKeyPair</span><span class="token punctuation">(</span><span class="token string">&quot;jwt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> converter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * é…ç½®ç™»å½•é¡µé¢çš„è§†å›¾ä¿¡æ¯ï¼ˆå…¶å®å¯ä»¥ç‹¬ç«‹ä¸€ä¸ªé…ç½®ç±»ï¼Œè¿™æ ·ä¼šæ›´è§„èŒƒï¼‰
     */</span>
    <span class="token annotation punctuation">@Configuration</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬äºŒæ­¥ï¼Œè¿˜è®°å¾—å—ï¼Œåˆšæ‰åœ¨ç¬¬ä¸€æ­¥çš„ä»£ç ä¸­æˆ‘ä»¬è¿˜ç”¨åˆ°äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ Token å¢å¼ºå™¨ï¼ŒæŠŠç”¨æˆ·ä¿¡æ¯åµŒå…¥åˆ° JWT Token ä¸­å»ï¼ˆå¦‚æœä½¿ç”¨çš„æ˜¯å®¢æˆ·ç«¯å‡­æ®è®¸å¯ç±»å‹ï¼Œè¿™æ®µä»£ç æ— æ•ˆï¼Œå› ä¸ºå’Œç”¨æˆ·æ²¡å…³ç³»ï¼‰ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ã€‚å› ä¸ºï¼Œé»˜è®¤æƒ…å†µä¸‹ Token ä¸­åªä¼šæœ‰ç”¨æˆ·åè¿™æ ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦æŠŠå…³äºç”¨æˆ·çš„æ›´å¤šä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šä»æ•°æ®åº“æˆ–å¤–éƒ¨æœåŠ¡æŸ¥è¯¢æ›´å¤šçš„ç”¨æˆ·ä¿¡æ¯åŠ å…¥åˆ° JWT Token ä¸­å»ï¼‰ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰å¢å¼ºå™¨æ¥ä¸°å¯Œ Token çš„å†…å®¹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomTokenEnhancer</span> <span class="token keyword">implements</span> <span class="token class-name">TokenEnhancer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">OAuth2AccessToken</span> <span class="token function">enhance</span><span class="token punctuation">(</span><span class="token class-name">OAuth2AccessToken</span> accessToken<span class="token punctuation">,</span> <span class="token class-name">OAuth2Authentication</span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Authentication</span> userAuthentication <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getUserAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>userAuthentication <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> principal <span class="token operator">=</span> authentication<span class="token punctuation">.</span><span class="token function">getUserAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æŠŠç”¨æˆ·æ ‡è¯†åµŒå…¥JWT Tokenä¸­å»(Keyæ˜¯userDetails)</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> additionalInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            additionalInfo<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;userDetails&quot;</span><span class="token punctuation">,</span> principal<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">DefaultOAuth2AccessToken</span><span class="token punctuation">)</span> accessToken<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAdditionalInformation</span><span class="token punctuation">(</span>additionalInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> accessToken<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬ä¸‰æ­¥ï¼Œå®ç°å®‰å…¨æ–¹é¢çš„é…ç½®ã€‚ä½ å¯ä»¥ç›´æ¥çœ‹ä¸‹ä»£ç æ³¨é‡Šï¼Œæ¥äº†è§£å…³é”®ä»£ç çš„ä½œç”¨ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">AuthenticationManager</span> <span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">authenticationManagerBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * é…ç½®ç”¨æˆ·è´¦æˆ·çš„è®¤è¯æ–¹å¼ã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬æŠŠç”¨æˆ·å­˜åœ¨äº†æ•°æ®åº“ä¸­å¸Œæœ›é…ç½®JDBCçš„æ–¹å¼ã€‚
     * æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜é…ç½®äº†ä½¿ç”¨BCryptPasswordEncoderå“ˆå¸Œæ¥ä¿å­˜ç”¨æˆ·çš„å¯†ç ï¼ˆç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç”¨æˆ·å¯†ç è‚¯å®šä¸èƒ½æ˜¯æ˜æ–‡ä¿å­˜çš„ï¼‰
     * <span class="token keyword">@param</span> <span class="token parameter">auth</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManagerBuilder</span> auth<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        auth<span class="token punctuation">.</span><span class="token function">jdbcAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">dataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å¼€æ”¾/loginå’Œ/oauth/authorizeä¸¤ä¸ªè·¯å¾„çš„åŒ¿åè®¿é—®ã€‚å‰è€…ç”¨äºç™»å½•ï¼Œåè€…ç”¨äºæ¢æˆæƒç ï¼Œè¿™ä¸¤ä¸ªç«¯ç‚¹è®¿é—®çš„æ—¶æœºéƒ½åœ¨ç™»å½•ä¹‹å‰ã€‚
     * è®¾ç½®/loginä½¿ç”¨è¡¨å•éªŒè¯è¿›è¡Œç™»å½•ã€‚
     * <span class="token keyword">@param</span> <span class="token parameter">http</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/oauth/authorize&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬å››æ­¥ï¼Œåœ¨èµ„æºç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª templates æ–‡ä»¶å¤¹ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª login.html ç™»å½•é¡µï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token operator">&lt;</span>body <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;uk-height-1-1&quot;</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;uk-vertical-align uk-text-center uk-height-1-1&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;uk-vertical-align-middle&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;width: 250px;&quot;</span><span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>h1<span class="token punctuation">&gt;</span></span><span class="token class-name">Login</span> <span class="token class-name">Form</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>p <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;uk-text-danger&quot;</span> th<span class="token operator">:</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;${param.error}&quot;</span><span class="token operator">&gt;</span>
            ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>form <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;uk-panel uk-panel-box uk-form&quot;</span> method<span class="token operator">=</span><span class="token string">&quot;post&quot;</span> th<span class="token operator">:</span>action<span class="token operator">=</span><span class="token string">&quot;@{/login}&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;uk-form-row&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;uk-width-1-1 uk-form-large&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> placeholder<span class="token operator">=</span><span class="token string">&quot;Username&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span>
                       value<span class="token operator">=</span><span class="token string">&quot;reader&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;uk-form-row&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>input <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;uk-width-1-1 uk-form-large&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> placeholder<span class="token operator">=</span><span class="token string">&quot;Password&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span>
                       value<span class="token operator">=</span><span class="token string">&quot;reader&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;uk-form-row&quot;</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;uk-width-1-1 uk-button uk-button-primary uk-button-large&quot;</span><span class="token operator">&gt;</span><span class="token class-name">Login</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è‡³æ­¤ï¼ŒæˆæƒæœåŠ¡å™¨çš„ç¼–ç å·¥ä½œå°±å®Œæˆäº†ã€‚</p><h3 id="æ­å»ºå—ä¿æŠ¤èµ„æºæœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#æ­å»ºå—ä¿æŠ¤èµ„æºæœåŠ¡å™¨"><span>æ­å»ºå—ä¿æŠ¤èµ„æºæœåŠ¡å™¨</span></a></h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ­å»ºä¸€ä¸ªç”¨æˆ·æœåŠ¡æ¨¡æ‹Ÿèµ„æºæä¾›è€…ï¼ˆå—ä¿æŠ¤èµ„æºæœåŠ¡å™¨ï¼‰ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹é¡¹ç›®åˆå§‹åŒ–å·¥ä½œã€‚</p><p>è¿™æ¬¡åˆ›å»ºçš„ POM æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šï¼Œä¾èµ–äº† spring-cloud-starter-oauth2ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>
<span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springsecurity101<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>me.josephzhu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springsecurity101-cloud-oauth2-userservice<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-oauth2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®æ–‡ä»¶éå¸¸ç®€å•ï¼Œåªæ˜¯å£°æ˜äº†èµ„æºæœåŠ¡ç«¯å£ä¸º 8081ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒæ—¶ï¼Œè¿˜è¦è®°å¾—æŠŠæˆ‘ä»¬ä¹‹å‰åœ¨é¡¹ç›®å‡†å¤‡å·¥ä½œæ—¶ç”Ÿæˆçš„å¯†é’¥å¯¹çš„å…¬é’¥å‘½åä¸º public.certï¼Œå¹¶æ”¾åˆ°èµ„æºæ–‡ä»¶ä¸‹ã€‚è¿™æ ·ï¼Œèµ„æºæœåŠ¡å™¨å¯ä»¥æœ¬åœ°æ ¡éªŒ JWT çš„åˆæ³•æ€§ã€‚å†…å®¹å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwR84LFHwnK5GXErnwkmD
mPOJl4CSTtYXCqmCtlbF+5qVOosu0YsM2DsrC9O2gun6wVFKkWYiMoBSjsNMSI3Z
w5JYgh+ldHvA+MIex2QXfOZx920M1fPUiuUPgmnTFS+Z3lmK3/T6jJnmciUPY1pe
h4MXL6YzeI0q4W9xNBBeKT6FDGpduc0FC3OlXHfLbVOThKmAUpAWFDwf9/uUA//l
3PLchmV6VwTcUaaHp5W8Af/GU4lPGZbTAqOxzB9ukisPFuO1DikacPhrOQgdxtqk
LciRTa884uQnkFwSguOEUYf3ni8GNRJauIuW0rVXhMOs78pKvCKmo53M0tqeC6ul
+QIDAQAB
-----END PUBLIC KEY-----
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¥½äº†ï¼Œè®©æˆ‘ä»¬æ­£å¼å¼€å§‹ç¼–ç å§ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªå¯ä»¥åŒ¿åè®¿é—®çš„æ¥å£ GET /helloï¼Œç”¨æ¥æµ‹è¯•æ— éœ€ç™»å½•å°±å¯ä»¥è®¿é—®çš„æœåŠ¡ç«¯èµ„æºï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºä¸‰ä¸ªéœ€è¦ç™»å½• + æˆæƒæ‰èƒ½è®¿é—®åˆ°çš„æ¥å£ã€‚æˆ‘ä»¬é€šè¿‡ @PreAuthorize åœ¨æ–¹æ³•æ‰§è¡Œå‰è¿›è¡Œæƒé™æ§åˆ¶ï¼š</p><ul><li>GET /user/name æ¥å£ï¼Œè¯»æƒé™æˆ–å†™æƒé™å¯è®¿é—®ï¼Œè¿”å›ç™»å½•ç”¨æˆ·åï¼›</li><li>GET /user æ¥å£ï¼Œè¯»æƒé™æˆ–å†™æƒé™å¯è®¿é—®ï¼Œè¿”å›ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼›</li><li>POST /user æ¥å£ï¼Œåªæœ‰å†™æƒé™å¯ä»¥è®¿é—®ï¼Œè¿”å›è®¿é—®ä»¤ç‰Œä¸­çš„é¢å¤–ä¿¡æ¯ï¼ˆä¹Ÿå°±æ˜¯è‡ªå®šä¹‰çš„ Token å¢å¼ºå™¨ CustomTokenEnhancer åŠ å…¥åˆ°è®¿é—®ä»¤ç‰Œä¸­çš„é¢å¤–ä¿¡æ¯ï¼ŒKey æ˜¯ userDetailsï¼‰ï¼Œè¿™é‡Œä¹Ÿæ¼”ç¤ºäº†ä½¿ç”¨ TokenStore æ¥è§£æ Token çš„æ–¹å¼ã€‚</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TokenStore</span> tokenStore<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/***
     * è¯»æƒé™æˆ–å†™æƒé™å¯è®¿é—®ï¼Œè¿”å›ç™»å½•ç”¨æˆ·å
     * <span class="token keyword">@param</span> <span class="token parameter">authentication</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAuthority(&#39;READ&#39;) or hasAuthority(&#39;WRITE&#39;)&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token class-name">OAuth2Authentication</span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> authentication<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¯»æƒé™æˆ–å†™æƒé™å¯è®¿é—®ï¼Œè¿”å›ç™»å½•ç”¨æˆ·ä¿¡æ¯
     * <span class="token keyword">@param</span> <span class="token parameter">authentication</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAuthority(&#39;READ&#39;) or hasAuthority(&#39;WRITE&#39;)&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">OAuth2Authentication</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">OAuth2Authentication</span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> authentication<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * åªæœ‰å†™æƒé™å¯ä»¥è®¿é—®ï¼Œè¿”å›è®¿é—®ä»¤ç‰Œä¸­çš„é¢å¤–ä¿¡æ¯
     * <span class="token keyword">@param</span> <span class="token parameter">authentication</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAuthority(&#39;WRITE&#39;)&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">OAuth2Authentication</span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">OAuth2AuthenticationDetails</span> details <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">OAuth2AuthenticationDetails</span><span class="token punctuation">)</span> authentication<span class="token punctuation">.</span><span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OAuth2AccessToken</span> accessToken <span class="token operator">=</span> tokenStore<span class="token punctuation">.</span><span class="token function">readAccessToken</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span><span class="token function">getTokenValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> accessToken<span class="token punctuation">.</span><span class="token function">getAdditionalInformation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span><span class="token string">&quot;userDetails&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºæ ¸å¿ƒçš„èµ„æºæœåŠ¡å™¨é…ç½®ç±»ã€‚</p><ul><li>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä¸‹é¢ä¸¤ç‚¹ï¼šæˆ‘ä»¬ç¡¬ç¼–ç äº†èµ„æºæœåŠ¡å™¨çš„ ID ä¸º userserviceï¼›</li><li>ç°åœ¨æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸è½æ•°æ®åº“çš„ JWT æ–¹å¼ + éå¯¹ç§°åŠ å¯†ï¼Œéœ€è¦é€šè¿‡æœ¬åœ°å…¬é’¥è¿›è¡ŒéªŒè¯ï¼Œå› æ­¤åœ¨è¿™é‡Œæˆ‘ä»¬é…ç½®äº†å…¬é’¥çš„è·¯å¾„ã€‚</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableResourceServer</span> <span class="token comment">//å¯ç”¨èµ„æºæœåŠ¡å™¨</span>
<span class="token annotation punctuation">@EnableGlobalMethodSecurity</span><span class="token punctuation">(</span>prePostEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">//å¯ç”¨æ–¹æ³•æ³¨è§£æ–¹å¼æ¥è¿›è¡Œæƒé™æ§åˆ¶</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResourceServerConfiguration</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceServerConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * å£°æ˜äº†èµ„æºæœåŠ¡å™¨çš„IDæ˜¯userserviceï¼Œå£°æ˜äº†èµ„æºæœåŠ¡å™¨çš„TokenStoreæ˜¯JWT
     * <span class="token keyword">@param</span> <span class="token parameter">resources</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">ResourceServerSecurityConfigurer</span> resources<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        resources<span class="token punctuation">.</span><span class="token function">resourceId</span><span class="token punctuation">(</span><span class="token string">&quot;userservice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tokenStore</span><span class="token punctuation">(</span><span class="token function">tokenStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * é…ç½®TokenStore
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TokenStore</span> <span class="token function">tokenStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JwtTokenStore</span><span class="token punctuation">(</span><span class="token function">jwtAccessTokenConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * é…ç½®å…¬é’¥
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">protected</span> <span class="token class-name">JwtAccessTokenConverter</span> <span class="token function">jwtAccessTokenConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JwtAccessTokenConverter</span> converter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JwtAccessTokenConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Resource</span> resource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;public.cert&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> publicKey <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            publicKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">FileCopyUtils</span><span class="token punctuation">.</span><span class="token function">copyToByteArray</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        converter<span class="token punctuation">.</span><span class="token function">setVerifierKey</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> converter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * é…ç½®äº†é™¤äº†/userè·¯å¾„ä¹‹å¤–çš„è¯·æ±‚å¯ä»¥åŒ¿åè®¿é—®
     * <span class="token keyword">@param</span> <span class="token parameter">http</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/user/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ¥æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆæƒæœåŠ¡å™¨äº§ç”Ÿ Token çš„è¯ï¼Œå—ä¿æŠ¤èµ„æºæœåŠ¡å™¨å¿…é¡»è¦æœ‰ä¸€ç§åŠæ³•æ¥éªŒè¯ Tokenï¼Œé‚£å¦‚æœè¿™é‡Œçš„ Token ä¸æ˜¯ JWT çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æˆ‘æ¥è¯´ä¸‹æˆ‘çš„æ–¹æ³•å§ï¼š</p><ul><li>é¦–å…ˆï¼ŒToken å¯ä»¥ä¿å­˜åœ¨æ•°æ®åº“æˆ– Redis ä¸­ï¼Œèµ„æºæœåŠ¡å™¨å’ŒæˆæƒæœåŠ¡å™¨å…±äº«åº•å±‚çš„ TokenStore æ¥éªŒè¯ï¼›</li><li>ç„¶åï¼Œèµ„æºæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ RemoteTokenServicesï¼Œæ¥ä»æˆæƒæœåŠ¡å™¨çš„ /oauth/check_token ç«¯ç‚¹è¿›è¡Œ Token æ ¡éªŒã€‚</li></ul><p>åˆ°è¿™é‡Œï¼Œèµ„æºæœåŠ¡å™¨å°±é…ç½®å®Œæˆäº†ï¼Œæˆ‘ä»¬è¿˜åœ¨èµ„æºæœåŠ¡å™¨ä¸­åˆ†åˆ«åˆ›å»ºäº†ä¸¤ä¸ªæ§åˆ¶å™¨ HelloController å’Œ UserControllerï¼Œç”¨äºåˆ†åˆ«æµ‹è¯•å¯ä»¥åŒ¿åè®¿é—®ä»¥åŠå—åˆ°æƒé™ä¿æŠ¤çš„èµ„æºã€‚</p><h3 id="åˆå§‹åŒ–æ•°æ®é…ç½®" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–æ•°æ®é…ç½®"><span>åˆå§‹åŒ–æ•°æ®é…ç½®</span></a></h3><p>åœ¨å®ç°äº†æˆæƒæœåŠ¡å™¨å’Œå—ä¿æŠ¤èµ„æºæœåŠ¡å™¨ä»£ç åï¼Œæˆ‘ä»¬å†æ¥åˆå§‹åŒ– oauth æ•°æ®åº“çš„æ•°æ®å°±éå¸¸å®¹æ˜“ç†è§£äº†ã€‚æ€»ç»“èµ·æ¥ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ç”¨æˆ·ã€æƒé™å’Œå®¢æˆ·ç«¯ä¸‰éƒ¨åˆ†ã€‚</p><ol><li>é…ç½®ä¸¤ä¸ªç”¨æˆ·ã€‚å…¶ä¸­ï¼Œè¯»ç”¨æˆ· reader å…·æœ‰è¯»æƒé™ï¼Œå¯†ç ä¸º readerï¼›å†™ç”¨æˆ· writer å…·æœ‰è¯»å†™æƒé™ï¼Œå¯†ç ä¸º writerã€‚è¿˜è®°å¾—å—ï¼Œå¯†ç æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ BCryptPasswordEncoder åŠ å¯†ï¼ˆå‡†ç¡®è¯´æ˜¯å“ˆå¸Œï¼‰ï¼Ÿ</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;reader&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;$2a$04$C6pPJvC1v6.enW6ZZxX.luTdpSI/1gcgTVN7LhvQV6l/AfmzNU/3i&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>users<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;writer&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;$2a$04$M9t2oVs3/VIreBMocOujqOaB/oziWL0SnlWdt8hV4YnlhQrORA0fS&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>é…ç½®ä¸¤ä¸ªæƒé™ï¼Œä¹Ÿå°±æ˜¯é…ç½® reader ç”¨æˆ·å…·æœ‰è¯»æƒé™ï¼Œwriter ç”¨æˆ·å…·æœ‰å†™æƒé™ï¼š</li></ol><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>authorities<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;reader&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;READ&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>authorities<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;writer&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;READ,WRITE&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><p>é…ç½®ä¸‰ä¸ªå®¢æˆ·ç«¯ï¼Œå…¶ä¸­å®¢æˆ·ç«¯ userservice1 ä½¿ç”¨èµ„æºæ‹¥æœ‰è€…å‡­æ®è®¸å¯ç±»å‹ï¼Œå®¢æˆ·ç«¯ userservice2 ä½¿ç”¨å®¢æˆ·ç«¯å‡­æ®è®¸å¯ç±»å‹ï¼Œå®¢æˆ·ç«¯ userservice3 ä½¿ç”¨æˆæƒç è®¸å¯ç±»å‹ã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>oauth_client_details<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;userservice1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;userservice&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1234&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;FOO&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;password,refresh_token&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;READ,WRITE&#39;</span><span class="token punctuation">,</span> <span class="token number">7200</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">&#39;true&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>oauth_client_details<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;userservice2&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;userservice&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1234&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;FOO&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;client_credentials,refresh_token&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;READ,WRITE&#39;</span><span class="token punctuation">,</span> <span class="token number">7200</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">&#39;true&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>oauth_client_details<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;userservice3&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;userservice&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1234&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;FOO&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;authorization_code,refresh_token&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://baidu.com,http://localhost:8082/ui/login,http://localhost:8083/ui/login,http://localhost:8082/ui/remoteCall&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;READ,WRITE&#39;</span><span class="token punctuation">,</span> <span class="token number">7200</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">&#39;false&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å€¼å¾—è¯´æ˜çš„æ˜¯ï¼š</p><ul><li>ä¸‰ä¸ªå®¢æˆ·ç«¯è´¦å·èƒ½ä½¿ç”¨çš„èµ„æº ID éƒ½æ˜¯ userserviceï¼Œå¯¹åº”æˆ‘ä»¬å—ä¿æŠ¤èµ„æºæœåŠ¡å™¨åˆšæ‰é…ç½®çš„èµ„æº IDï¼Œä¹Ÿå°±æ˜¯ userserviceï¼Œè¿™ä¸¤è€…éœ€è¦ä¸€è‡´ã€‚</li><li>ä¸‰ä¸ªå®¢æˆ·ç«¯è´¦å·çš„å¯†ç éƒ½æ˜¯ 1234ã€‚</li><li>ä¸‰ä¸ªå®¢æˆ·ç«¯è´¦å·çš„æˆæƒèŒƒå›´éƒ½æ˜¯ FOOï¼ˆå¹¶ä¸æ˜¯å…³é”®ä¿¡æ¯ï¼‰ï¼Œå®ƒä»¬å¯ä»¥æ‹¿åˆ°çš„æƒé™æ˜¯è¯»å†™ã€‚ä¸è¿‡ï¼Œå¯¹äºå’Œç”¨æˆ·ç›¸å…³çš„æˆæƒè®¸å¯ç±»å‹ï¼ˆæ¯”å¦‚èµ„æºæ‹¥æœ‰è€…å‡­æ®è®¸å¯ã€æˆæƒç è®¸å¯ï¼‰ï¼Œæœ€ç»ˆæ‹¿åˆ°çš„æƒé™è¿˜å–å†³äºå®¢æˆ·ç«¯æƒé™å’Œç”¨æˆ·æƒé™çš„äº¤é›†ã€‚</li><li>é€šè¿‡ grant_types å­—æ®µé…ç½®æ”¯æŒä¸åŒçš„æˆæƒè®¸å¯ç±»å‹ã€‚è¿™é‡Œä¸ºäº†ä¾¿äºæµ‹è¯•è§‚å¯Ÿï¼Œæˆ‘ä»¬ç»™ä¸‰ä¸ªå®¢æˆ·ç«¯è´¦å·å„è‡ªé…ç½®äº†ä¸€ç§æˆæƒè®¸å¯ç±»å‹ï¼›åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œä½ å®Œå…¨å¯ä»¥ä¸ºåŒä¸€ä¸ªå®¢æˆ·ç«¯é…ç½®æ”¯æŒ OAuth 2.0 çš„å››ç§æˆæƒè®¸å¯ç±»å‹ã€‚</li><li>userservice1 å’Œ userservice2 æˆ‘ä»¬é…ç½®äº†ç”¨æˆ·è‡ªåŠ¨æ‰¹å‡†æˆæƒï¼ˆä¸ä¼šå¼¹å‡ºä¸€ä¸ªé¡µé¢è¦æ±‚ç”¨æˆ·è¿›è¡Œæˆæƒï¼‰ã€‚</li></ul></li></ol><h3 id="æ¼”ç¤ºä¸‰ç§æˆæƒè®¸å¯ç±»å‹" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤ºä¸‰ç§æˆæƒè®¸å¯ç±»å‹"><span>æ¼”ç¤ºä¸‰ç§æˆæƒè®¸å¯ç±»å‹</span></a></h3><p>åˆ°è¿™é‡Œï¼ŒæˆæƒæœåŠ¡å™¨å’Œå—ä¿æŠ¤èµ„æºæœåŠ¡å™¨ç¨‹åºéƒ½æ­å»ºå®Œæˆäº†ï¼Œæ•°æ®åº“ä¹Ÿé…ç½®äº†ç”¨äºæµ‹è¯•çš„ç”¨æˆ·ã€æƒé™å’Œå®¢æˆ·ç«¯ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ Postman æ¥æ‰‹å·¥æµ‹è¯•ä¸€ä¸‹ OAuth 2.0 çš„æˆæƒç è®¸å¯ã€èµ„æºæ‹¥æœ‰è€…å‡­æ®è®¸å¯ã€å®¢æˆ·ç«¯å‡­æ®è®¸å¯è¿™ä¸‰ç§æˆæƒè®¸å¯ç±»å‹å§ã€‚</p><h3 id="èµ„æºæ‹¥æœ‰è€…å‡­æ®è®¸å¯ç±»å‹" tabindex="-1"><a class="header-anchor" href="#èµ„æºæ‹¥æœ‰è€…å‡­æ®è®¸å¯ç±»å‹"><span>èµ„æºæ‹¥æœ‰è€…å‡­æ®è®¸å¯ç±»å‹</span></a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æµ‹è¯•çš„æ˜¯èµ„æºæ‹¥æœ‰è€…å‡­æ®è®¸å¯ï¼ŒPOST è¯·æ±‚åœ°å€æ˜¯ï¼š</p><p>http://localhost:8080/oauth/token?grant_type=password&amp;client_id=userservice1&amp;client_secret=1234&amp;username=writer&amp;password=writer</p><p>å¾—åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºç»“æœï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/18cd7b24ff152e28806b1176b0a560e4.png" alt="img"></p><p>å†ä½¿ç”¨<a href="http://jwt.io/" target="_blank" rel="noopener noreferrer">JWT è§£æå·¥å…·<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>çœ‹ä¸‹è¯·æ±‚ Token ä¸­çš„ä¿¡æ¯ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/8e4c2dd1931a31197df55cc251b2a07e.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒToken ä¸­æœç„¶åŒ…å«äº† Token å¢å¼ºå™¨åŠ å…¥çš„ userDetails è‡ªå®šä¹‰ä¿¡æ¯ã€‚å¦‚æœæˆ‘ä»¬æŠŠå…¬é’¥ç²˜è´´åˆ°é¡µé¢çš„è¯ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ª JWT æ ¡éªŒæˆåŠŸäº†ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/4d701319144d3de7c5d743f59e4991ae.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒToken ä¸­æœç„¶åŒ…å«äº† Token å¢å¼ºå™¨åŠ å…¥çš„ userDetails è‡ªå®šä¹‰ä¿¡æ¯ã€‚å¦‚æœæˆ‘ä»¬æŠŠå…¬é’¥ç²˜è´´åˆ°é¡µé¢çš„è¯ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ª JWT æ ¡éªŒæˆåŠŸäº†ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/4d701319144d3de7c5d743f59e4991ae.png" alt="img"></p><p>é™¤äº†æœ¬åœ°æ ¡éªŒå¤–ï¼Œè¿˜å¯ä»¥è®¿é—®æˆæƒæœåŠ¡å™¨æ¥æ ¡éªŒ JWTï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>
http://localhost:8080/oauth/check_token?client_id<span class="token operator">=</span>userservice1<span class="token operator">&amp;</span><span class="token assign-left variable">client_secret</span><span class="token operator">=</span><span class="token number">1234</span><span class="token operator">&amp;</span><span class="token assign-left variable">token</span><span class="token operator">=</span><span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/2835c0d2b49ac515c9f6c537dd2f7195.png" alt="img"></p><h3 id="å®¢æˆ·ç«¯æˆæƒè®¸å¯ç±»å‹" tabindex="-1"><a class="header-anchor" href="#å®¢æˆ·ç«¯æˆæƒè®¸å¯ç±»å‹"><span>å®¢æˆ·ç«¯æˆæƒè®¸å¯ç±»å‹</span></a></h3><p>æˆ‘ä»¬å†æ¥æµ‹è¯•ä¸‹å®¢æˆ·ç«¯æˆæƒè®¸å¯ç±»å‹ã€‚POST è¯·æ±‚åœ°å€ï¼šhttp://localhost:8080/oauth/token?grant_type=client_credentials&amp;client_id=userservice2&amp;client_secret=1234</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥ç›´æ¥æ‹¿åˆ° Tokenï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/81722855fd6935aea594ec62b64bf0e9.png" alt="img"></p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶æ²¡æœ‰æä¾›åˆ·æ–°ä»¤ç‰Œã€‚è¿™æ˜¯å› ä¸ºï¼Œåˆ·æ–°ä»¤ç‰Œç”¨äºé¿å…è®¿é—®ä»¤ç‰Œå¤±æ•ˆåéœ€è¦ç”¨æˆ·å†æ¬¡ç™»å½•çš„é—®é¢˜ï¼Œè€Œå®¢æˆ·ç«¯æˆæƒè®¸å¯ç±»å‹æ²¡æœ‰ç”¨æˆ·çš„æ¦‚å¿µï¼Œå› æ­¤æ²¡æœ‰åˆ·æ–°ä»¤ç‰Œï¼Œä¹Ÿæ— æ³•æ³¨å…¥é¢å¤–çš„ userDetails ä¿¡æ¯ã€‚</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/fcf2b1c1a53ecc33d3a0abc72b6d83da.png" alt="img"></p><p>ä¹Ÿå¯ä»¥è¯•ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çš„æˆæƒæœåŠ¡å™¨æ²¡æœ‰å¼€å¯ allowFormAuthenticationForClients å‚æ•°ï¼ˆå…è®¸è¡¨å•æäº¤è®¤è¯ï¼‰çš„è¯ï¼Œå®¢æˆ·ç«¯çš„å‡­è¯éœ€è¦é€šè¿‡ Basic Auth ä¼ è¿‡å»è€Œä¸æ˜¯é€šè¿‡ Postï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/ce391c3c93e2131e1cf8fb4e3324b66f.png" alt="img"></p><h3 id="æˆæƒç è®¸å¯ç±»å‹" tabindex="-1"><a class="header-anchor" href="#æˆæƒç è®¸å¯ç±»å‹"><span>æˆæƒç è®¸å¯ç±»å‹</span></a></h3><p>æœ€åï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸‹æ¯”è¾ƒå¤æ‚çš„æˆæƒç è®¸å¯ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—®åœ°å€ï¼šhttp://localhost:8080/oauth/authorize?response_type=code&amp;client_id=userservice3&amp;redirect_uri=https://baidu.com</p><p>æ³¨æ„ï¼Œå®¢æˆ·ç«¯è·³è½¬åœ°å€éœ€è¦å’Œæ•°æ®åº“ä¸­é…ç½®çš„ä¸€è‡´ï¼ˆç™¾åº¦çš„ URL https://baidu.comæˆ‘ä»¬ä¹‹å‰å·²ç»åœ¨æ•°æ®åº“ä¸­æœ‰é…ç½®äº†ï¼‰ã€‚è®¿é—®åé¡µé¢ä¼šç›´æ¥è·³è½¬åˆ°ç™»å½•ç•Œé¢ï¼Œæˆ‘ä»¬ä½¿ç”¨ç”¨æˆ·åâ€œreaderâ€ã€å¯†ç â€œreaderâ€æ¥ç™»å½•ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/73c3bd926e4e350b220447cd8b97d811.png" alt="img"></p><p>ç”±äºæˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­è®¾ç½®çš„æ˜¯ç¦ç”¨è‡ªåŠ¨æ‰¹å‡†æˆæƒçš„æ¨¡å¼ï¼Œæ‰€ä»¥ç™»å½•åæ¥åˆ°äº†æ‰¹å‡†ç•Œé¢ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/9cac3b06b632220166d7e43607da4901.png" alt="img"></p><p>ç‚¹å‡»åŒæ„åå¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®åº“ä¸­ä¹Ÿä¼šäº§ç”Ÿæˆæƒé€šè¿‡è®°å½•ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/9e942cc7c22ff8b4540e9f6736d56b6f.png" alt="img"></p><p>ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æµè§ˆå™¨è½¬åˆ°äº†ç™¾åº¦å¹¶ä¸”æä¾›ç»™äº†æˆ‘ä»¬æˆæƒç ï¼šhttps://www.baidu.com/?code=XKkHGY</p><p>æ•°æ®åº“ä¸­ä¹Ÿè®°å½•äº†æˆæƒç ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/eff235ff90aafb559d6e45b07a4d173e.png" alt="img"></p><p>ç„¶å POST è®¿é—®ä¸‹é¢çš„åœ°å€ï¼ˆcode å‚æ•°æ›¿æ¢ä¸ºåˆšæ‰è·å¾—çš„æˆæƒç ï¼‰ï¼šhttp://localhost:8080/oauth/token?grant_type=authorization_code&amp;client_id=userservice3&amp;client_secret=1234&amp;code=XKkHGY&amp;redirect_uri=https://baidu.com</p><p>å¯ä»¥é€šè¿‡æˆæƒç æ¢å–è®¿é—®ä»¤ç‰Œï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/ea401694bf55f83353f7db65d17ab6d7.png" alt="img"></p><p>è™½ç„¶ userservice3 å®¢æˆ·ç«¯å¯ä»¥æœ‰è¯»æƒé™å’Œå†™æƒé™ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬ç™»å½•çš„ç”¨æˆ· reader åªæœ‰è¯»æƒé™ï¼Œæ‰€ä»¥æœ€åæ‹¿åˆ°ä¹Ÿåªæœ‰è¯»æƒé™ã€‚</p><h3 id="æ¼”ç¤ºæƒé™æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤ºæƒé™æ§åˆ¶"><span>æ¼”ç¤ºæƒé™æ§åˆ¶</span></a></h3><p>ç°åœ¨æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ä¹‹å‰å®šä¹‰çš„ä¸¤ä¸ªè´¦å·ï¼Œä¹Ÿå°±æ˜¯è¯»è´¦å·å’Œå†™è´¦å·ï¼Œçœ‹çœ‹å®ƒä»¬çš„æƒé™æ§åˆ¶æ˜¯å¦æœ‰æ•ˆã€‚</p><p>é¦–å…ˆï¼Œæµ‹è¯•ä¸€ä¸‹æˆ‘ä»¬çš„å®‰å…¨é…ç½®ï¼Œè®¿é—® /hello ç«¯ç‚¹ä¸éœ€è¦è®¤è¯å¯ä»¥åŒ¿åè®¿é—®ï¼š<img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/7646fe1e6e4cc9914f79881576126459.png" alt="img"></p><p>è®¿é—® /user éœ€è¦èº«ä»½è®¤è¯ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/3b22a89392c92187960aecd4bc3cf8f6.png" alt="img"></p><p>ä¸ç®¡ä»¥å“ªç§æ¨¡å¼æ‹¿åˆ°è®¿é—®ä»¤ç‰Œï¼Œæˆ‘ä»¬ç”¨å…·æœ‰è¯»æƒé™çš„è®¿é—®ä»¤ç‰Œè®¿é—®èµ„æºæœåŠ¡å™¨çš„å¦‚ä¸‹åœ°å€ï¼ˆè¯·æ±‚å¤´åŠ å…¥ Authorization: Bearer XXXXXXXXXXï¼Œå…¶ä¸­ XXXXXXXXXX ä»£è¡¨è®¿é—®ä»¤ç‰Œï¼‰ï¼šhttp://localhost:8081/user/</p><p>å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/0606fbb094de245d346ed17d9yycd6d5.png" alt="img"></p><p>ä»¥ POST æ–¹å¼è®¿é—® http://localhost:8081/user/ï¼Œæ˜¾ç„¶æ˜¯å¤±è´¥çš„ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/a71bcef74da7577aa1529bf2d9546588.png" alt="img"></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAuthority(&#39;WRITE&#39;)&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">OAuth2Authentication</span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬æ¢ä¸€ä¸ªå…·æœ‰è¯»å†™æƒé™çš„è®¿é—®ä»¤ç‰Œæ¥è¯•è¯•ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/a754a6fdcb9666e07f1b820052a4e2fc.png" alt="img"></p><p>å¯ä»¥å‘ç°ï¼Œæœç„¶è®¿é—®æˆåŠŸäº†ã€‚è¿™é‡Œè¾“å‡ºçš„å†…å®¹æ˜¯ Token ä¸­çš„ userDetails é¢å¤–ä¿¡æ¯ï¼Œè¯´æ˜èµ„æºæœåŠ¡å™¨çš„æƒé™æ§åˆ¶æœ‰æ•ˆã€‚</p><h3 id="æ­å»ºå®¢æˆ·ç«¯ç¨‹åº" tabindex="-1"><a class="header-anchor" href="#æ­å»ºå®¢æˆ·ç«¯ç¨‹åº"><span>æ­å»ºå®¢æˆ·ç«¯ç¨‹åº</span></a></h3><p>åœ¨ä¸Šé¢çš„æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Postmanï¼Œä¹Ÿå°±æ˜¯æ‰‹åŠ¨ HTTP è¯·æ±‚çš„æ–¹å¼æ¥ç”³è¯·å’Œä½¿ç”¨ Tokenã€‚æœ€åï¼Œæˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ª OAuth å®¢æˆ·ç«¯ç¨‹åºè‡ªåŠ¨å®ç°è¿™ä¸ªè¿‡ç¨‹ã€‚</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>
<span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springsecurity101<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>me.josephzhu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springsecurity101-cloud-oauth2-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-oauth2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8083</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /ui
<span class="token key atrule">security</span><span class="token punctuation">:</span>
  <span class="token key atrule">oauth2</span><span class="token punctuation">:</span>
    <span class="token key atrule">client</span><span class="token punctuation">:</span>
      <span class="token key atrule">clientId</span><span class="token punctuation">:</span> userservice3
      <span class="token key atrule">clientSecret</span><span class="token punctuation">:</span> <span class="token number">1234</span>
      <span class="token key atrule">accessTokenUri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/oauth/token
      <span class="token key atrule">userAuthorizationUri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/oauth/authorize
      <span class="token key atrule">scope</span><span class="token punctuation">:</span> FOO
    <span class="token key atrule">resource</span><span class="token punctuation">:</span>
      <span class="token key atrule">jwt</span><span class="token punctuation">:</span>
        <span class="token key atrule">key-value</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          -----BEGIN PUBLIC KEY-----
          ***
          -----END PUBLIC KEY-----</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">thymeleaf</span><span class="token punctuation">:</span>
    <span class="token key atrule">cache</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

<span class="token comment">#logging:</span>
<span class="token comment">#  level:</span>
<span class="token comment">#    ROOT: DEBUG</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯é¡¹ç›®ç«¯å£ 8082ï¼Œå‡ ä¸ªéœ€è¦è¯´æ˜çš„åœ°æ–¹ï¼š</p><ul><li>æœ¬åœ°æµ‹è¯•çš„æ—¶å€™æœ‰ä¸€ä¸ªå‘ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦é…ç½® context-pathï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°å®¢æˆ·ç«¯å’ŒæˆæƒæœåŠ¡å™¨æœåŠ¡ç«¯ Cookie å¹²æ‰°ï¼Œå¯¼è‡´ CSRF é˜²å¾¡è§¦å‘çš„é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜å‡ºç°åç¨‹åºæ²¡æœ‰ä»»ä½•é”™è¯¯æ—¥å¿—è¾“å‡ºï¼Œåªæœ‰å¼€å¯ DEBUG æ¨¡å¼åæ‰èƒ½çœ‹åˆ° DEBUG æ—¥å¿—é‡Œæœ‰æç¤ºï¼Œå› æ­¤è¿™ä¸ªé—®é¢˜éå¸¸éš¾ä»¥æ’æŸ¥ã€‚è¯´å®è¯ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ Spring ä¸ºä»€ä¹ˆä¸æŠŠè¿™ä¸ªä¿¡æ¯ä½œä¸º WARN çº§åˆ«çš„æ—¥å¿—è¾“å‡ºã€‚</li><li>ä½œä¸º OAuth å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬éœ€è¦é…ç½® OAuth æœåŠ¡ç«¯è·å– Token çš„åœ°å€ã€æˆæƒï¼ˆè·å–æˆæƒç ï¼‰çš„åœ°å€ï¼Œéœ€è¦é…ç½®å®¢æˆ·ç«¯çš„ IDã€å¯†ç å’ŒæˆæƒèŒƒå›´ã€‚</li><li>å› ä¸ºä½¿ç”¨çš„æ˜¯ JWT Tokenï¼Œæˆ‘ä»¬éœ€è¦é…ç½®å…¬é’¥ï¼ˆå½“ç„¶ï¼Œå¦‚æœä¸åœ¨è¿™é‡Œç›´æ¥é…ç½®å…¬é’¥çš„è¯ï¼Œä¹Ÿå¯ä»¥é…ç½®ä»æˆæƒæœåŠ¡å™¨æœåŠ¡ç«¯è·å–å…¬é’¥ï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ç¼–ç äº†ã€‚</li></ul><p>ç¬¬ä¸€æ­¥ï¼Œå®ç° MVC çš„é…ç½®ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * é…ç½®RequestContextListenerç”¨äºå¯ç”¨session scopeçš„Bean
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RequestContextListener</span> <span class="token function">requestContextListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RequestContextListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * é…ç½®indexè·¯å¾„çš„é¦–é¡µController
     * <span class="token keyword">@param</span> <span class="token parameter">registry</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">&quot;forward:/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œåšäº†ä¸¤ä»¶äº‹æƒ…ï¼š</p><ol><li>é…ç½® RequestContextListenerï¼Œç”¨äºå¯ç”¨ session scope çš„ Beanï¼›</li><li>é…ç½®äº† index è·¯å¾„çš„é¦–é¡µ Controllerã€‚</li></ol><p>ç¬¬äºŒæ­¥ï¼Œå®ç°å®‰å…¨æ–¹é¢çš„é…ç½®ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebSecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * /è·¯å¾„å’Œ/loginè·¯å¾„å…è®¸è®¿é—®ï¼Œå…¶å®ƒè·¯å¾„éœ€è¦èº«ä»½è®¤è¯åæ‰èƒ½è®¿é—®
     * <span class="token keyword">@param</span> <span class="token parameter">http</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http
                <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/login**&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬å®ç°çš„æ˜¯ / è·¯å¾„å’Œ /login è·¯å¾„å…è®¸è®¿é—®ï¼Œå…¶å®ƒè·¯å¾„éœ€è¦èº«ä»½è®¤è¯åæ‰èƒ½è®¿é—®ã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">OAuth2RestTemplate</span> restTemplate<span class="token punctuation">;</span>
    <span class="token comment">//æ¼”ç¤ºç™»å½•åæ‰èƒ½è®¿é—®çš„å®‰å…¨é¡µé¢</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/securedPage&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">securedPage</span><span class="token punctuation">(</span><span class="token class-name">OAuth2Authentication</span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">&quot;securedPage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">&quot;authentication&quot;</span><span class="token punctuation">,</span> authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ¼”ç¤ºé€šè¿‡OAuth2RestTemplateè°ƒç”¨å—ä¿æŠ¤èµ„æº</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/remoteCall&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">remoteCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> responseEntity <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForEntity</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8081/user/name&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> responseEntity<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬å®ç°äº†ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ol><li>securedPage é¡µé¢ï¼Œå®ç°çš„åŠŸèƒ½æ˜¯ï¼ŒæŠŠç”¨æˆ·ä¿¡æ¯ä½œä¸ºæ¨¡å‹ä¼ å…¥äº†è§†å›¾ï¼Œè¿™æ ·æ‰“å¼€é¡µé¢åå°±èƒ½æ˜¾ç¤ºç”¨æˆ·åå’Œæƒé™ã€‚</li><li>remoteCall æ¥å£ï¼Œå®ç°çš„åŠŸèƒ½æ˜¯ï¼Œé€šè¿‡å¼•å…¥ OAuth2RestTemplateï¼Œåœ¨ç™»å½•åå°±å¯ä»¥ä½¿ç”¨å‡­æ®ç›´æ¥ä»å—ä¿æŠ¤èµ„æºæœåŠ¡å™¨æ‹¿èµ„æºï¼Œä¸éœ€è¦ç¹çåœ°å®ç°è·å¾—è®¿é—®ä»¤ç‰Œã€åœ¨è¯·æ±‚å¤´é‡ŒåŠ å…¥è®¿é—®ä»¤ç‰Œçš„è¿‡ç¨‹ã€‚</li></ol><p>ç¬¬å››æ­¥ï¼Œé…ç½®ä¸€ä¸‹åˆšæ‰ç”¨åˆ°çš„ OAuth2RestTemplate Beanï¼Œå¹¶å¯ç”¨ OAuth2Sso åŠŸèƒ½ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableOAuth2Sso</span> <span class="token comment">//è¿™ä¸ªæ³¨è§£åŒ…å«äº†@EnableOAuth2Client</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OAuthClientConfig</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * å®šä¹‰äº†OAuth2RestTemplateï¼Œç½‘ä¸Šä¸€äº›æ¯”è¾ƒè€çš„èµ„æ–™ç»™å‡ºçš„æ˜¯æ‰‹åŠ¨è¯»å–é…ç½®æ–‡ä»¶æ¥å®ç°ï¼Œæœ€æ–°ç‰ˆæœ¬å·²ç»å¯ä»¥è‡ªåŠ¨æ³¨å…¥OAuth2ProtectedResourceDetails
     * <span class="token keyword">@param</span> <span class="token parameter">oAuth2ClientContext</span>
     * <span class="token keyword">@param</span> <span class="token parameter">details</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">OAuth2RestTemplate</span> <span class="token function">oauth2RestTemplate</span><span class="token punctuation">(</span><span class="token class-name">OAuth2ClientContext</span> oAuth2ClientContext<span class="token punctuation">,</span>
                                                 <span class="token class-name">OAuth2ProtectedResourceDetails</span> details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OAuth2RestTemplate</span><span class="token punctuation">(</span>details<span class="token punctuation">,</span> oAuth2ClientContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬äº”æ­¥ï¼Œå®ç°é¦–é¡µï¼š</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-sm-12<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Spring Security SSO Client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>securedPage<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥åŠç™»å½•åæ‰èƒ½è®¿é—®çš„ securedPage é¡µé¢ï¼š</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-sm-12<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Secured Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        Welcome, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${authentication.name}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
        Your authorities are <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>${authentication.authorities}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>authorities<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ¼”ç¤ºå•ç‚¹ç™»å½•" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤ºå•ç‚¹ç™»å½•"><span>æ¼”ç¤ºå•ç‚¹ç™»å½•</span></a></h3><p>å¥½ï¼Œå®¢æˆ·ç«¯ç¨‹åºæ­å»ºå¥½ä¹‹åï¼Œæˆ‘ä»¬å…ˆæ¥æµ‹è¯•ä¸€ä¸‹å•ç‚¹ç™»å½•çš„åŠŸèƒ½ã€‚å¯åŠ¨å®¢æˆ·ç«¯é¡¹ç›®ï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8082/ui/securedPage</p><p>å¯ä»¥çœ‹åˆ°ï¼Œé¡µé¢è‡ªåŠ¨è½¬åˆ°äº†æˆæƒæœåŠ¡å™¨ï¼ˆ8080 ç«¯å£ï¼‰çš„ç™»å½•é¡µé¢ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/05b76f316304e3ef2d1494bae501c381.png" alt="img"></p><p>ç™»å½•åæ˜¾ç¤ºäº†å½“å‰ç”¨æˆ·åå’Œæƒé™ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/7d24bc73267506c15f9feyy546557237.png" alt="img"></p><p>æˆ‘ä»¬å†å¯åŠ¨å¦ä¸€ä¸ªå®¢æˆ·ç«¯ç½‘ç«™ï¼Œç«¯å£æ”¹ä¸º 8083ï¼Œç„¶åè®¿é—®åŒæ ·çš„åœ°å€ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/7a50619ace3e40c8ff7c0aa860f11246.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ç›´æ¥æ˜¯ç™»å½•çŠ¶æ€ï¼Œå•ç‚¹ç™»å½•æµ‹è¯•æˆåŠŸã€‚æ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿå…¶å®ï¼Œä¸ºäº†è¾¾æˆå•ç‚¹ç™»å½•çš„æ•ˆæœï¼Œç¨‹åºåœ¨èƒŒåè‡ªåŠ¨å®ç°äº†å¤šæ¬¡ 302 é‡å®šå‘ï¼Œæ•´ä¸ªæµç¨‹ä¸ºï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>
http://localhost:8083/ui/securedPage -<span class="token operator">&gt;</span>
http://localhost:8083/ui/login -<span class="token operator">&gt;</span>
http://localhost:8080/oauth/authorize?client_id<span class="token operator">=</span>userservice3<span class="token operator">&amp;</span><span class="token assign-left variable">redirect_uri</span><span class="token operator">=</span>http://localhost:8083/ui/login<span class="token operator">&amp;</span><span class="token assign-left variable">response_type</span><span class="token operator">=</span>code<span class="token operator">&amp;</span><span class="token assign-left variable">scope</span><span class="token operator">=</span>FOO<span class="token operator">&amp;</span><span class="token assign-left variable">state</span><span class="token operator">=</span>Sobjqe -<span class="token operator">&gt;</span>
http://localhost:8083/ui/login?code<span class="token operator">=</span>CDdvHa<span class="token operator">&amp;</span><span class="token assign-left variable">state</span><span class="token operator">=</span>Sobjqe -<span class="token operator">&gt;</span>
http://localhost:8083/ui/securedPage
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ¼”ç¤ºå®¢æˆ·ç«¯è¯·æ±‚èµ„æºæœåŠ¡å™¨èµ„æº" tabindex="-1"><a class="header-anchor" href="#æ¼”ç¤ºå®¢æˆ·ç«¯è¯·æ±‚èµ„æºæœåŠ¡å™¨èµ„æº"><span>æ¼”ç¤ºå®¢æˆ·ç«¯è¯·æ±‚èµ„æºæœåŠ¡å™¨èµ„æº</span></a></h3><p>è¿˜è®°å¾—å—ï¼Œåœ¨ä¸Šä¸€èŠ‚â€œæ­å»ºå®¢æˆ·ç«¯ç¨‹åºâ€ä¸­ï¼Œæˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ª remoteCall æ¥å£ï¼Œç›´æ¥ä½¿ç”¨ OAuth2RestTemplate æ¥è®¿é—®è¿œç¨‹èµ„æºæœåŠ¡å™¨çš„èµ„æºã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹è¿™ä¸ªæ¥å£æ˜¯å¦å¯ä»¥å®ç°è‡ªåŠ¨çš„ OAuth æµç¨‹ã€‚è®¿é—®ï¼šhttp://localhost:8082/ui/remoteCall</p><p>ä¼šå…ˆè½¬åˆ°æˆæƒæœåŠ¡å™¨ç™»å½•ï¼Œç™»å½•åè‡ªåŠ¨è·³è½¬å›æ¥ï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/016f28b7161d2c600197aa2392b0de27.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†ç”¨æˆ·åï¼Œå¯¹åº”çš„èµ„æºæœåŠ¡å™¨æœåŠ¡ç«¯æ¥å£æ˜¯ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">&quot;hasAuthority(&#39;READ&#39;) or hasAuthority(&#39;WRITE&#39;)&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token class-name">OAuth2Authentication</span> authentication<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> authentication<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¢ä¸€ä¸ª writer ç”¨æˆ·ç™»å½•è¯•è¯•ï¼Œä¹Ÿèƒ½å¾—åˆ°æ­£ç¡®çš„è¾“å‡ºï¼š</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/yy2bca66c45cefa56d2d727c3a136a84.png" alt="img"></p><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å®Œæ•´æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Spring Cloud çš„ OAuth 2.0 ç»„ä»¶åŸºäºä¸‰ä¸ªç¨‹åºè§’è‰²ï¼ˆæˆæƒæœåŠ¡å™¨ã€å—ä¿æŠ¤èµ„æºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼‰å®ç°ä¸‰ç§ OAuth 2.0 çš„æˆæƒè®¸å¯ç±»å‹ï¼ˆèµ„æºæ‹¥æœ‰è€…å‡­æ®è®¸å¯ã€å®¢æˆ·ç«¯å‡­æ®è®¸å¯å’Œæˆæƒç è®¸å¯ï¼‰ã€‚</p><p>æˆ‘ä»¬å…ˆæ¼”ç¤ºäº†ä¸‰ç§æˆæƒè®¸å¯ç±»å‹çš„æ‰‹åŠ¨æµç¨‹ï¼Œç„¶åä¹Ÿæ¼”ç¤ºäº†å¦‚ä½•å®ç°æƒé™æ§åˆ¶å’Œå•ç‚¹ç™»å½•ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®¢æˆ·ç«¯ç¨‹åºæ¥å®ç°è‡ªåŠ¨çš„ OAuth 2.0 æµç¨‹ã€‚</p><p>æˆ‘æŠŠä»Šå¤©ç”¨åˆ°çš„æ‰€æœ‰ä»£ç éƒ½æ”¾åˆ°äº† GitHub ä¸Šï¼Œä½ å¯ä»¥ç‚¹å‡»è¿™ä¸ª<a href="https://github.com/JosephZhu1983/SpringSecurity101" target="_blank" rel="noopener noreferrer">é“¾æ¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æŸ¥çœ‹ã€‚</p><p>æœ€åï¼Œæˆ‘å†æä¸€ä¸‹ï¼Œå°†æ¥ Spring å¯¹äº OAuth 2.0 çš„æ”¯æŒå¯èƒ½ä¼šè½¬ç§»åˆ°ç”±ç¤¾åŒºæ¨è¿›çš„ <a href="https://spring.io/blog/2020/04/15/announcing-the-spring-authorization-server" target="_blank" rel="noopener noreferrer">Spring Authorization Server<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é¡¹ç›®ä¸Šæ¥ç»§ç»­è¿ä½œã€‚å¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥åŠæ—¶å…³æ³¨è¿™ä¸ªé¡¹ç›®çš„è¿›å±•ã€‚</p></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/ChenSino/ChenSino.github.io/edit/dev/docs/other/oauth2/11.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: chenxk@sonoscape.net">ChenSino</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/other/oauth2/10.html" aria-label="10 | ä¸²è®²ï¼šOAuth 2.0çš„å·¥ä½œæµç¨‹ä¸å®‰å…¨é—®é¢˜"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->10 | ä¸²è®²ï¼šOAuth 2.0çš„å·¥ä½œæµç¨‹ä¸å®‰å…¨é—®é¢˜</div></a><a class="route-link nav-link next" href="/other/oauth2/12.html" aria-label="12 | æ¶æ„æ¡ˆä¾‹ï¼šåŸºäºOAuth 2.0/JWTçš„å¾®æœåŠ¡å‚è€ƒæ¶æ„"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">12 | æ¶æ„æ¡ˆä¾‹ï¼šåŸºäºOAuth 2.0/JWTçš„å¾®æœåŠ¡å‚è€ƒæ¶æ„<!----></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">é™¤äº†è‡ªæ¸¡ï¼Œå…¶ä»–äººçˆ±è«èƒ½åŠ©</div><div class="vp-copyright">Copyright Â© 2024 ChenSino </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-Cs38sdJl.js" defer></script>
  </body>
</html>
