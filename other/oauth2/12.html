<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.31" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://ChenSino.github.io/other/oauth2/12.html"><meta property="og:site_name" content="ChenSino"><meta property="og:title" content="12 | 架构案例：基于OAuth 2.0/JWT的微服务参考架构"><meta property="og:description" content="在前面几讲，我们一起学习了 OAuth 2.0 在开放环境中的使用过程。那么 OAuth 2.0 不仅仅可以用在开放的场景中，它可以应用到我们任何需要授权 / 鉴权的地方，包括微服务。 因此今天，我特别邀请了我的朋友杨波，来和你分享一个基于 OAuth 2.0/JWT 的微服务参考架构。杨波，曾先后担任过携程框架部的研发总监和拍拍贷基础架构部的研发总监..."><meta property="og:type" content="article"><meta property="og:image" content="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/228199yya6051f1f62f23547a88be4ff.jpg"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2022-11-08T08:17:56.000Z"><meta property="article:author" content="ChenSino"><meta property="article:published_time" content="2022-11-08T00:00:00.000Z"><meta property="article:modified_time" content="2022-11-08T08:17:56.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"12 | 架构案例：基于OAuth 2.0/JWT的微服务参考架构","image":["https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/228199yya6051f1f62f23547a88be4ff.jpg","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/b658befe1da937fa3685b55522487dbd.jpg","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/c88e46dd26deb76d6yy8f42f83066f4a.jpg","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/443dab973274d8d13c76b2ef4cd1d393.jpg","https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/02affbdf32f005af65454f3acc4cd957.jpg"],"datePublished":"2022-11-08T00:00:00.000Z","dateModified":"2022-11-08T08:17:56.000Z","author":[{"@type":"Person","name":"ChenSino"}]}</script><title>12 | 架构案例：基于OAuth 2.0/JWT的微服务参考架构 | ChenSino</title><meta name="description" content="在前面几讲，我们一起学习了 OAuth 2.0 在开放环境中的使用过程。那么 OAuth 2.0 不仅仅可以用在开放的场景中，它可以应用到我们任何需要授权 / 鉴权的地方，包括微服务。 因此今天，我特别邀请了我的朋友杨波，来和你分享一个基于 OAuth 2.0/JWT 的微服务参考架构。杨波，曾先后担任过携程框架部的研发总监和拍拍贷基础架构部的研发总监...">
    <link rel="preload" href="/assets/style-CIxWDlQE.css" as="style"><link rel="stylesheet" href="/assets/style-CIxWDlQE.css">
    <link rel="modulepreload" href="/assets/app-TdR3A7lU.js"><link rel="modulepreload" href="/assets/12.html-DoEPlZ7y.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-KEjHN1my.js" as="script"><link rel="prefetch" href="/assets/home.html-BbaQFtqc.js" as="script"><link rel="prefetch" href="/assets/slide.html-BW_mvDRC.js" as="script"><link rel="prefetch" href="/assets/index.html-iHH2xC1j.js" as="script"><link rel="prefetch" href="/assets/建造者模式.html-DjGb6ndl.js" as="script"><link rel="prefetch" href="/assets/模板方法模式.html-CICxpm88.js" as="script"><link rel="prefetch" href="/assets/策略模式.html-CBGiirM-.js" as="script"><link rel="prefetch" href="/assets/装饰模式.html-1v0mQ9lt.js" as="script"><link rel="prefetch" href="/assets/责任链模式.html-DnPaA-ef.js" as="script"><link rel="prefetch" href="/assets/index.html-D6w83X9S.js" as="script"><link rel="prefetch" href="/assets/index.html-B9ghP798.js" as="script"><link rel="prefetch" href="/assets/disable.html-DCiY21nP.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-Dc9drL-X.js" as="script"><link rel="prefetch" href="/assets/markdown.html-B55eqpFd.js" as="script"><link rel="prefetch" href="/assets/page.html-BHLr47vO.js" as="script"><link rel="prefetch" href="/assets/index.html-DgPvkRuh.js" as="script"><link rel="prefetch" href="/assets/index.html-Bwfjznym.js" as="script"><link rel="prefetch" href="/assets/index.html-B06qAq-r.js" as="script"><link rel="prefetch" href="/assets/1.html-bTO3kGDq.js" as="script"><link rel="prefetch" href="/assets/2.html-CQeR27Fo.js" as="script"><link rel="prefetch" href="/assets/index.html-DIwnt97A.js" as="script"><link rel="prefetch" href="/assets/index.html-CnbZbcEK.js" as="script"><link rel="prefetch" href="/assets/aboutAsync.html-DtTR38YL.js" as="script"><link rel="prefetch" href="/assets/aboutEvent.html-DWvFBZXO.js" as="script"><link rel="prefetch" href="/assets/aboutThis.html-D0Uvtqkw.js" as="script"><link rel="prefetch" href="/assets/asyncError.html-B5LPjtZU.js" as="script"><link rel="prefetch" href="/assets/crossDomain.html-w0mLoF9M.js" as="script"><link rel="prefetch" href="/assets/crossDomain2.html-Bz8mpyi8.js" as="script"><link rel="prefetch" href="/assets/lazyLoad.html-C31QgdP9.js" as="script"><link rel="prefetch" href="/assets/throttle.html-BOJPpGLs.js" as="script"><link rel="prefetch" href="/assets/index.html-DAfSPXcI.js" as="script"><link rel="prefetch" href="/assets/js中整数的最大值.html-BBm-hvWw.js" as="script"><link rel="prefetch" href="/assets/promise.html-Dr77UknR.js" as="script"><link rel="prefetch" href="/assets/useModule.html-ClpyqzHD.js" as="script"><link rel="prefetch" href="/assets/useNpm.html-De-0nmx6.js" as="script"><link rel="prefetch" href="/assets/usePnpm.html-BDp13tQj.js" as="script"><link rel="prefetch" href="/assets/useYarn.html-XC4N3wVK.js" as="script"><link rel="prefetch" href="/assets/index.html-PYzTzBLJ.js" as="script"><link rel="prefetch" href="/assets/action-usage.html-CR5nVE82.js" as="script"><link rel="prefetch" href="/assets/axios.html-NB-pcIpd.js" as="script"><link rel="prefetch" href="/assets/basic-usage.html-eMi-ReRc.js" as="script"><link rel="prefetch" href="/assets/fanType.html-3Y_SyjUk.js" as="script"><link rel="prefetch" href="/assets/tsAndvue3.html-DiOqkgWK.js" as="script"><link rel="prefetch" href="/assets/index.html-DpKkQwHD.js" as="script"><link rel="prefetch" href="/assets/index.html-H6H-3FTh.js" as="script"><link rel="prefetch" href="/assets/eventBus.html-D6_GNV7K.js" as="script"><link rel="prefetch" href="/assets/vue-Direactive.html-BJf2UFZd.js" as="script"><link rel="prefetch" href="/assets/vue-authority.html-yZIOK-yl.js" as="script"><link rel="prefetch" href="/assets/vue-in-action.html-DSUIFfQg.js" as="script"><link rel="prefetch" href="/assets/vue-nextTick.html-BGgMJ9RM.js" as="script"><link rel="prefetch" href="/assets/vue-pic.html-BTY366qb.js" as="script"><link rel="prefetch" href="/assets/vue-router1.html-B5le39l-.js" as="script"><link rel="prefetch" href="/assets/vue-router2.html-D_CY8OpE.js" as="script"><link rel="prefetch" href="/assets/vue3Emit.html-C1NTzJUK.js" as="script"><link rel="prefetch" href="/assets/vue3LifeTime.html-BGUuo1qt.js" as="script"><link rel="prefetch" href="/assets/vueExtend.html-D9SLlvTE.js" as="script"><link rel="prefetch" href="/assets/Arthas.html-CYb13g0m.js" as="script"><link rel="prefetch" href="/assets/Collection.html-DvHkJ4BU.js" as="script"><link rel="prefetch" href="/assets/CompileJdk11.html-Yx8G1fD5.js" as="script"><link rel="prefetch" href="/assets/Concurrent.html-CS2XTEeO.js" as="script"><link rel="prefetch" href="/assets/Future.html-Bx6cBb98.js" as="script"><link rel="prefetch" href="/assets/IO-Model.html-CsL0Ns4V.js" as="script"><link rel="prefetch" href="/assets/IO-model1.html-MDPB0T7H.js" as="script"><link rel="prefetch" href="/assets/ImplementSameInterface.html-DPKV0fr2.js" as="script"><link rel="prefetch" href="/assets/MysqlMasterSlave.html-tTgR7hL1.js" as="script"><link rel="prefetch" href="/assets/NativeMethod.html-NuN3DWrs.js" as="script"><link rel="prefetch" href="/assets/ParentDelegationClassLoader.html-DTgrj7W6.js" as="script"><link rel="prefetch" href="/assets/ProxyInJava.html-BGn3otn0.js" as="script"><link rel="prefetch" href="/assets/index.html-DcpBMb0H.js" as="script"><link rel="prefetch" href="/assets/Synchronized.html-VMv5gpnb.js" as="script"><link rel="prefetch" href="/assets/ThreadLocal.html-LyVc-u1B.js" as="script"><link rel="prefetch" href="/assets/ThreadPool.html-CqdjxNfq.js" as="script"><link rel="prefetch" href="/assets/io.html-BNINQ2qr.js" as="script"><link rel="prefetch" href="/assets/ConstantPool.html-N2fefdX_.js" as="script"><link rel="prefetch" href="/assets/CustomLRU.html-CRSY3Gbt.js" as="script"><link rel="prefetch" href="/assets/IntegerConstantPool.html-DXOM2Kn6.js" as="script"><link rel="prefetch" href="/assets/index.html-SMjkAF-n.js" as="script"><link rel="prefetch" href="/assets/Serialization.html-IBD7Gh0i.js" as="script"><link rel="prefetch" href="/assets/String.html-5OiFB0Uw.js" as="script"><link rel="prefetch" href="/assets/ClassLoader.html-BFR6F48k.js" as="script"><link rel="prefetch" href="/assets/MemoryModel.html-DyqSwa_h.js" as="script"><link rel="prefetch" href="/assets/NewObject.html-DGCuEN8G.js" as="script"><link rel="prefetch" href="/assets/ObjectReference.html-B43-mvNg.js" as="script"><link rel="prefetch" href="/assets/index.html-DEHO_zyp.js" as="script"><link rel="prefetch" href="/assets/SetObjectNull.html-DdHagIYd.js" as="script"><link rel="prefetch" href="/assets/StringAdd.html-CyWmebrs.js" as="script"><link rel="prefetch" href="/assets/volatile.html-BBWTQE48.js" as="script"><link rel="prefetch" href="/assets/JdkVersion.html-CmRADpUm.js" as="script"><link rel="prefetch" href="/assets/index.html-DEgECuPx.js" as="script"><link rel="prefetch" href="/assets/index.html-DQ-s5GjS.js" as="script"><link rel="prefetch" href="/assets/ebooks.html-C6uQcps9.js" as="script"><link rel="prefetch" href="/assets/TCP-IP.html-DeN7AnbE.js" as="script"><link rel="prefetch" href="/assets/CPUOverLoad.html-CJNhzJjP.js" as="script"><link rel="prefetch" href="/assets/MysqlCollate.html-DrAD-X61.js" as="script"><link rel="prefetch" href="/assets/MysqlNote.html-DNkCWtYE.js" as="script"><link rel="prefetch" href="/assets/MysqlRemoteConnect.html-DKJjr9ZM.js" as="script"><link rel="prefetch" href="/assets/index.html-D2uFCtSt.js" as="script"><link rel="prefetch" href="/assets/Recurse.html-Cjh3tY95.js" as="script"><link rel="prefetch" href="/assets/SQLOptimization.html-Bd63tsm3.js" as="script"><link rel="prefetch" href="/assets/DistributeLock.html-jtE1hnEL.js" as="script"><link rel="prefetch" href="/assets/Nacos.html-DdhqND7N.js" as="script"><link rel="prefetch" href="/assets/index.html-DwJmRlqZ.js" as="script"><link rel="prefetch" href="/assets/Docker.html-Bm_rY3ow.js" as="script"><link rel="prefetch" href="/assets/ServiceInstall.html-DSspyH-o.js" as="script"><link rel="prefetch" href="/assets/2022-04-12.html-C2ivmyXD.js" as="script"><link rel="prefetch" href="/assets/BTree.html-BPXANGcy.js" as="script"><link rel="prefetch" href="/assets/CDN.html-BOQ4Hfdl.js" as="script"><link rel="prefetch" href="/assets/ChromeDevTools.html-Jpn6jYT1.js" as="script"><link rel="prefetch" href="/assets/CloudService.html-BO5Yn0L8.js" as="script"><link rel="prefetch" href="/assets/DeployGithubPage.html-B7qC5D-_.js" as="script"><link rel="prefetch" href="/assets/GreatWallProxy.html-AM20qwW3.js" as="script"><link rel="prefetch" href="/assets/Jenkins.html-AvOBNdU7.js" as="script"><link rel="prefetch" href="/assets/index.html-kYFFARwi.js" as="script"><link rel="prefetch" href="/assets/Service.html-Ce5iHlCS.js" as="script"><link rel="prefetch" href="/assets/TyporaPicgo.html-CCIsPiET.js" as="script"><link rel="prefetch" href="/assets/BatchDeleteGitHubRepo.html-DGrzCYdu.js" as="script"><link rel="prefetch" href="/assets/GitCommands.html-DKj6mmQr.js" as="script"><link rel="prefetch" href="/assets/index.html-Ix65jRO_.js" as="script"><link rel="prefetch" href="/assets/branch01.html-BoI-sKY-.js" as="script"><link rel="prefetch" href="/assets/branch02.html-BmfGVQ3m.js" as="script"><link rel="prefetch" href="/assets/fatal.html-D8INEGqR.js" as="script"><link rel="prefetch" href="/assets/gitConflict.html-CSBq8RXH.js" as="script"><link rel="prefetch" href="/assets/gitRebase.html-DDyGRN17.js" as="script"><link rel="prefetch" href="/assets/gitwork.html-DZTIeq48.js" as="script"><link rel="prefetch" href="/assets/mergeBranch.html-gTpVrbOU.js" as="script"><link rel="prefetch" href="/assets/proxy.html-gh7Rr4Yk.js" as="script"><link rel="prefetch" href="/assets/rebaseAndMerge.html-CA1JtywE.js" as="script"><link rel="prefetch" href="/assets/reset.html-Dy3UyZn3.js" as="script"><link rel="prefetch" href="/assets/stash.html-BI7eYe_W.js" as="script"><link rel="prefetch" href="/assets/CPU.html-BuM2Ea1M.js" as="script"><link rel="prefetch" href="/assets/CentOS.html-CgwMGo4u.js" as="script"><link rel="prefetch" href="/assets/CommonUsedCMD.html-BF8z4vQ-.js" as="script"><link rel="prefetch" href="/assets/Curl.html-5K_NiYYD.js" as="script"><link rel="prefetch" href="/assets/InstallMysqlWithDocker.html-qesZ4pDH.js" as="script"><link rel="prefetch" href="/assets/Manjaro.html-DdgSJ4T9.js" as="script"><link rel="prefetch" href="/assets/MountDisk.html-BgwVU986.js" as="script"><link rel="prefetch" href="/assets/MultiNetworkCard.html-DA764yze.js" as="script"><link rel="prefetch" href="/assets/index.html-DgshB7gx.js" as="script"><link rel="prefetch" href="/assets/Samba.html-BrBfrzcU.js" as="script"><link rel="prefetch" href="/assets/ShareBetweenWindowsAndLinux.html-GsIj5BTY.js" as="script"><link rel="prefetch" href="/assets/TcpDump.html-1w8jC05E.js" as="script"><link rel="prefetch" href="/assets/Wifi.html-QHp1EtHd.js" as="script"><link rel="prefetch" href="/assets/firewall.html-DWfEnaXJ.js" as="script"><link rel="prefetch" href="/assets/wsl.html-DHxX5YN-.js" as="script"><link rel="prefetch" href="/assets/index.html-DRthzCdr.js" as="script"><link rel="prefetch" href="/assets/01.html-t1NIPbxP.js" as="script"><link rel="prefetch" href="/assets/02.html-B1kcQCH1.js" as="script"><link rel="prefetch" href="/assets/03.html-BTKxoFzK.js" as="script"><link rel="prefetch" href="/assets/04.html-D29P4H39.js" as="script"><link rel="prefetch" href="/assets/05.html-Do3-5AAz.js" as="script"><link rel="prefetch" href="/assets/06.html-BMOLWijo.js" as="script"><link rel="prefetch" href="/assets/07.html-BhXu-765.js" as="script"><link rel="prefetch" href="/assets/08.html-ZbaHFjRg.js" as="script"><link rel="prefetch" href="/assets/09.html-CuqnaXwN.js" as="script"><link rel="prefetch" href="/assets/10.html-DGv-6Jv3.js" as="script"><link rel="prefetch" href="/assets/11.html-3spq4JZc.js" as="script"><link rel="prefetch" href="/assets/13.html-CGtspcqx.js" as="script"><link rel="prefetch" href="/assets/14.html-DoWwxi73.js" as="script"><link rel="prefetch" href="/assets/index.html-D-tUysfB.js" as="script"><link rel="prefetch" href="/assets/index.html-BJ-Xf5sC.js" as="script"><link rel="prefetch" href="/assets/破解软件.html-CORFmBTN.js" as="script"><link rel="prefetch" href="/assets/SUC.html-Dpy1qNyk.js" as="script"><link rel="prefetch" href="/assets/Idea.html-BavXF54H.js" as="script"><link rel="prefetch" href="/assets/index.html-Bdagumlx.js" as="script"><link rel="prefetch" href="/assets/SoftWare.html-Zz35UBnX.js" as="script"><link rel="prefetch" href="/assets/VsCode.html-C37dHgWp.js" as="script"><link rel="prefetch" href="/assets/CloudServiceTraining.html-DMB0p3pm.js" as="script"><link rel="prefetch" href="/assets/index.html-5auQOLs9.js" as="script"><link rel="prefetch" href="/assets/SSO.html-_ueMNM1b.js" as="script"><link rel="prefetch" href="/assets/UserService.html-L7o3SPLx.js" as="script"><link rel="prefetch" href="/assets/draw.html-Cb8qlst8.js" as="script"><link rel="prefetch" href="/assets/用服bom系统.html-DImEPbNs.js" as="script"><link rel="prefetch" href="/assets/BuildWebProject.html-CF1sNn-Z.js" as="script"><link rel="prefetch" href="/assets/Cookie.html-C1-Yhcos.js" as="script"><link rel="prefetch" href="/assets/Http.html-zqyGOOMx.js" as="script"><link rel="prefetch" href="/assets/Jwt.html-tF6c8KIX.js" as="script"><link rel="prefetch" href="/assets/OAUTH_LOGIN.html-DwSlhMUt.js" as="script"><link rel="prefetch" href="/assets/index.html-CZYzg4cf.js" as="script"><link rel="prefetch" href="/assets/RefreshToken.html-YRDkD0lv.js" as="script"><link rel="prefetch" href="/assets/Restful.html-Csp9zU2F.js" as="script"><link rel="prefetch" href="/assets/MybatisPlusDataSource.html-jli3eYzc.js" as="script"><link rel="prefetch" href="/assets/index.html-BiAEAxm0.js" as="script"><link rel="prefetch" href="/assets/mybatis.html-CuX1ZzXp.js" as="script"><link rel="prefetch" href="/assets/Authorization.html-yCHezoHZ.js" as="script"><link rel="prefetch" href="/assets/CustomAuthenticationProvider.html-NaaOuc0p.js" as="script"><link rel="prefetch" href="/assets/CustomLoginPage.html-DDzHh7Vk.js" as="script"><link rel="prefetch" href="/assets/CustomTokenAuthentication.html-CwTTi5cE.js" as="script"><link rel="prefetch" href="/assets/OAuth2Authentication.html-B0XS-rcW.js" as="script"><link rel="prefetch" href="/assets/OncePerRequestFilter.html-BvBvWzWR.js" as="script"><link rel="prefetch" href="/assets/PreAuthorize.html-BXG6-Ja7.js" as="script"><link rel="prefetch" href="/assets/index.html-Cv-7LyYd.js" as="script"><link rel="prefetch" href="/assets/SSO.html-C78sJ6fR.js" as="script"><link rel="prefetch" href="/assets/SecurityFilterChain.html-tPQimTpi.js" as="script"><link rel="prefetch" href="/assets/Session.html-DYQEFZRN.js" as="script"><link rel="prefetch" href="/assets/note.html-B3EO7dPv.js" as="script"><link rel="prefetch" href="/assets/spring-security-oauth2-authorization-server.html-CIuHz5Nt.js" as="script"><link rel="prefetch" href="/assets/Annotation.html-SFJ8PW8i.js" as="script"><link rel="prefetch" href="/assets/BeanPostProcessor.html-UoVjt_kW.js" as="script"><link rel="prefetch" href="/assets/CircularDependency.html-Bapzwzou.js" as="script"><link rel="prefetch" href="/assets/DesignPatternInSpring.html-sxdzU-LZ.js" as="script"><link rel="prefetch" href="/assets/OncePerRequestFilter.html-CbP5rrP5.js" as="script"><link rel="prefetch" href="/assets/index.html-DMpCcFb8.js" as="script"><link rel="prefetch" href="/assets/SpringAOP.html-N-MI724h.js" as="script"><link rel="prefetch" href="/assets/SpringCache.html-BOomO_VR.js" as="script"><link rel="prefetch" href="/assets/SpringExtensionPoint.html-DKCf2BZA.js" as="script"><link rel="prefetch" href="/assets/SpringIOC.html-DB3dVSq4.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-CObFszFK.js" as="script"><link rel="prefetch" href="/assets/SpringSourceAnalize.html-BWelW0K2.js" as="script"><link rel="prefetch" href="/assets/Validator.html-ByLiOHMU.js" as="script"><link rel="prefetch" href="/assets/AOPLog.html-DXiqRjn6.js" as="script"><link rel="prefetch" href="/assets/CollectionInject.html-DP5K9hK5.js" as="script"><link rel="prefetch" href="/assets/Http2.html-DJ22_5eB.js" as="script"><link rel="prefetch" href="/assets/index.html-BCMtYJ5W.js" as="script"><link rel="prefetch" href="/assets/SpringBootAutoConfiguration.html-9WhKaxiB.js" as="script"><link rel="prefetch" href="/assets/Swagger.html-WA2xZyC4.js" as="script"><link rel="prefetch" href="/assets/部署.html-DLqiJ91Q.js" as="script"><link rel="prefetch" href="/assets/SpringCloudGateway.html-BJWncoIg.js" as="script"><link rel="prefetch" href="/assets/index.html-BIooIGD-.js" as="script"><link rel="prefetch" href="/assets/wrapper.html-C4EsV7uP.js" as="script"><link rel="prefetch" href="/assets/index.html-B3qKYPiu.js" as="script"><link rel="prefetch" href="/assets/TooManyOpenFiles.html-C6FITmWm.js" as="script"><link rel="prefetch" href="/assets/Undertow.xxxNotFount.html-DdvqP6Pa.js" as="script"><link rel="prefetch" href="/assets/各种框架版本的坑.html-YtM60lqX.js" as="script"><link rel="prefetch" href="/assets/各种问题.html-CLGgQWXl.js" as="script"><link rel="prefetch" href="/assets/logback.html-Bzp4i3i1.js" as="script"><link rel="prefetch" href="/assets/index.html-v2544eV3.js" as="script"><link rel="prefetch" href="/assets/build标签.html-DcX-O29C.js" as="script"><link rel="prefetch" href="/assets/import.html-CNvO9gtv.js" as="script"><link rel="prefetch" href="/assets/multiModule.html-cJ5eF51y.js" as="script"><link rel="prefetch" href="/assets/problem.html-6ceFjW9T.js" as="script"><link rel="prefetch" href="/assets/生命周期.html-COlcFWlL.js" as="script"><link rel="prefetch" href="/assets/404.html-C0_4x30A.js" as="script"><link rel="prefetch" href="/assets/index.html-ChSJSAxH.js" as="script"><link rel="prefetch" href="/assets/index.html-DSWmpmgq.js" as="script"><link rel="prefetch" href="/assets/index.html-CPOp9ZUu.js" as="script"><link rel="prefetch" href="/assets/index.html-DmMPII-I.js" as="script"><link rel="prefetch" href="/assets/index.html-B64nQA93.js" as="script"><link rel="prefetch" href="/assets/index.html-DrIm5NRg.js" as="script"><link rel="prefetch" href="/assets/index.html-BeVcr32O.js" as="script"><link rel="prefetch" href="/assets/index.html-DgPipzVD.js" as="script"><link rel="prefetch" href="/assets/index.html-DFp3f7B3.js" as="script"><link rel="prefetch" href="/assets/index.html-Cfx8RccB.js" as="script"><link rel="prefetch" href="/assets/index.html-1Wi-XDX-.js" as="script"><link rel="prefetch" href="/assets/index.html-DA33CscQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DlWQDhk5.js" as="script"><link rel="prefetch" href="/assets/index.html-CHB9zM7z.js" as="script"><link rel="prefetch" href="/assets/index.html-s9kFkyJf.js" as="script"><link rel="prefetch" href="/assets/index.html-CJ0aRp3x.js" as="script"><link rel="prefetch" href="/assets/index.html-Bv4Vxdix.js" as="script"><link rel="prefetch" href="/assets/index.html-D2hU61FZ.js" as="script"><link rel="prefetch" href="/assets/index.html-1F2jpS3Y.js" as="script"><link rel="prefetch" href="/assets/index.html-DM_DlETW.js" as="script"><link rel="prefetch" href="/assets/index.html-BTeeCT0j.js" as="script"><link rel="prefetch" href="/assets/index.html-DDI57Ws7.js" as="script"><link rel="prefetch" href="/assets/index.html-D4lv3ExM.js" as="script"><link rel="prefetch" href="/assets/index.html-ByBS6Ai-.js" as="script"><link rel="prefetch" href="/assets/index.html-BJRnxWzV.js" as="script"><link rel="prefetch" href="/assets/index.html-D1GaQdmt.js" as="script"><link rel="prefetch" href="/assets/index.html-DgAlzIWD.js" as="script"><link rel="prefetch" href="/assets/index.html-Dz_PtTWF.js" as="script"><link rel="prefetch" href="/assets/index.html-C8K__OKg.js" as="script"><link rel="prefetch" href="/assets/index.html-5BK2FZoQ.js" as="script"><link rel="prefetch" href="/assets/index.html-Buuy5zsO.js" as="script"><link rel="prefetch" href="/assets/index.html-Du-PA1k_.js" as="script"><link rel="prefetch" href="/assets/index.html-DpM-8OZp.js" as="script"><link rel="prefetch" href="/assets/index.html-Corpb_es.js" as="script"><link rel="prefetch" href="/assets/index.html-Cwn7jOq8.js" as="script"><link rel="prefetch" href="/assets/index.html-CtnDznRB.js" as="script"><link rel="prefetch" href="/assets/index.html-DgsKS6sm.js" as="script"><link rel="prefetch" href="/assets/index.html-Mxa9mGOx.js" as="script"><link rel="prefetch" href="/assets/index.html-ClAj-R2T.js" as="script"><link rel="prefetch" href="/assets/index.html-CfnHLGdu.js" as="script"><link rel="prefetch" href="/assets/index.html-Ceob4SdL.js" as="script"><link rel="prefetch" href="/assets/index.html-Ceob4SdL.js" as="script"><link rel="prefetch" href="/assets/index.html-ClAj-R2T.js" as="script"><link rel="prefetch" href="/assets/index.html-D1oIhASU.js" as="script"><link rel="prefetch" href="/assets/index.html-D7uofO17.js" as="script"><link rel="prefetch" href="/assets/index.html-B5UU1S86.js" as="script"><link rel="prefetch" href="/assets/index.html-BPW-SDl8.js" as="script"><link rel="prefetch" href="/assets/index.html-Jsn2GUWM.js" as="script"><link rel="prefetch" href="/assets/index.html-C13pjYLN.js" as="script"><link rel="prefetch" href="/assets/index.html-CgJgAy7b.js" as="script"><link rel="prefetch" href="/assets/index.html-oBkyzLJN.js" as="script"><link rel="prefetch" href="/assets/index.html-BPjwPx1f.js" as="script"><link rel="prefetch" href="/assets/index.html-DI-YphJV.js" as="script"><link rel="prefetch" href="/assets/index.html-OFVbffaF.js" as="script"><link rel="prefetch" href="/assets/index.html-Ddp1O1g7.js" as="script"><link rel="prefetch" href="/assets/index.html-D_fj5neO.js" as="script"><link rel="prefetch" href="/assets/index.html-Co0Nekb5.js" as="script"><link rel="prefetch" href="/assets/index.html-y0DEB8z3.js" as="script"><link rel="prefetch" href="/assets/index.html-DrT50bES.js" as="script"><link rel="prefetch" href="/assets/index.html-mSPkox7Q.js" as="script"><link rel="prefetch" href="/assets/index.html-BJjRkSuw.js" as="script"><link rel="prefetch" href="/assets/index.html-CkCCW9pV.js" as="script"><link rel="prefetch" href="/assets/index.html-alvziIjM.js" as="script"><link rel="prefetch" href="/assets/index.html-DaWmMNTR.js" as="script"><link rel="prefetch" href="/assets/index.html-_v1i2RH2.js" as="script"><link rel="prefetch" href="/assets/index.html-BaEbkUbJ.js" as="script"><link rel="prefetch" href="/assets/index.html-CYBnnINK.js" as="script"><link rel="prefetch" href="/assets/index.html-BoRxq6SF.js" as="script"><link rel="prefetch" href="/assets/index.html-BrMQjHkO.js" as="script"><link rel="prefetch" href="/assets/index.html-Dm82u9I3.js" as="script"><link rel="prefetch" href="/assets/index.html-kRzHUIxE.js" as="script"><link rel="prefetch" href="/assets/index.html-DALYd7fQ.js" as="script"><link rel="prefetch" href="/assets/index.html-sGbQtaMn.js" as="script"><link rel="prefetch" href="/assets/index.html-GY9KnYpt.js" as="script"><link rel="prefetch" href="/assets/index.html-CgJgAy7b.js" as="script"><link rel="prefetch" href="/assets/index.html-2ZEjpJST.js" as="script"><link rel="prefetch" href="/assets/index.html-qG-1ZnMa.js" as="script"><link rel="prefetch" href="/assets/index.html-CnrnID5A.js" as="script"><link rel="prefetch" href="/assets/index.html-DZ6k5OJD.js" as="script"><link rel="prefetch" href="/assets/index.html-CObF57bj.js" as="script"><link rel="prefetch" href="/assets/index.html-AoP4aVPt.js" as="script"><link rel="prefetch" href="/assets/index.html-BuEuq53b.js" as="script"><link rel="prefetch" href="/assets/giscus-7BMGhbDA.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">ChenSino</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/home.html" aria-label="Home"><span class="font-icon icon iconfont icon-home" style=""></span>Home<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="ChenSino"><span class="font-icon icon iconfont icon-home" style=""></span>ChenSino<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Java"><span class="title"><span class="font-icon icon iconfont icon-java" style=""></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/java/base/Serialization.html" aria-label="Java基础"><span class="font-icon icon iconfont icon-java" style=""></span>Java基础<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/java/advance/ProxyInJava.html" aria-label="Java进阶"><span class="font-icon icon iconfont icon-java" style=""></span>Java进阶<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/java/jvm/NewObject.html" aria-label="Java虚拟机"><span class="font-icon icon iconfont icon-java" style=""></span>Java虚拟机<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Java框架</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/framework/spring/" aria-label="Spring"><!---->Spring<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/framework/security/" aria-label="Security"><!---->Security<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/framework/springboot/" aria-label="SpringBoot"><!---->SpringBoot<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/framework/mybatis/" aria-label="Mybatis"><!---->Mybatis<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>其他</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/other/maven/" aria-label="Maven"><!---->Maven<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/other/gradle/" aria-label="Gradle"><span class="font-icon icon iconfont icon-java" style=""></span>Gradle<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/other/locateproblem/" aria-label="Java问题定位"><span class="font-icon icon iconfont icon-java" style=""></span>Java问题定位<!----></a></li><li class="dropdown-subitem"><a class="route-link nav-link" href="/java/other/JdkVersion.html" aria-label="Java版本"><span class="font-icon icon iconfont icon-java" style=""></span>Java版本<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="前端"><span class="title"><span class="font-icon icon iconfont icon-javascript" style=""></span>前端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/frontweb/vue/" aria-label="Vue"><span class="font-icon icon iconfont icon-vue" style=""></span>Vue<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/frontweb/vite/" aria-label="Vite"><span class="font-icon icon iconfont icon-vue" style=""></span>Vite<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/frontweb/es5/" aria-label="ES5"><span class="font-icon icon iconfont icon-javascript" style=""></span>ES5<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/frontweb/es6/" aria-label="ES6"><span class="font-icon icon iconfont icon-javascript" style=""></span>ES6<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/frontweb/typeScript/" aria-label="TypeScript"><span class="font-icon icon iconfont icon-javascript" style=""></span>TypeScript<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/designpattern.html" aria-label="设计模式"><span class="font-icon icon iconfont icon-java" style=""></span>设计模式<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/other/web/" aria-label="前后分离项目搭建"><span class="font-icon icon iconfont icon-app" style=""></span>前后分离项目搭建<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/cpp/study/" aria-label="C++学习"><span class="font-icon icon iconfont icon-app" style=""></span>C++学习<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/cpp/study/" aria-label="家庭服务器"><!---->家庭服务器<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="其他"><span class="title"><span class="font-icon icon iconfont icon-others" style=""></span>其他</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/other/web/" aria-label="Web"><span class="font-icon icon iconfont icon-vue" style=""></span>Web<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/git/GitCommands.html" aria-label="Git"><span class="font-icon icon iconfont icon-git" style=""></span>Git<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/linux/CommonUsedCMD.html" aria-label="Linux"><span class="font-icon icon iconfont icon-linux" style=""></span>Linux<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/docker/Docker.html" aria-label="Docker"><span class="font-icon icon iconfont icon-ubuntu" style=""></span>Docker<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/database/CPUOverLoad.html" aria-label="DataBase"><span class="font-icon icon iconfont icon-java" style=""></span>DataBase<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/markdown/" aria-label="MarkDown"><span class="font-icon icon iconfont icon-markdown" style=""></span>MarkDown<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/tools/idea.html" aria-label="工具软件"><span class="font-icon icon iconfont icon-software" style=""></span>工具软件<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/training/CloudServiceTraining.html" aria-label="小组分享"><span class="font-icon icon iconfont icon-share" style=""></span>小组分享<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/essay/2022-04-12.html" aria-label="随笔杂记"><span class="font-icon icon iconfont icon-activity" style=""></span>随笔杂记<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/books/ebooks.html" aria-label="电子书资源"><span class="font-icon icon iconfont icon-app" style=""></span>电子书资源<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/other/distributeservice/DistributeLock.html" aria-label="分布式微服务"><span class="font-icon icon iconfont icon-class" style=""></span>分布式微服务<!----></a></li><li class="dropdown-item"><a class="route-link nav-link active" href="/other/oauth2/" aria-label="OAuth2.0"><span class="font-icon icon iconfont icon-class" style=""></span>OAuth2.0<!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/ChenSino/ChenSino.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-git" style=""></span><span class="vp-sidebar-title">Git</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-linux" style=""></span><span class="vp-sidebar-title">Linux</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-repo" style=""></span><span class="vp-sidebar-title">数据库</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-markdown" style=""></span><span class="vp-sidebar-title">MarkDown</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-software" style=""></span><span class="vp-sidebar-title">工具软件</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-share" style=""></span><span class="vp-sidebar-title">小组分享</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-share" style=""></span><span class="vp-sidebar-title">随笔分享</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-share" style=""></span><span class="vp-sidebar-title">web</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-share" style=""></span><span class="vp-sidebar-title">分布式微服务</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon iconfont icon-share" style=""></span><span class="vp-sidebar-title">OAuth2.0</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/" aria-label="开篇词 | 为什么要学OAuth 2.0？"><!---->开篇词 | 为什么要学OAuth 2.0？<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/01.html" aria-label="01 | OAuth 2.0是要通过什么方式解决什么问题？"><!---->01 | OAuth 2.0是要通过什么方式解决什么问题？<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/02.html" aria-label="02 | 授权码许可类型中，为什么一定要有授权码？"><!---->02 | 授权码许可类型中，为什么一定要有授权码？<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/03.html" aria-label="03 | 授权服务：授权码和访问令牌的颁发流程是怎样"><!---->03 | 授权服务：授权码和访问令牌的颁发流程是怎样<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/04.html" aria-label="04 | 在OAuth 2.0中，如何使用JWT结构化令牌？"><!---->04 | 在OAuth 2.0中，如何使用JWT结构化令牌？<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/05.html" aria-label="05 | 如何安全、快速地接入OAuth 2.0？"><!---->05 | 如何安全、快速地接入OAuth 2.0？<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/06.html" aria-label="06 | 除了授权码许可类型，OAuth 2.0还支持什么授权流程？"><!---->06 | 除了授权码许可类型，OAuth 2.0还支持什么授权流程？<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/07.html" aria-label="07 | 如何在移动App中使用OAuth 2.0？"><!---->07 | 如何在移动App中使用OAuth 2.0？<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/08.html" aria-label="08 | 实践OAuth 2.0时，使用不当可能会导致哪些安全漏洞？"><!---->08 | 实践OAuth 2.0时，使用不当可能会导致哪些安全漏洞？<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/09.html" aria-label="09 | 实战：利用OAuth 2.0实现一个OpenID Connect用户身份认证协议"><!---->09 | 实战：利用OAuth 2.0实现一个OpenID Connect用户身份认证协议<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/10.html" aria-label="10 | 串讲：OAuth 2.0的工作流程与安全问题"><!---->10 | 串讲：OAuth 2.0的工作流程与安全问题<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/11.html" aria-label="11 | 实战案例：使用Spring Security搭建一套基于JWT的OAuth 2.0架构"><!---->11 | 实战案例：使用Spring Security搭建一套基于JWT的OAuth 2.0架构<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/other/oauth2/12.html" aria-label="12 | 架构案例：基于OAuth 2.0/JWT的微服务参考架构"><!---->12 | 架构案例：基于OAuth 2.0/JWT的微服务参考架构<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/13.html" aria-label="13 | 各大开放平台是如何使用OAuth 2.0的？"><!---->13 | 各大开放平台是如何使用OAuth 2.0的？<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/other/oauth2/14.html" aria-label="14 | 查漏补缺：OAuth 2.0 常见问题答疑"><!---->14 | 查漏补缺：OAuth 2.0 常见问题答疑<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-ubuntu" style=""></span><span class="vp-sidebar-title">Docker</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->12 | 架构案例：基于OAuth 2.0/JWT的微服务参考架构</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">ChenSino</span></span><span property="author" content="ChenSino"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-11-08T00:00:00.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 20 分钟</span><meta property="timeRequired" content="PT20M"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#微服务分层架构">微服务分层架构</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#nginx-反向代理层">Nginx 反向代理层</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#web-应用层">Web 应用层</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#gateway-网关层">Gateway 网关层</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#idp-服务">IDP 服务</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#bff-层">BFF 层</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#领域服务层">领域服务层</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#oauth-2-0-jwt-如何与微服务进行集成">OAuth 2.0/JWT 如何与微服务进行集成？</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#场景-1-第一方-web-应用-资源拥有者凭据模式">场景 1：第一方 Web 应用 + 资源拥有者凭据模式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#场景-2-第一方移动应用-授权码许可模式">场景 2：第一方移动应用 + 授权码许可模式</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#场景-3-第三方-web-应用-授权码模式">场景 3：第三方 Web 应用 + 授权码模式</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#小结">小结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="/#思考题">思考题</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><blockquote><p>在前面几讲，我们一起学习了 OAuth 2.0 在开放环境中的使用过程。那么 OAuth 2.0 不仅仅可以用在开放的场景中，它可以应用到我们任何需要授权 / 鉴权的地方，包括微服务。</p></blockquote><blockquote><p>因此今天，我特别邀请了我的朋友杨波，来和你分享一个基于 OAuth 2.0/JWT 的微服务参考架构。杨波，曾先后担任过携程框架部的研发总监和拍拍贷基础架构部的研发总监，在微服务和 OAuth 2.0 有非常丰富的实践经验。</p></blockquote><blockquote><p>其中，在携程工作期间，他负责过携程的 API 网关产品的研发工作，包括它和携程的令牌服务的集成；在拍拍贷工作期间，他负责过拍拍贷的令牌服务的研发和运维工作。这两家公司的令牌服务和 OAuth 2.0 类似，但要更简单些。</p></blockquote><blockquote><p>接下来，我们就开始学习杨波老师给我们带来的内容吧。</p></blockquote><p>你好，我是杨波。</p><p>从单体到微服务架构的演进，是当前企业数字化转型的一大趋势。<a href="https://oauth.net/2/" target="_blank" rel="noopener noreferrer">OAuth 2.0<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>是当前业界标准的授权协议，它的核心是若干个针对不同场景的令牌颁发和管理流程；而<a href="https://jwt.io/" target="_blank" rel="noopener noreferrer">JWT<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>是一种轻量级、自包含的令牌，可用于在微服务间安全地传递用户信息。</p><p>据我目前了解到的情况，虽然有不少企业已经部分或全部转型到微服务架构，但是在授权认证机制方面，它们一般都是定制自研的，比方说携程和拍拍贷的令牌服务。之所以定制自研，主要原因在于标准的 OAuth 2.0 协议相对比较复杂，门槛也比较高。定制自研固然可以暂时解决企业的问题，但是不具备通用性，也可能有很多潜在的安全风险。</p><p>那么，到底应该如何将行业标准的 OAuth 2.0/JWT 和微服务集成起来呢，又有没有可落地的参考架构呢？</p><p>针对这个问题，今天我就和你分享一种可落地的参考架构。不过，我要提前说明的是，这个架构的思想源于<a href="https://www.kaper.com/cloud/micro-services-architecture-with-oauth2-and-jwt-part-1-overview/" target="_blank" rel="noopener noreferrer">MICRO-SERVICES ARCHITECTURE WITH OAUTH2 AND JWT – PART 1 – OVERVIEW<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>这篇文章。</p><p>根据原作者 Thijs 的描述，他提出的架构已经在企业落地架构了。如果你还想获得关于原架构的更多细节，建议进一步参考“<a href="https://dzone.com/articles/what-is-pkce" target="_blank" rel="noopener noreferrer">What is PKCE<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>？”这篇文章。我认为，Thijs 给出的架构确实具有可落地性和参考价值，但是他的架构里面对某些微服务层次的命名，例如 BFF 和 Facade 层，和目前主流的微服务架构不符，还有他的架构应该是手绘，不够清晰，也不容易理解。为此，我专门用今天这一讲，来改进 Thijs 给出的架构，并补充针对不同场景的流程。</p><p>为了方便理解，在接下来的讲述中，我会假定有这样一家叫 ACME 的新零售公司，它已经实现了数字化转型，微服务电商平台是支持业务运作的核心基础设施。</p><p>在业务架构方面，ACME 有近千家线下门店，这些门店通过 POS 系统和电商平台对接。公司还有一些物流发货中心，拣选（Order Picking）系统也要和电商平台对接。另外，公司还有很多送货司机，通过 App 和电商平台对接。当然，ACME 还有一些电商网站，做线上营销和销售，这些网站是电商平台的主要流量源。</p><p>虽然支持 ACME 公司业务运作的技术平台很复杂，但是它的核心可以用一个简化的微服务架构图来描述：</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/228199yya6051f1f62f23547a88be4ff.jpg" alt="img"></p><p>可以看出，这个微服务架构是运行在 Kubernetes 集群中的。当然了，这个架构实际上并不一定需要 Kubernetes 环境，用传统数据中心也可以。另外，它的整体认证授权架构是基于 OAuth 2.0/JWT 实现的。</p><p>接下来，我按这个微服务架构的分层方式，依次和你分析下它的每一层，以及应用认证 / 授权和服务调用的相关流程。这样，你不仅可以理解一个典型的微服务架构该如何分层，还可以弄清楚 OAuth 2.0/JWT 该如何与微服务进行集成。</p><h2 id="微服务分层架构" tabindex="-1"><a class="header-anchor" href="#微服务分层架构"><span>微服务分层架构</span></a></h2><p>ACME 公司的微服务架构，大致可以分为 Nginx 反向代理层、Web 应用层、Gateway 网关层、BEF 层和领域服务层，还包括一个 IDP 服务。总体上讲，这是一种目前主流的微服务架构分层方式，每一层职责单一、清晰。</p><p>接下来，我们具体看看每一层的主要功能。</p><h3 id="nginx-反向代理层" tabindex="-1"><a class="header-anchor" href="#nginx-反向代理层"><span>Nginx 反向代理层</span></a></h3><p>首先，Nginx 集群是整个平台的流量入口。Nginx 是 7 层 HTTP 反向代理，主要功能是实现反向路由，也就是将外部流量根据 HOST 主机头或者 PATH，路由到不同的后端，比方说路由到 Web 应用，或者直接到网关 Gateway。在 Kubernetes 体系中，Nginx 是和 Ingress Controller（入口控制器）配合工作的（总称为 Nginx Ingress），Ingress Controller 支持通过 Ingress Rules，配置 Nginx 的路由规则。</p><h3 id="web-应用层" tabindex="-1"><a class="header-anchor" href="#web-应用层"><span>Web 应用层</span></a></h3><p>这一层主要是一些 Web 应用，html/css/js 等资源就住在这一层。Web 服务层通常采用传统的 Web MVC + 模版引擎方式处理，可以实现服务器端渲染，也可以采用单页 SPA 方式。这一层主要由公司的前端团队负责，通常会使用 Node.js 技术栈来实现，也可以采用 Spring MVC 技术栈实现。具体怎么实现，要看公司的前端团队更擅长哪种技术。当这一层需要后台数据时，可以通过网关调用后台服务获取数据。</p><h3 id="gateway-网关层" tabindex="-1"><a class="header-anchor" href="#gateway-网关层"><span>Gateway 网关层</span></a></h3><p>这一层是微服务调用流量的入口。网关的主要职责是反向路由，也就是将前端请求根据 HOST 主机头、或者 PATH、或者查询参数，路由到后端目标微服务（比如，图中的 IDP/BFF 或者直接到领域服务)。</p><p>另外，网关还承担两个重要的安全职责：</p><ul><li>一个是令牌的校验和转换，将前端传递过来的 OAuth 2.0 访问令牌，通过调用 IDP 进行校验，并转换为包含用户和权限信息的 JWT 令牌，再将 JWT 令牌向后台微服务传递。</li><li>另外一个是权限校验，网关的路由表可以和 OAuth 2.0 的 Scope 进行关联。这样，网关根据请求令牌中的权限范围 Scope，就可以判断请求是否具有调用后台服务的权限。</li></ul><p>关于安全相关的场景和流程，我会在下一章节做进一步解释。另外，网关还需承担集中式限流、日志监控，以及支持 CORS 等功能。对于网关层的技术选型，当前主流的 API 网关产品，像 Netflix 开源的 Zuul、Spring Cloud Gateway 等，都可以考虑。</p><h3 id="idp-服务" tabindex="-1"><a class="header-anchor" href="#idp-服务"><span>IDP 服务</span></a></h3><p>IDP 是 Identity Provider 的简称，主要负责 OAuth 2.0 授权协议处理，OAuth 2.0 和 JWT 令牌颁发和管理，以及用户认证等功能。IDP 使用后台的 Login-Service 进行用户认证。对于 IDP 的技术选型，当前主流的 Spring Security OAuth，或者 RedHat 开源的 KeyCloak，都可以考虑。其中，Spring Security OAuth 是一个 OAuth 2.0 的开发框架，适合企业定制。KeyCloak 则是一个开箱即用的 OAuth 2.0/OIDC 产品。</p><h3 id="bff-层" tabindex="-1"><a class="header-anchor" href="#bff-层"><span>BFF 层</span></a></h3><p>BFF 是 Backend for Frontend 的简称，主要实现对后台领域服务的聚合（Aggregation，有点类似数据库的 Join）功能，同时为不同的前端体验（PC/Mobile/ 开放平台等）提供更友好的 API 和数据格式。</p><p>BFF 中可以包含一些业务逻辑，甚至还可以有自己的数据库存储。通常，BFF 要调用两个或两个以上的领域服务，甚至还可能调用其它的 BFF（当然一般并不建议这样调用，因为这样会让调用关系变得错综复杂，无法理解）。</p><p>如果 BFF 需要获取调用用户或者 OAuth 2.0 Scope 相关信息，它可以从传递过来的 JWT 令牌中直接获取。</p><p>BFF 服务可以用 Node.js 开发，也可以用 Java/Spring 等框架开发。</p><h3 id="领域服务层" tabindex="-1"><a class="header-anchor" href="#领域服务层"><span>领域服务层</span></a></h3><p>领域服务层在整个微服务架构的底层。这些服务包含业务逻辑，通常有自己独立的数据库存储，还可以根据需要调用外部的服务。根据微服务分层原则，领域服务禁止调用其它的领域服务，更不允许反向调用 BFF 服务。这样做是为了保持微服务职责单一（Single Responsibility）和有界上下文（Bounded Context），避免复杂的领域依赖。领域服务是独立的开发、测试和发布单位。在电商领域，常见的领域服务有用户服务、商品服务、订单服务和支付服务等。和 BFF 一样，如果领域服务需要获取调用用户或者 OAuth 2.0 Scope 相关信息，它可以从传递过来的 JWT 令牌中直接获取。可以看到，领域服务和 BFF 服务都是无状态的，它们本身并不存储用户状态，而是通过传递过来的 JWT 数据获取用户信息。所以在整个架构中，微服务都是无状态、可以按需水平扩展的，状态要么存在用户端（浏览器或者手机 App 中），要么存在集中的数据库中。</p><h2 id="oauth-2-0-jwt-如何与微服务进行集成" tabindex="-1"><a class="header-anchor" href="#oauth-2-0-jwt-如何与微服务进行集成"><span>OAuth 2.0/JWT 如何与微服务进行集成？</span></a></h2><p>以上，就是 ACME 公司的整个微服务架构的层次了。这个分层架构，对于大部分的互联网业务系统场景都适用。因此，如果你是一家企业的架构师，需要设计一套微服务架构，完全可以参考它来设计。接下来，我再演示几个典型的应用认证场景，以及相应的服务调用流程，来帮助你理解 OAuth 2.0/JWT 是如何和微服务进行集成的。</p><h3 id="场景-1-第一方-web-应用-资源拥有者凭据模式" tabindex="-1"><a class="header-anchor" href="#场景-1-第一方-web-应用-资源拥有者凭据模式"><span>场景 1：第一方 Web 应用 + 资源拥有者凭据模式</span></a></h3><p>这个场景是用户访问 ACME 公司自己的电商网站，假设这个电商网站是用 Spring MVC 开发的。考虑到这是一个第一方场景（也就是公司自己开发的网站应用），我们可以选 OAuth 2.0 的资源拥有者凭据许可（Resource Owner Password Credentials Grant），也可以选更安全的授权码许可（Authorization Code Grant）。因为这里没有第三方的概念，所以我们就选相对简单的资源拥有者凭据许可。下面是一个认证授权流程样例。注意，这个只是突出了关键步骤，实际生产的话，还有很多需要完善和优化的地方。另外，为描述简单，这里假定一个成功流程。</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/b658befe1da937fa3685b55522487dbd.jpg" alt="img"></p><p>在上面的图中，用户对应 OAuth 2.0 中的资源拥有者，ACME IDP 对应 OAuth 2.0 中的授权服务。另外，前面架构图中的后台微服务（包括 BFF 和基础领域服务），对应 OAuth 2.0 中的受保护资源。下面是流程说明：</p><ol><li>用户通过浏览器访问 ACME 公司的电商网站，点击登录链接。</li><li>Web 应用返回登录界面（这个登录页可以是网站自己定制开发）。</li><li>用户输入用户名、密码进行认证。</li><li>Web 应用将用户名、密码，通过网关转发到 IDP 的令牌获取端点（POST /oauth2/token，grant_type=password）。</li><li>IDP 通过 Login Service 对用户进行认证。</li><li>IDP 认证通过，返回有效访问令牌（根据需要也可以返回刷新令牌）。</li><li>Web 应用接收到访问令牌，创建用户 Session，并将 OAuth 2.0 令牌保存其中，然后返回登录成功到用户端。</li><li>用户浏览器中记录 Session Cookie，登录成功。</li></ol><p>那接下来，我们再来看看认证授权之后的服务调用流程。同样，这里也只是突出了关键步骤，并假定是一个成功流程。</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/c88e46dd26deb76d6yy8f42f83066f4a.jpg" alt="img"></p><ol><li>用户登录后，在网站上点击查看自己的购物历史记录。</li><li>Web 应用通过网关调用后台 API（查询用户的购物历史记录），请求 HTTP header 中带上 OAuth 2.0 令牌（来自用户 Session）。</li><li>网关截取 OAuth 2.0 令牌，去 IDP 进行校验。</li><li>IDP 校验令牌通过，再通过令牌查询用户和 Scope 信息，构建 JWT 令牌，返回。</li><li>网关获得 JWT 令牌，校验 Scope 是否有权限调用 API，如果有就转发到后台 API 进行调用。</li><li>后台 BFF（或者领域服务）通过传递过来的 JWT 获取用户信息，根据用户 ID 查询购物历史记录，返回。</li><li>Web 应用获得用户的购物历史数据，可以根据需要缓存在 Session 中，再返回用户端。</li><li>购物历史数据返回到用户浏览器端。</li></ol><p>注意，这个服务调用流程，也可以应用在其他场景中，比如我们接下来要学习的“第一方移动应用 + 授权码许可模式”和“第三方 Web 应用 + 授权码许可模式”。基本上只要你理解了这个流程原理，就可以根据实际场景灵活套用。</p><h3 id="场景-2-第一方移动应用-授权码许可模式" tabindex="-1"><a class="header-anchor" href="#场景-2-第一方移动应用-授权码许可模式"><span>场景 2：第一方移动应用 + 授权码许可模式</span></a></h3><p>第二个场景是用户通过手机访问 ACME 公司自己的电商 App。这是第一方的原生应用（Native App）场景，通常考虑选用 OAuth 2.0 的用户名密码模式，但是并不安全（参考<a href="https://www.kaper.com/cloud/micro-services-architecture-with-oauth2-and-jwt-part-3-idp/" target="_blank" rel="noopener noreferrer">MICRO-SERVICES ARCHITECTURE WITH OAUTH2 AND JWT – PART 3 – IDP的 Security Consideration<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 部分），所以业界建议采用授权码模式，而且是要支持PKCE扩展的授权码模式。那接下来，我们来看看这个认证授权的流程。同样，这里只是突出了关键步骤，并假定是一个成功流程。</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/443dab973274d8d13c76b2ef4cd1d393.jpg" alt="img"></p><ol><li>用户访问电商 App，点击登录。</li><li>App 生成 PKCE 相关的 code verifier + challenge。</li><li>App 以内嵌方式启动手机浏览器，访问 IDP 的统一认证页 (GET /authorize)，请求带上 PKCE 的 code challenge 相关参数。</li><li>IDP 返回统一认证页。</li><li>用户认证和授权。</li><li>IDP 通过 Login Service 对用户进行认证。</li><li>IDP 返回授权码到 App 浏览器。</li><li>App 截取浏览器带回的授权码，将授权码 +PKCE code verifer，通过网关转发到 IDP 的令牌获取端点（POST /oauth2/token, grant_type=authorization-code）。</li><li>IDP 校验 PKCE 和授权码，校验通过则返回有效访问令牌。</li><li>App 获取令牌，本地存储，登录成功。</li></ol><p>之后，App 如果需要和后台交互，可直接通过网关调用后台微服务，请求 HTTP header 中带上 OAuth 2.0 访问令牌即可。后续的服务调用流程，和“第一方应用 + 资源拥有者凭据模式”类似。</p><h3 id="场景-3-第三方-web-应用-授权码模式" tabindex="-1"><a class="header-anchor" href="#场景-3-第三方-web-应用-授权码模式"><span>场景 3：第三方 Web 应用 + 授权码模式</span></a></h3><p>第三个场景是某第三方合作厂商开发了一个 Web 网站，要访问 ACME 公司的电商开放平台 API。这是一个第三方 Web 应用场景，通常选用 OAuth 2.0 的授权码许可模式。那接下来，我们来看看这个认证授权的流程。同样，这里只是突出了关键步骤，并假设是一个成功流程。</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/02affbdf32f005af65454f3acc4cd957.jpg" alt="img"></p><ol><li>用户访问这个第三方 Web 应用，点击登录链接。</li><li>Web 应用后台向 ACME 公司的 IDP 服务发送申请授权码请求（GET /authorize）。</li><li>用户被重定向到 ACME 公司的 IDP 统一登录页面。</li><li>用户进行认证和授权。</li><li>IDP 通过 Login Service 对用户进行认证。</li><li>认证和授权通过，IDP 返回授权码。</li><li>Web 应用获得授权码，再向 IDP 服务的令牌获取端点发起请求（POST /oauth2/token, grant_type=authorization-code）。</li><li>IDP 校验授权码，校验通过则返回有效 OAuth 2.0 令牌（根据需要也可以返回刷新令牌）。</li><li>Web 应用创建用户 Session，将 OAuth 2.0 令牌保存在 Session 中，然后返回登录成功到用户端。</li><li>用户浏览器中记录 Session Cookie，登录成功。</li></ol><p>之后，第三方 Web 应用如果需要和 ACME 电商平台交互，可直接通过网关调用微服务，请求 HTTP header 中带上 OAuth 2.0 访问令牌即可。后续的服务调用流程，和前面的“第一方应用 + 资源拥有者凭据模式”类似。</p><p>==额外说明==</p><p>除了上面的三个主要场景和流程，我还要和你分享 6 点。这 6 点是对上面基本流程的补充，也是企业级的 OAuth 2.0 应用要额外考虑的。</p><p>==第一点是，IDP 的 API 要支持从 OAuth 2.0 访问令牌到 JWT 令牌的互转。== 今天我们提到的集成架构采用 OAuth 2.0 访问令牌 + JWT 令牌的混合模式，中间需要实现 OAuth 2.0 访问令牌到 JWT 令牌的互转。这个互转 API 并非 OAuth 2.0 的标准，有些 IDP 产品（比方 Spring Security OAuth）可能并不支持，因此需要用户定制扩展。</p><p>==第二点是，关于单页 SPA 应用场景。== 关于单页 SPA 应用场景，简单做法是采用隐式许可，但是这个模式是 OAuth 2.0 中比较不安全的，所以一般不建议采用。对于纯单页 SPA 应用，业界推荐的做法是：</p><ul><li>如果浏览器支持 Web Crypto for PKCE，则可以考虑使用类似“第一方移动应用”场景下的授权码许可 +PKCE 扩展流程；</li><li>否则，考虑 SPA+ 传统 Web 混合（hybrid）模式，前端页面可以住在客户浏览器端中，但登录认证还是由后台 Web 站点配合实现，走类似“第一方 Web 应用”场景的资源拥有者凭据模式，或者“第三方 Web 应用”场景下的授权码许可模式。</li></ul><p>==第三点是，关于 SSO 单点登录场景。== 为了简化描述，上面的流程没有考虑 SSO 单点登录场景。如果要支持 Web SSO，那么各种应用场景都必须通过浏览器 +IDP 登录页集中登录，并且 IDP 要支持 Session，用于维护登录态。如果 IDP 以集群方式部署的话，还要考虑粘性 Sticky Session 或者集中式 Session。</p><p>这样，当用户通过一个 Web 应用登录后，后续如果再用其它 Web 应用登录的话，只要 IDP 上的 Session 还存在，那么这个登录就可以自动完成，相当于单点登录。</p><p>当然，如果要支持 SSO，IDP 的 Session Cookie 要种在 Web 应用的根域上，也就是说不同 Web 应用的根域必须相同，否则会有跨域问题。</p><p>==第四点是关于 IDP 和网关的部署方式。== 前面的几张架构图中，IDP 虽然躲在网关后面，但实际上 IDP 可以直接通过 Nginx 对外暴露，不经过网关。或者，IDP 的登录授权页面，可以通过 Nginx 直接暴露，API 接口则走网关。</p><p>==第五点是关于刷新令牌。== 为了简化描述，上面的流程没有详细说明刷新令牌的集成方式。企业根据场景需要，可以启用刷新令牌，来延长用户的登录时间，具体的集成方式需要考虑安全性的需求。</p><p>==第六点是关于 Web Session。== 为了简化描述，在上面的流程中，Web 应用登录成功后假设启用 Web Session，也就是服务器端 Session。在实际场景中，Web Session 并非唯一选择，也可以采用简单的客户端 Session 方式，也称无状态 Session，也就是在客户端浏览器 Cookie 中保存 OAuth 2.0 访问令牌。</p><h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结"><span>小结</span></a></h2><p>好了，以上就是今天的主要内容了。今天，我和你分享了如何将行业标准的 OAuth 2.0/JWT 和微服务集成起来，你需要记住以下四点。</p><p>第一，目前主流的微服务架构大致可以分为 5 层，分别是：Nginx 流量接入层 -&gt;Web 应用层 -&gt;API 网关层 -&gt;BFF 聚合层 -&gt; 领域服务层。这个架构可以住在云原生的 Kubernetes 环境中，也可以住在传统数据中心里头。</p><p>第二，API 网关是微服务调用的入口，承担重要的安全认证和鉴权功能。主要的安全操作包括：一，通过 IDP 校验 OAuth 2.0 访问令牌，并获取带用户和权限信息的 JWT 令牌；二，基于 OAuth 2.0 的 Scope 对 API 调用进行鉴权。</p><p>第三，在微服务架构体系下，通常需要一个集中的 IDP 服务，它相当于一个 Authentication &amp; Authorization as a Service 角色，负责令牌颁发 / 校验 / 管理，还有用户认证。</p><p>第四，在今天这一讲提出的架构中，Web 应用层（网关之前）的安全机制主要基于 OAuth 2.0 访问令牌实现（它是一种透明令牌或者称引用令牌），微服务层（网关之后）的安全机制主要基于 JWT 令牌实现（它是一种不透明的自包含令牌）。网关层在中间实现两种令牌的转换。这是一种 OAuth 2.0 访问令牌 +JWT 令牌的混合模式。</p><p>之所以这样设计，是因为 Web 层靠近用户端，如果采用 JWT 令牌，会暴露用户信息，有一定的安全风险，所以采用 OAuth 2.0 访问令牌，它是一个无意义随机字符串。而在网关之后，安全风险相对低，同时很多服务需要用户信息，所以采用自包含用户信息的 JWT 令牌更合适。当然，如果企业内网没有特别的安全考量，也可以直接传递完全透明的用户信息（例如使用 JSON 格式）。</p><h2 id="思考题" tabindex="-1"><a class="header-anchor" href="#思考题"><span>思考题</span></a></h2><ol><li>除了今天我们讲到的 OAuth 2.0 访问令牌 +JWT 令牌的混合模式，实践中也可以全程采用 OAuth 2.0 访问令牌，或者全程采用 JWT 令牌。对比混合模式，如果全程采用 OAuth 2.0 访问令牌，或者全程采用 JWT 令牌，你觉得有哪些利弊呢？</li><li>你可以说说自己对基于传统 Web 应用的认证授权机制的理解吗？并对比今天讲到的现代微服务的认证授权机制，你可以说说它们之间的本质差异和相似点吗？</li></ol></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/ChenSino/ChenSino.github.io/edit/dev/docs/other/oauth2/12.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: chenxk@sonoscape.net">ChenSino</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/other/oauth2/11.html" aria-label="11 | 实战案例：使用Spring Security搭建一套基于JWT的OAuth 2.0架构"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->11 | 实战案例：使用Spring Security搭建一套基于JWT的OAuth 2.0架构</div></a><a class="route-link nav-link next" href="/other/oauth2/13.html" aria-label="13 | 各大开放平台是如何使用OAuth 2.0的？"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">13 | 各大开放平台是如何使用OAuth 2.0的？<!----></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">除了自渡，其他人爱莫能助</div><div class="vp-copyright">Copyright © 2024 ChenSino </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-TdR3A7lU.js" defer></script>
  </body>
</html>
