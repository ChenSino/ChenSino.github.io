<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.49" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-v2-demo.mrhope.site/java/advance/ThreadPool.html"><meta property="og:site_name" content="ChenSino"><meta property="og:title" content="线程池总结"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-08-01T13:56:59.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="chenkun"><meta property="article:tag" content="多线程"><meta property="article:tag" content="线程池"><meta property="article:published_time" content="2022-03-28T00:00:00.000Z"><meta property="article:modified_time" content="2022-08-01T13:56:59.000Z"><title>线程池总结 | ChenSino</title><meta name="description" content="ChenSino's Blog">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.4f290a4a.css">
    <link rel="modulepreload" href="/assets/app.6dfcc30b.js"><link rel="modulepreload" href="/assets/ThreadPool.html.16d4dfc7.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/ThreadPool.html.a25be842.js"><link rel="prefetch" href="/assets/index.html.7a357da1.js"><link rel="prefetch" href="/assets/home.html.8ad891df.js"><link rel="prefetch" href="/assets/slide.html.f4da2ea7.js"><link rel="prefetch" href="/assets/index.html.ede81817.js"><link rel="prefetch" href="/assets/index.html.9744057d.js"><link rel="prefetch" href="/assets/disable.html.a5310081.js"><link rel="prefetch" href="/assets/encrypt.html.2608d04d.js"><link rel="prefetch" href="/assets/markdown.html.c821b46a.js"><link rel="prefetch" href="/assets/page.html.5b5b128f.js"><link rel="prefetch" href="/assets/index.html.cf31d12e.js"><link rel="prefetch" href="/assets/index.html.64e385d0.js"><link rel="prefetch" href="/assets/index.html.23bfe191.js"><link rel="prefetch" href="/assets/aboutAsync.html.43b055a2.js"><link rel="prefetch" href="/assets/aboutEvent.html.3c40980d.js"><link rel="prefetch" href="/assets/aboutThis.html.1438eeb9.js"><link rel="prefetch" href="/assets/crossDomain.html.c0803e4e.js"><link rel="prefetch" href="/assets/crossDomain2.html.f8fff0b9.js"><link rel="prefetch" href="/assets/lazyLoad.html.d0e00ebd.js"><link rel="prefetch" href="/assets/throttle.html.49afbb35.js"><link rel="prefetch" href="/assets/index.html.d4c5b519.js"><link rel="prefetch" href="/assets/index.html.4395363b.js"><link rel="prefetch" href="/assets/index.html.8661efc8.js"><link rel="prefetch" href="/assets/index.html.2fbd61d6.js"><link rel="prefetch" href="/assets/eventBus.html.15f9c5cc.js"><link rel="prefetch" href="/assets/vue-Direactive.html.61857efc.js"><link rel="prefetch" href="/assets/vue-nextTick.html.420fbbf7.js"><link rel="prefetch" href="/assets/vue-pic.html.d2ebc45b.js"><link rel="prefetch" href="/assets/vue-router1.html.4ea3530b.js"><link rel="prefetch" href="/assets/vue3LifeTime.html.633d5cb7.js"><link rel="prefetch" href="/assets/vueExtend.html.e0240036.js"><link rel="prefetch" href="/assets/Arthas.html.a898cf26.js"><link rel="prefetch" href="/assets/Collection.html.342a0699.js"><link rel="prefetch" href="/assets/Future.html.3b4b8a34.js"><link rel="prefetch" href="/assets/MysqlMasterSlave.html.c0fb13de.js"><link rel="prefetch" href="/assets/ParentDelegationClassLoader.html.b00f154f.js"><link rel="prefetch" href="/assets/ProxyInJava.html.461b78dc.js"><link rel="prefetch" href="/assets/index.html.d7bb2190.js"><link rel="prefetch" href="/assets/ThreadLocal.html.f3e7c21d.js"><link rel="prefetch" href="/assets/ConstantPool.html.473812b7.js"><link rel="prefetch" href="/assets/CustomLRU.html.cf856d32.js"><link rel="prefetch" href="/assets/IntegerConstantPool.html.ba9e70da.js"><link rel="prefetch" href="/assets/index.html.ad65e77a.js"><link rel="prefetch" href="/assets/Serialization.html.2ecfc8d5.js"><link rel="prefetch" href="/assets/String.html.4072e0a1.js"><link rel="prefetch" href="/assets/NewObject.html.a078048a.js"><link rel="prefetch" href="/assets/index.html.8878acf3.js"><link rel="prefetch" href="/assets/SetObjectNull.html.cde439fb.js"><link rel="prefetch" href="/assets/StringAdd.html.1397dbbd.js"><link rel="prefetch" href="/assets/index.html.abfcfd1d.js"><link rel="prefetch" href="/assets/ebooks.html.80c0c9e7.js"><link rel="prefetch" href="/assets/CPUOverLoad.html.743bc50c.js"><link rel="prefetch" href="/assets/MysqlNote.html.86ef743e.js"><link rel="prefetch" href="/assets/MysqlRemoteConnect.html.8fe1722c.js"><link rel="prefetch" href="/assets/index.html.c84016d7.js"><link rel="prefetch" href="/assets/SQLOptimization.html.5144f2a7.js"><link rel="prefetch" href="/assets/DistributeLock.html.8ea4f5f5.js"><link rel="prefetch" href="/assets/Nacos.html.206dee16.js"><link rel="prefetch" href="/assets/index.html.0706b00d.js"><link rel="prefetch" href="/assets/2022-04-12.html.2accbf2a.js"><link rel="prefetch" href="/assets/BTree.html.fcedf845.js"><link rel="prefetch" href="/assets/CDN.html.aa5a08fb.js"><link rel="prefetch" href="/assets/ChromeDevTools.html.46f8cb05.js"><link rel="prefetch" href="/assets/CloudService.html.5154d6bf.js"><link rel="prefetch" href="/assets/DeployGithubPage.html.36eef517.js"><link rel="prefetch" href="/assets/GreatWallProxy.html.8923df65.js"><link rel="prefetch" href="/assets/Jenkins.html.85f2c352.js"><link rel="prefetch" href="/assets/index.html.81d33b9f.js"><link rel="prefetch" href="/assets/Service.html.074c792d.js"><link rel="prefetch" href="/assets/TyporaPicgo.html.bffb2f6d.js"><link rel="prefetch" href="/assets/GitCommands.html.e45776ad.js"><link rel="prefetch" href="/assets/index.html.e53e2778.js"><link rel="prefetch" href="/assets/gitConflict.html.a0a06655.js"><link rel="prefetch" href="/assets/gitRebase.html.21ae83ae.js"><link rel="prefetch" href="/assets/mergeBranch.html.6e42f30e.js"><link rel="prefetch" href="/assets/rebaseAndMerge.html.6f73e31e.js"><link rel="prefetch" href="/assets/reset.html.6a07d406.js"><link rel="prefetch" href="/assets/stash.html.41f15e9e.js"><link rel="prefetch" href="/assets/CommonUsedCMD.html.e0aeaf3c.js"><link rel="prefetch" href="/assets/Manjaro.html.0a09691b.js"><link rel="prefetch" href="/assets/index.html.997ea9b1.js"><link rel="prefetch" href="/assets/Samba.html.3b400ac7.js"><link rel="prefetch" href="/assets/TcpDump.html.ef57c38f.js"><link rel="prefetch" href="/assets/wsl.html.ca3eaa39.js"><link rel="prefetch" href="/assets/index.html.040b7bbc.js"><link rel="prefetch" href="/assets/IdeaDebug.html.4bd49bf0.js"><link rel="prefetch" href="/assets/index.html.412f5511.js"><link rel="prefetch" href="/assets/SoftWare.html.24825810.js"><link rel="prefetch" href="/assets/VsCode.html.803bdd6c.js"><link rel="prefetch" href="/assets/CloudServiceTraining.html.fa3dcffa.js"><link rel="prefetch" href="/assets/index.html.18e8fc98.js"><link rel="prefetch" href="/assets/BuildWebProject.html.5bab57b3.js"><link rel="prefetch" href="/assets/index.html.87155510.js"><link rel="prefetch" href="/assets/Restful.html.61bd7540.js"><link rel="prefetch" href="/assets/MybatisPlusDataSource.html.00c679f5.js"><link rel="prefetch" href="/assets/index.html.bddee993.js"><link rel="prefetch" href="/assets/mybatis.html.0752fdc7.js"><link rel="prefetch" href="/assets/BeanPostProcessor.html.5c190332.js"><link rel="prefetch" href="/assets/DesignPatternInSpring.html.f604fe2c.js"><link rel="prefetch" href="/assets/index.html.54c40c77.js"><link rel="prefetch" href="/assets/SpringCache.html.2728fe30.js"><link rel="prefetch" href="/assets/SpringExtensionPoint.html.3c52a91c.js"><link rel="prefetch" href="/assets/SpringIOC.html.f8f6898c.js"><link rel="prefetch" href="/assets/AOPLog.html.5c46ae70.js"><link rel="prefetch" href="/assets/index.html.13f85684.js"><link rel="prefetch" href="/assets/SpringBootAutoConfiguration.html.643f9ba6.js"><link rel="prefetch" href="/assets/index.html.b8ec26b6.js"><link rel="prefetch" href="/assets/multiModule.html.88bd5672.js"><link rel="prefetch" href="/assets/problem.html.c01869bf.js"><link rel="prefetch" href="/assets/404.html.0036cf6a.js"><link rel="prefetch" href="/assets/index.html.dca53f0d.js"><link rel="prefetch" href="/assets/index.html.5ef41a64.js"><link rel="prefetch" href="/assets/index.html.a27f2d5a.js"><link rel="prefetch" href="/assets/index.html.fd282c50.js"><link rel="prefetch" href="/assets/index.html.6ebb296b.js"><link rel="prefetch" href="/assets/index.html.da32227a.js"><link rel="prefetch" href="/assets/index.html.e6f96900.js"><link rel="prefetch" href="/assets/index.html.9757fff4.js"><link rel="prefetch" href="/assets/index.html.5bf547cf.js"><link rel="prefetch" href="/assets/index.html.92b2b460.js"><link rel="prefetch" href="/assets/index.html.cf3bced6.js"><link rel="prefetch" href="/assets/index.html.f2e945e7.js"><link rel="prefetch" href="/assets/index.html.9a2eeca8.js"><link rel="prefetch" href="/assets/index.html.985192a9.js"><link rel="prefetch" href="/assets/index.html.0123d18d.js"><link rel="prefetch" href="/assets/index.html.ad5fb755.js"><link rel="prefetch" href="/assets/index.html.b6d20c1d.js"><link rel="prefetch" href="/assets/index.html.1be1b1e3.js"><link rel="prefetch" href="/assets/index.html.33347be0.js"><link rel="prefetch" href="/assets/index.html.b491eaf3.js"><link rel="prefetch" href="/assets/index.html.0b7c7d30.js"><link rel="prefetch" href="/assets/index.html.c95347d0.js"><link rel="prefetch" href="/assets/index.html.4be1435b.js"><link rel="prefetch" href="/assets/index.html.1be5ab4b.js"><link rel="prefetch" href="/assets/index.html.b7435aef.js"><link rel="prefetch" href="/assets/index.html.ab2a2670.js"><link rel="prefetch" href="/assets/index.html.84387aac.js"><link rel="prefetch" href="/assets/index.html.8f682ad5.js"><link rel="prefetch" href="/assets/index.html.ce27fc28.js"><link rel="prefetch" href="/assets/index.html.9d80c505.js"><link rel="prefetch" href="/assets/index.html.b50a790e.js"><link rel="prefetch" href="/assets/index.html.6eafcf1e.js"><link rel="prefetch" href="/assets/index.html.7db8238d.js"><link rel="prefetch" href="/assets/index.html.d4b4ce0c.js"><link rel="prefetch" href="/assets/index.html.c2970e1e.js"><link rel="prefetch" href="/assets/index.html.3e43bec5.js"><link rel="prefetch" href="/assets/index.html.8f5b1b57.js"><link rel="prefetch" href="/assets/index.html.9b76524b.js"><link rel="prefetch" href="/assets/index.html.3b7dcc83.js"><link rel="prefetch" href="/assets/index.html.3ca34ad5.js"><link rel="prefetch" href="/assets/index.html.f73f2ebd.js"><link rel="prefetch" href="/assets/index.html.02f198cb.js"><link rel="prefetch" href="/assets/index.html.c44777fc.js"><link rel="prefetch" href="/assets/index.html.e3fb3531.js"><link rel="prefetch" href="/assets/index.html.b960a6c7.js"><link rel="prefetch" href="/assets/index.html.795b3d4c.js"><link rel="prefetch" href="/assets/index.html.fcc474c4.js"><link rel="prefetch" href="/assets/index.html.87d6817b.js"><link rel="prefetch" href="/assets/index.html.1cbaef19.js"><link rel="prefetch" href="/assets/index.html.66bab32f.js"><link rel="prefetch" href="/assets/home.html.6f6183e1.js"><link rel="prefetch" href="/assets/slide.html.b67d935f.js"><link rel="prefetch" href="/assets/index.html.97a15bb2.js"><link rel="prefetch" href="/assets/index.html.fac96c8d.js"><link rel="prefetch" href="/assets/disable.html.81d22aed.js"><link rel="prefetch" href="/assets/encrypt.html.7397230a.js"><link rel="prefetch" href="/assets/markdown.html.34297ed0.js"><link rel="prefetch" href="/assets/page.html.db27ca1a.js"><link rel="prefetch" href="/assets/index.html.769613d8.js"><link rel="prefetch" href="/assets/index.html.3c708d06.js"><link rel="prefetch" href="/assets/index.html.9279fb21.js"><link rel="prefetch" href="/assets/aboutAsync.html.bce09c7b.js"><link rel="prefetch" href="/assets/aboutEvent.html.40fcdf8b.js"><link rel="prefetch" href="/assets/aboutThis.html.3ca54525.js"><link rel="prefetch" href="/assets/crossDomain.html.b871584a.js"><link rel="prefetch" href="/assets/crossDomain2.html.abd5229b.js"><link rel="prefetch" href="/assets/lazyLoad.html.46801ba8.js"><link rel="prefetch" href="/assets/throttle.html.f4adcee9.js"><link rel="prefetch" href="/assets/index.html.86b11bd3.js"><link rel="prefetch" href="/assets/index.html.9f78bf03.js"><link rel="prefetch" href="/assets/index.html.3641c02e.js"><link rel="prefetch" href="/assets/index.html.d3868202.js"><link rel="prefetch" href="/assets/eventBus.html.24cfc0ca.js"><link rel="prefetch" href="/assets/vue-Direactive.html.1c35f69c.js"><link rel="prefetch" href="/assets/vue-nextTick.html.3fd5995f.js"><link rel="prefetch" href="/assets/vue-pic.html.28707940.js"><link rel="prefetch" href="/assets/vue-router1.html.5ecba665.js"><link rel="prefetch" href="/assets/vue3LifeTime.html.04b72f7e.js"><link rel="prefetch" href="/assets/vueExtend.html.28467a2d.js"><link rel="prefetch" href="/assets/Arthas.html.331687bb.js"><link rel="prefetch" href="/assets/Collection.html.fbb53eea.js"><link rel="prefetch" href="/assets/Future.html.cbb2d5f0.js"><link rel="prefetch" href="/assets/MysqlMasterSlave.html.f285fe98.js"><link rel="prefetch" href="/assets/ParentDelegationClassLoader.html.ff246045.js"><link rel="prefetch" href="/assets/ProxyInJava.html.8af9a643.js"><link rel="prefetch" href="/assets/index.html.176f03a4.js"><link rel="prefetch" href="/assets/ThreadLocal.html.02819c7a.js"><link rel="prefetch" href="/assets/ConstantPool.html.afcf1717.js"><link rel="prefetch" href="/assets/CustomLRU.html.56fab904.js"><link rel="prefetch" href="/assets/IntegerConstantPool.html.512961bf.js"><link rel="prefetch" href="/assets/index.html.1fc282c7.js"><link rel="prefetch" href="/assets/Serialization.html.470c4a84.js"><link rel="prefetch" href="/assets/String.html.c3881b33.js"><link rel="prefetch" href="/assets/NewObject.html.fe8a2a88.js"><link rel="prefetch" href="/assets/index.html.0557675c.js"><link rel="prefetch" href="/assets/SetObjectNull.html.7422d2ae.js"><link rel="prefetch" href="/assets/StringAdd.html.4de3790e.js"><link rel="prefetch" href="/assets/index.html.61f40425.js"><link rel="prefetch" href="/assets/ebooks.html.7fd16a40.js"><link rel="prefetch" href="/assets/CPUOverLoad.html.3c761bd2.js"><link rel="prefetch" href="/assets/MysqlNote.html.2d8349fa.js"><link rel="prefetch" href="/assets/MysqlRemoteConnect.html.597c1696.js"><link rel="prefetch" href="/assets/index.html.fa613840.js"><link rel="prefetch" href="/assets/SQLOptimization.html.18cbcaec.js"><link rel="prefetch" href="/assets/DistributeLock.html.bc1ed5e7.js"><link rel="prefetch" href="/assets/Nacos.html.99ae4247.js"><link rel="prefetch" href="/assets/index.html.86749137.js"><link rel="prefetch" href="/assets/2022-04-12.html.57da8030.js"><link rel="prefetch" href="/assets/BTree.html.9839ddb2.js"><link rel="prefetch" href="/assets/CDN.html.5f99a523.js"><link rel="prefetch" href="/assets/ChromeDevTools.html.00a70165.js"><link rel="prefetch" href="/assets/CloudService.html.05b64370.js"><link rel="prefetch" href="/assets/DeployGithubPage.html.772d46f4.js"><link rel="prefetch" href="/assets/GreatWallProxy.html.171e7710.js"><link rel="prefetch" href="/assets/Jenkins.html.beca110b.js"><link rel="prefetch" href="/assets/index.html.29c5eea2.js"><link rel="prefetch" href="/assets/Service.html.cd1fe5bd.js"><link rel="prefetch" href="/assets/TyporaPicgo.html.c25625a3.js"><link rel="prefetch" href="/assets/GitCommands.html.0e81c317.js"><link rel="prefetch" href="/assets/index.html.ed765fe8.js"><link rel="prefetch" href="/assets/gitConflict.html.1d962fd2.js"><link rel="prefetch" href="/assets/gitRebase.html.b690a3ad.js"><link rel="prefetch" href="/assets/mergeBranch.html.fee26883.js"><link rel="prefetch" href="/assets/rebaseAndMerge.html.4e92e687.js"><link rel="prefetch" href="/assets/reset.html.4533c43f.js"><link rel="prefetch" href="/assets/stash.html.217097ad.js"><link rel="prefetch" href="/assets/CommonUsedCMD.html.64b381c9.js"><link rel="prefetch" href="/assets/Manjaro.html.b3041159.js"><link rel="prefetch" href="/assets/index.html.2dd8785c.js"><link rel="prefetch" href="/assets/Samba.html.0e7782aa.js"><link rel="prefetch" href="/assets/TcpDump.html.2c345307.js"><link rel="prefetch" href="/assets/wsl.html.35bd1ef5.js"><link rel="prefetch" href="/assets/index.html.9cf8dfe1.js"><link rel="prefetch" href="/assets/IdeaDebug.html.fa2e460f.js"><link rel="prefetch" href="/assets/index.html.2fe841e7.js"><link rel="prefetch" href="/assets/SoftWare.html.14e76512.js"><link rel="prefetch" href="/assets/VsCode.html.fce0459a.js"><link rel="prefetch" href="/assets/CloudServiceTraining.html.eca22d70.js"><link rel="prefetch" href="/assets/index.html.176d4a7d.js"><link rel="prefetch" href="/assets/BuildWebProject.html.d175ed36.js"><link rel="prefetch" href="/assets/index.html.190f895b.js"><link rel="prefetch" href="/assets/Restful.html.aac3bac4.js"><link rel="prefetch" href="/assets/MybatisPlusDataSource.html.0dec464d.js"><link rel="prefetch" href="/assets/index.html.6cedeca2.js"><link rel="prefetch" href="/assets/mybatis.html.e9497c5d.js"><link rel="prefetch" href="/assets/BeanPostProcessor.html.ebf4748d.js"><link rel="prefetch" href="/assets/DesignPatternInSpring.html.73c922e5.js"><link rel="prefetch" href="/assets/index.html.680c283b.js"><link rel="prefetch" href="/assets/SpringCache.html.d18e7396.js"><link rel="prefetch" href="/assets/SpringExtensionPoint.html.c19e3786.js"><link rel="prefetch" href="/assets/SpringIOC.html.ab38ddfc.js"><link rel="prefetch" href="/assets/AOPLog.html.c980aa96.js"><link rel="prefetch" href="/assets/index.html.47c2b786.js"><link rel="prefetch" href="/assets/SpringBootAutoConfiguration.html.16d5c135.js"><link rel="prefetch" href="/assets/index.html.0d79858f.js"><link rel="prefetch" href="/assets/multiModule.html.0ba26f59.js"><link rel="prefetch" href="/assets/problem.html.622acde1.js"><link rel="prefetch" href="/assets/404.html.c9c1670f.js"><link rel="prefetch" href="/assets/index.html.e903d8aa.js"><link rel="prefetch" href="/assets/index.html.cc86f49b.js"><link rel="prefetch" href="/assets/index.html.c04e2761.js"><link rel="prefetch" href="/assets/index.html.0b71e7d5.js"><link rel="prefetch" href="/assets/index.html.c2ab7762.js"><link rel="prefetch" href="/assets/index.html.b8b4c190.js"><link rel="prefetch" href="/assets/index.html.343fab3e.js"><link rel="prefetch" href="/assets/index.html.2820ed28.js"><link rel="prefetch" href="/assets/index.html.2572728b.js"><link rel="prefetch" href="/assets/index.html.2d7bf8e1.js"><link rel="prefetch" href="/assets/index.html.85d9dda4.js"><link rel="prefetch" href="/assets/index.html.0afb19f0.js"><link rel="prefetch" href="/assets/index.html.c3ceb5cb.js"><link rel="prefetch" href="/assets/index.html.2e6c78fa.js"><link rel="prefetch" href="/assets/index.html.2d9b21fd.js"><link rel="prefetch" href="/assets/index.html.2c86556c.js"><link rel="prefetch" href="/assets/index.html.142809b8.js"><link rel="prefetch" href="/assets/index.html.67528131.js"><link rel="prefetch" href="/assets/index.html.0fb56b58.js"><link rel="prefetch" href="/assets/index.html.fae6563c.js"><link rel="prefetch" href="/assets/index.html.21c730a3.js"><link rel="prefetch" href="/assets/index.html.9aa53e32.js"><link rel="prefetch" href="/assets/index.html.090a2dad.js"><link rel="prefetch" href="/assets/index.html.4d928dbf.js"><link rel="prefetch" href="/assets/index.html.0e85a5da.js"><link rel="prefetch" href="/assets/index.html.4e0b1975.js"><link rel="prefetch" href="/assets/index.html.2f0eb554.js"><link rel="prefetch" href="/assets/index.html.b45d90eb.js"><link rel="prefetch" href="/assets/index.html.6bf5086d.js"><link rel="prefetch" href="/assets/index.html.26f8304d.js"><link rel="prefetch" href="/assets/index.html.302d9b3d.js"><link rel="prefetch" href="/assets/index.html.a743dd2e.js"><link rel="prefetch" href="/assets/index.html.db414eac.js"><link rel="prefetch" href="/assets/index.html.cf591b35.js"><link rel="prefetch" href="/assets/index.html.03bb4032.js"><link rel="prefetch" href="/assets/index.html.ecf7c81c.js"><link rel="prefetch" href="/assets/index.html.5f39a4f0.js"><link rel="prefetch" href="/assets/index.html.5810885f.js"><link rel="prefetch" href="/assets/index.html.3aca391e.js"><link rel="prefetch" href="/assets/index.html.f2f7e479.js"><link rel="prefetch" href="/assets/index.html.0a46f480.js"><link rel="prefetch" href="/assets/index.html.6ffd20f3.js"><link rel="prefetch" href="/assets/index.html.48054547.js"><link rel="prefetch" href="/assets/index.html.23a89bec.js"><link rel="prefetch" href="/assets/index.html.bf808d4a.js"><link rel="prefetch" href="/assets/index.html.8d1787b4.js"><link rel="prefetch" href="/assets/index.html.b316a6e0.js"><link rel="prefetch" href="/assets/index.html.be6e93f3.js"><link rel="prefetch" href="/assets/index.html.92e02e43.js"><link rel="prefetch" href="/assets/404.96f42e11.js"><link rel="prefetch" href="/assets/Layout.4791cbbb.js"><link rel="prefetch" href="/assets/Slide.3f89f1a9.js"><link rel="prefetch" href="/assets/Blog.e8854c89.js"><link rel="prefetch" href="/assets/giscus.8fe73ced.js"><link rel="prefetch" href="/assets/auto.esm.2565cd3a.js"><link rel="prefetch" href="/assets/index.d8a59108.js"><link rel="prefetch" href="/assets/index.1842ee54.js"><link rel="prefetch" href="/assets/mermaid.esm.min.ee1e0284.js"><link rel="prefetch" href="/assets/highlight.esm.d982e650.js"><link rel="prefetch" href="/assets/markdown.esm.832a189d.js"><link rel="prefetch" href="/assets/math.esm.a3f84b6f.js"><link rel="prefetch" href="/assets/notes.esm.3c361cb7.js"><link rel="prefetch" href="/assets/reveal.esm.b96f05d8.js"><link rel="prefetch" href="/assets/search.esm.80da4a02.js"><link rel="prefetch" href="/assets/zoom.esm.8514a202.js"><link rel="prefetch" href="/assets/photoswipe.esm.218074cd.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="ChenSino"><!----><span class="site-name hide-in-pad">ChenSino</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/home.html" class="nav-link" aria-label="Home"><FontIcon icon="home"></FontIcon>Home<!----></a></div><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="ChenSino"><FontIcon icon="home"></FontIcon>ChenSino<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Java"><span class="title"><FontIcon icon="java"></FontIcon>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/java/base/Serialization.html" class="nav-link" aria-label="Java基础"><FontIcon icon="java"></FontIcon>Java基础<!----></a></li><li class="dropdown-item"><a href="/java/advance/ProxyInJava.html" class="nav-link" aria-label="Java进阶"><FontIcon icon="java"></FontIcon>Java进阶<!----></a></li><li class="dropdown-item"><a href="/java/jvm/NewObject.html" class="nav-link" aria-label="Java虚拟机"><FontIcon icon="java"></FontIcon>Java虚拟机<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="前端"><span class="title"><FontIcon icon="javascript"></FontIcon>前端</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/frontweb/vue/" class="nav-link" aria-label="Vue"><FontIcon icon="vue"></FontIcon>Vue<!----></a></li><li class="dropdown-item"><a href="/frontweb/vite/" class="nav-link" aria-label="Vite"><FontIcon icon="vue"></FontIcon>Vite<!----></a></li><li class="dropdown-item"><a href="/frontweb/es5/" class="nav-link" aria-label="ES5"><FontIcon icon="javascript"></FontIcon>ES5<!----></a></li><li class="dropdown-item"><a href="/frontweb/es6/" class="nav-link" aria-label="ES6"><FontIcon icon="javascript"></FontIcon>ES6<!----></a></li><li class="dropdown-item"><a href="/frontweb/typeScript/" class="nav-link" aria-label="TypeScript"><FontIcon icon="javascript"></FontIcon>TypeScript<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/other/web/" class="nav-link" aria-label="前后分离项目搭建"><FontIcon icon="app"></FontIcon>前后分离项目搭建<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="其他"><span class="title"><FontIcon icon="others"></FontIcon>其他</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/other/git/GitCommands.html" class="nav-link" aria-label="Git"><FontIcon icon="git"></FontIcon>Git<!----></a></li><li class="dropdown-item"><a href="/other/linux/CommonUsedCMD.html" class="nav-link" aria-label="Linux"><FontIcon icon="linux"></FontIcon>Linux<!----></a></li><li class="dropdown-item"><a href="/other/database/CPUOverLoad.html" class="nav-link" aria-label="DataBase"><FontIcon icon="java"></FontIcon>DataBase<!----></a></li><li class="dropdown-item"><a href="/other/markdown/" class="nav-link" aria-label="MarkDown"><FontIcon icon="markdown"></FontIcon>MarkDown<!----></a></li><li class="dropdown-item"><a href="/other/tools/IdeaDebug.html" class="nav-link" aria-label="工具软件"><FontIcon icon="software"></FontIcon>工具软件<!----></a></li><li class="dropdown-item"><a href="/other/training/CloudServiceTraining.html" class="nav-link" aria-label="小组分享"><FontIcon icon="share"></FontIcon>小组分享<!----></a></li><li class="dropdown-item"><a href="/other/essay/2022-04-12.html" class="nav-link" aria-label="随笔杂记"><FontIcon icon="activity"></FontIcon>随笔杂记<!----></a></li><li class="dropdown-item"><a href="/other/books/ebooks.html" class="nav-link" aria-label="电子书资源"><FontIcon icon="app"></FontIcon>电子书资源<!----></a></li><li class="dropdown-item"><a href="/other/distributeservice/DistributeLock.html" class="nav-link" aria-label="分布式微服务"><FontIcon icon="class"></FontIcon>分布式微服务<!----></a></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/ChenSino/ChenSino.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><FontIcon icon="discover"></FontIcon><span class="title">Java 基础</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><FontIcon icon="blog"></FontIcon><span class="title">Java 进阶</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/java/advance/" class="nav-link sidebar-link sidebar-page" aria-label="Java进阶"><FontIcon></FontIcon>Java进阶<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/advance/Collection.html" class="nav-link sidebar-link sidebar-page" aria-label="java集合源码分析"><FontIcon></FontIcon>java集合源码分析<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/advance/MysqlMasterSlave.html" class="nav-link sidebar-link sidebar-page" aria-label="mysql8搭建主从复制"><FontIcon></FontIcon>mysql8搭建主从复制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/advance/ThreadLocal.html" class="nav-link sidebar-link sidebar-page" aria-label="ThreadLocal"><FontIcon></FontIcon>ThreadLocal<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/advance/Arthas.html" class="nav-link sidebar-link sidebar-page" aria-label="使用Arthas定位线上问题"><FontIcon></FontIcon>使用Arthas定位线上问题<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/advance/Future.html" class="nav-link sidebar-link sidebar-page" aria-label="多线程中的Future"><FontIcon></FontIcon>多线程中的Future<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/advance/ProxyInJava.html" class="nav-link sidebar-link sidebar-page" aria-label="彻底理清Java中的几种代理"><FontIcon></FontIcon>彻底理清Java中的几种代理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/java/advance/ThreadPool.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="线程池总结"><FontIcon></FontIcon>线程池总结<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/advance/ThreadPool.html#_1、先上测试代码" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1、先上测试代码"><FontIcon></FontIcon>1、先上测试代码<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/advance/ThreadPool.html#_2、-源码解析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2、 源码解析"><FontIcon></FontIcon>2、 源码解析<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/advance/ThreadPool.html#_2-1-修改测试代码继续测试" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1 修改测试代码继续测试"><FontIcon></FontIcon>2.1 修改测试代码继续测试<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/advance/ThreadPool.html#_2-2-测试带返回值的多线程任务" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2 测试带返回值的多线程任务"><FontIcon></FontIcon>2.2 测试带返回值的多线程任务<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/advance/ThreadPool.html#_3、线程池的总结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3、线程池的总结"><FontIcon></FontIcon>3、线程池的总结<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/advance/ThreadPool.html#_3-1-不建议使用官方工具类直接创建" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1 不建议使用官方工具类直接创建"><FontIcon></FontIcon>3.1 不建议使用官方工具类直接创建<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/advance/ThreadPool.html#_3-2-java-util-concurrent-threadpoolexecutor" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2 java.util.concurrent.ThreadPoolExecutor"><FontIcon></FontIcon>3.2 java.util.concurrent.ThreadPoolExecutor<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/advance/ThreadPool.html#_3-3-线程池中的异常处理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3 线程池中的异常处理"><FontIcon></FontIcon>3.3 线程池中的异常处理<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/advance/ThreadPool.html#_3-4-补充说明" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.4 补充说明"><FontIcon></FontIcon>3.4 补充说明<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/java/advance/ParentDelegationClassLoader.html" class="nav-link sidebar-link sidebar-page" aria-label="证明SPI打破双亲委派模式"><FontIcon></FontIcon>证明SPI打破双亲委派模式<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><FontIcon icon="write"></FontIcon><span class="title">Java 虚拟机</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><FontIcon></FontIcon>线程池总结</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" localizeddate="2022年3月28日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="author-item">chenkun</span></span><span property="author" content="chenkun"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年3月28日</span><meta property="datePublished" content="2022-03-28T00:00:00.000Z"></span><span class="category-info" aria-label="分类🌈" data-balloon-pos="down" localizeddate="2022年3月28日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category2 clickable" role="navigation">线程池</li><li class="category category5 clickable" role="navigation">多线程</li><meta property="articleSection" content="线程池,多线程"></ul></span><span aria-label="标签🏷" data-balloon-pos="down" localizeddate="2022年3月28日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag5 clickable" role="navigation">多线程</li><li class="tag tag2 clickable" role="navigation">线程池</li></ul><meta property="keywords" content="多线程,线程池"></span><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" localizeddate="2022年3月28日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 12 分钟</span><meta property="timeRequired" content="PT12M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/advance/ThreadPool.html#_1、先上测试代码" class="router-link-active router-link-exact-active toc-link level2">1、先上测试代码</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/advance/ThreadPool.html#_2、-源码解析" class="router-link-active router-link-exact-active toc-link level2">2、 源码解析</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/advance/ThreadPool.html#_2-1-修改测试代码继续测试" class="router-link-active router-link-exact-active toc-link level3">2.1 修改测试代码继续测试</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/advance/ThreadPool.html#_2-2-测试带返回值的多线程任务" class="router-link-active router-link-exact-active toc-link level3">2.2 测试带返回值的多线程任务</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/advance/ThreadPool.html#_3、线程池的总结" class="router-link-active router-link-exact-active toc-link level2">3、线程池的总结</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/advance/ThreadPool.html#_3-1-不建议使用官方工具类直接创建" class="router-link-active router-link-exact-active toc-link level3">3.1 不建议使用官方工具类直接创建</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/advance/ThreadPool.html#_3-2-java-util-concurrent-threadpoolexecutor" class="router-link-active router-link-exact-active toc-link level3">3.2 java.util.concurrent.ThreadPoolExecutor</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/advance/ThreadPool.html#_3-3-线程池中的异常处理" class="router-link-active router-link-exact-active toc-link level3">3.3 线程池中的异常处理</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/advance/ThreadPool.html#_3-4-补充说明" class="router-link-active router-link-exact-active toc-link level3">3.4 补充说明</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><p>线程池</p><p><strong>前言：</strong></p><blockquote><p>线程池使用submit提交任务若遇到异常，线程不会直接抛出异常，在开发中要注意处理异常情况</p></blockquote><h2 id="_1、先上测试代码" tabindex="-1"><a class="header-anchor" href="#_1、先上测试代码" aria-hidden="true">#</a> 1、先上测试代码</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果：</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220329145737001.png" alt="image-20220329145737001"></p><p>测试发现异常并未抛出，如果不知道这个知识点线上遇到问题就不好排查，我因为在测试环境使用<code>executorService.submit</code>,submit方法提交后就没管了，结果在submit有异常，一直没往这里想，搞了俩小时才定位到。</p><h2 id="_2、-源码解析" tabindex="-1"><a class="header-anchor" href="#_2、-源码解析" aria-hidden="true">#</a> 2、 源码解析</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * Submits a Runnable task for execution and returns a Future
     * representing that task. The Future&#39;s <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">get</span></span><span class="token punctuation">}</span> method will
     * return <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">null</span></span></span><span class="token punctuation">}</span> upon <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>successful<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span> completion.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">task</span> the task to submit
     * <span class="token keyword">@return</span> a Future representing pending completion of the task
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">RejectedExecutionException</span></span> if the task cannot be
     *         scheduled for execution
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">NullPointerException</span></span> if the task is null
     */</span>
    <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注释中有说明，</p><ol><li><code>submit</code>方法执行成功时其返回的<code>Future.get()</code>应该是空；</li><li>当传入的task为<code>null</code>会直接在主进程抛出<code>NPE</code>，异常后调用它的进程后续代码就不会执行了；</li></ol><h3 id="_2-1-修改测试代码继续测试" tabindex="-1"><a class="header-anchor" href="#_2-1-修改测试代码继续测试" aria-hidden="true">#</a> 2.1 修改测试代码继续测试</h3><p>修改代码，在后面调用<code>Future.get()</code>看看</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> future1 <span class="token operator">=</span> executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;正常线程&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> future2 <span class="token operator">=</span> executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;异常线程&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        Runnable runnable = null;</span>
<span class="token comment">//        Future&lt;?&gt; future3 = executorService.submit(runnable);</span>

        <span class="token class-name">Object</span> o <span class="token operator">=</span> future1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Object</span> o1 <span class="token operator">=</span> future2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o1<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220329151313405.png" alt="image-20220329151313405"></p><p>可以看到第一次执行成功的任务返回得到的是<code>null</code>，第二次抛出了异常，所以调用<code>submit</code>是要注意，此方法是带返回值的，和<code>execute</code>有区别，<code>execute</code>是没有返回值。</p><p>再看看为什么调用<code>java.util.concurrent.Future#get()</code>抛出异常，在以下源码注释写的很清楚了，当任务本身抛出异常，则调用<code>get</code>也会抛出一个<code>ExecutionException</code></p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220329152103052.png" alt="image-20220329152103052"></p><p>如果仅仅是为了能够抛出异常，直接使用<code>execute</code>即可，那么<code>submit</code>的<code>Future</code>有什么作用呢？</p><blockquote><p>有时我们执行多线程任务时，希望得到返回结果，而直接提交Runnable类型的任务话，是没有返回值的，java提供了另一个接口叫做Callable，它可以执行一个带返回值的任务</p></blockquote><h3 id="_2-2-测试带返回值的多线程任务" tabindex="-1"><a class="header-anchor" href="#_2-2-测试带返回值的多线程任务" aria-hidden="true">#</a> 2.2 测试带返回值的多线程任务</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//lambda写法，此处传入的是一个Caller匿名实现类</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;ok hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220329153946950.png" alt="image-20220329153946950"></p><p>可以看到调用get方法获取到了caller接口实现类中的返回值</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220329153915843.png" alt="image-20220329153915843"></p><p><code>java.util.concurrent.ExecutorService#submit(java.util.concurrent.Callable&lt;T&gt;)</code>源码</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220329154106854.png" alt="image-20220329154106854"></p><h2 id="_3、线程池的总结" tabindex="-1"><a class="header-anchor" href="#_3、线程池的总结" aria-hidden="true">#</a> 3、线程池的总结</h2><h3 id="_3-1-不建议使用官方工具类直接创建" tabindex="-1"><a class="header-anchor" href="#_3-1-不建议使用官方工具类直接创建" aria-hidden="true">#</a> 3.1 不建议使用官方工具类直接创建</h3><p><code>Executors</code>工具类实际上只是对<code>ThreadPoolExecutor</code>进行了简单的封装，所以还是有必要对<code>ThreadPoolExecutor</code>进行学习</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220329155120825.png" alt="image-20220329155120825"></p><h3 id="_3-2-java-util-concurrent-threadpoolexecutor" tabindex="-1"><a class="header-anchor" href="#_3-2-java-util-concurrent-threadpoolexecutor" aria-hidden="true">#</a> 3.2 <code>java.util.concurrent.ThreadPoolExecutor</code></h3><h4 id="_3-2-1-构造方法" tabindex="-1"><a class="header-anchor" href="#_3-2-1-构造方法" aria-hidden="true">#</a> 3.2.1 构造方法</h4><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220329161315724.png" alt="image-20220329161315724"></p><p>表面上看有4个，实际上就一个在干活，最终都调用的是下面这个，无非就是传递不同的构造参数，这里点开<code>java.util.concurrent.Executors#newFixedThreadPool(int)</code>看一下就知道了</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220329161738207.png" alt="image-20220329161738207"></p><p><strong>构造参数说明：</strong></p><p><strong>corePoolSize</strong>：初始化时给该池子的线程数，当任务来了以后先初始化corePoolSize个线程放在池子（<code>new ThreadPoolExecutor</code>的时候还没有创建，是提交任务后才会初始化）；</p><p><strong>maximumPoolSize</strong>：当任务队列过多时最大能扩展的线程数；</p><p><strong>keepAliveTime</strong>：当任务执行完了以后，空闲线程最大能空闲的时间，超过该时间则回收。比如corePoolSize为2，maximumPoolSize为4，BlockingQueue队列为2个长度，此时来了10个任务，则前2个任务交给corePoolSize 那两个线程来执行，3、4任务缓存在BlockingQueue队列中，第5个任务到来的时候，就要再起一个线程，第6个任务来了再起一个线程，此时总线程数已经达到了maximumPoolSize，有新任务来了也不能再起新的线程了（后面的7、8、9、10 任务请求再来的话就要根据设置的RejectedExecutionHandler策略来处理，此处先不考虑），当任务执行完后，新启动的两个线程也就空闲下来，这时就开始计时，空闲时间达到了keepAliveTime则把线程回收了，这是就是剩下corePoolSize个线程存活了。</p><p>缓冲队列参考：https://blog.csdn.net/ican87/article/details/80874933</p><p>workQueue：缓存的队列，有多重实现队列。实现1：ArrayBlockingQueue，有界队列，可以限制缓存队列的大小；实现二：LinkedBlockingQueue，无界队列，能最多缓存<code>Integer.MAX_VALUE</code>个（当然也可以在构造函数中指定固定数量的缓存队列），理论上可以缓存一直到内存耗尽，使用该队列后则maximumPoolSize就失效了；实现三：SynchronousQueue，直接提交策略表示线程池不对任务进行缓存。新进任务直接提交给线程池，当线程池中没有空闲线程时，创建一个新的线程处理此任务。这种策略需要线程池具有无限增长的可能性。</p><p>handler：任务过多（缓存队列已满，并且已扩展到maximumPoolSize个线程，后续再来新的任务就会触发）触发拒绝策略。ThreadPoolExecutor内置了多中静态内部类，对应各种拒绝策略。</p><p>（1）AbortPolicy 拒绝策略：抛出运行时异常RejectedExecutionException。 这种策略丢弃任务，并抛出异常。（jdk默认策略） （2）DiscardPolicy 拒绝策略：不能执行的任务将被丢弃。 这种策略什么都没做。 （3）DiscardOldestPolicy 拒绝策略：如果执行程序尚未关闭，则位于工作队列头部的任务将被删除，然后重试执行程序。</p><p><img src="https://img2018.cnblogs.com/blog/940289/201903/940289-20190317160324929-400052712.png" alt=""></p><h4 id="_3-2-2-实验验证threadpoolexecutor各个参数的作用" tabindex="-1"><a class="header-anchor" href="#_3-2-2-实验验证threadpoolexecutor各个参数的作用" aria-hidden="true">#</a> 3.2.2 实验验证<code>ThreadPoolExecutor</code>各个参数的作用</h4><h5 id="_3-2-2-1-第一次测试" tabindex="-1"><a class="header-anchor" href="#_3-2-2-1-第一次测试" aria-hidden="true">#</a> 3.2.2.1 第一次测试</h5><p>自定义线程工厂，线程名随便起，我这里直接用时间戳</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThreadFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ThreadFactory</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">&quot;xxxx&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> t<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第一次测试参数：</p><table><thead><tr><th>参数</th><th>参数值</th></tr></thead><tbody><tr><td>corePoolSize</td><td>1</td></tr><tr><td>maximumPoolSize</td><td>4</td></tr><tr><td>keepAliveTime</td><td>100秒</td></tr><tr><td>workQueue</td><td>new LinkedBlockingQueue&lt;&gt;(1)</td></tr><tr><td>threadFactory</td><td>自定义工厂MyThreadFactory</td></tr><tr><td>handler</td><td>new ThreadPoolExecutor.AbortPolicy()</td></tr></tbody></table><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">100L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MyThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">//为了方便描述把此任务叫做A任务，以下分别为B\C\D</span>
        threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">&quot;=============AAAAAAAAAAAAaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===========BBBBBBBBBB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1010</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;===========CCCCCCCC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;=========DDDDD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">xxxxxxx30832344860303</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>AAAAAAAAAAAAaa
<span class="token assign-left variable">xxxxxxx30832345605562</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>CCCCCCCC
<span class="token assign-left variable">xxxxxxx30832345942575</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>DDDDD
<span class="token assign-left variable">xxxxxxx30832344860303</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>BBBBBBBBBB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到一共启动了3个线程，线程执行过程分析：</p><ol><li>提交A任务，先初始化<code>corePoolSize</code>个线程，并且分配一个线程执行A</li><li>此时再提交B任务，因为<code>corePoolSize</code>只有一个，所以需要给他缓存到队列，<code>LinkedBlockingQueue</code>设置的1,刚好可以缓存一个任务，B被缓存，先不执行</li><li>再提交C,此时发现<code>corePoolSize</code>初始化的线程用完了，<code>LinkedBlockingQueue</code>也用完了，而<code>maximumPoolSize</code>为4,还可以启动3个线程，所以在给C分配一个线程，运行任务</li><li>再提交D,和第三步一样，在启动一个线程，此时就已经达到<code>maximumPoolSize</code>个线程</li><li>空闲时间设置的100秒，意思是除了<code>corePoolSize</code>初始化的那个线程之外的另3个线程，在执行完自己的任务后，可以再等100秒，如果100秒内没有新的任务申请使用线程，那么就会被回收</li></ol><blockquote><p>根据以上分析可以测试结果完全合理，运行过程为A-C-D-B，当B因为被放进了缓存队列，只有当其他线程执行完以后，有空闲的线程B才会有机会运行，所以它在最后执行，</p></blockquote><p><strong>注意：</strong></p><p><em>以上我们上有4个任务，但是最终启动的线程只有3个，因为有一个被放进缓存队列</em></p><h5 id="_3-2-2-2-第二次测试" tabindex="-1"><a class="header-anchor" href="#_3-2-2-2-第二次测试" aria-hidden="true">#</a> 3.2.2.2 第二次测试</h5><p>在第一次测试基础上在加2个任务，测试拒绝策略，为什么加一个不行？自行思考一下</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    public static void main(String[] args) throws InterruptedException {
        ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(1, 4, 100L, TimeUnit.SECONDS, new LinkedBlockingQueue&lt;&gt;(1), new MyThreadFactory(), new ThreadPoolExecutor.AbortPolicy());
        threadPoolExecutor.execute(() -&gt; {
            System.out.println(Thread.currentThread().getName()+ &quot;=============AAAAAAAAAAAAaa&quot;);
            try {
                Thread.sleep(1001);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        });

        threadPoolExecutor.execute(() -&gt; {
                System.out.println(Thread.currentThread().getName() + &quot;===========BBBBBBBBBB&quot;);
            try {
                Thread.sleep(1010);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        });
        threadPoolExecutor.execute(() -&gt; {
                System.out.println(Thread.currentThread().getName() + &quot;===========CCCCCCCC&quot;);
            try {
                Thread.sleep(1001);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        });
        threadPoolExecutor.execute(() -&gt; {
            System.out.println(Thread.currentThread().getName() + &quot;=========DDDDD&quot;);
            try {
                Thread.sleep(1001);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        });
        threadPoolExecutor.execute(() -&gt; {
            System.out.println(Thread.currentThread().getName() + &quot;=========EEEEEE&quot;);
            try {
                Thread.sleep(1001);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        });
        threadPoolExecutor.execute(() -&gt; {
            System.out.println(Thread.currentThread().getName() + &quot;=========ffff&quot;);
            try {
                Thread.sleep(1001);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        });
    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">xxxxxxx31891613408362</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>AAAAAAAAAAAAaa
<span class="token assign-left variable">xxxxxxx31891614159432</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>CCCCCCCC
<span class="token assign-left variable">xxxxxxx31891614545186</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>DDDDD
<span class="token assign-left variable">xxxxxxx31891614917120</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>EEEEEE
Exception <span class="token keyword">in</span> thread <span class="token string">&quot;main&quot;</span> java.util.concurrent.RejectedExecutionException: Task com.chen.base.thread.ThreadFactoryClient<span class="token variable">$$</span>Lambda<span class="token variable">$6</span>/1828972342@568db2f2 rejected from java.util.concurrent.ThreadPoolExecutor@378bf509<span class="token punctuation">[</span>Running, pool size <span class="token operator">=</span> <span class="token number">4</span>, active threads <span class="token operator">=</span> <span class="token number">4</span>, queued tasks <span class="token operator">=</span> <span class="token number">1</span>, completed tasks <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">]</span>
	at java.util.concurrent.ThreadPoolExecutor<span class="token variable">$AbortPolicy</span>.rejectedExecution<span class="token punctuation">(</span>ThreadPoolExecutor.java:2063<span class="token punctuation">)</span>
	at java.util.concurrent.ThreadPoolExecutor.reject<span class="token punctuation">(</span>ThreadPoolExecutor.java:830<span class="token punctuation">)</span>
	at java.util.concurrent.ThreadPoolExecutor.execute<span class="token punctuation">(</span>ThreadPoolExecutor.java:1379<span class="token punctuation">)</span>
	at com.chen.base.thread.ThreadFactoryClient.main<span class="token punctuation">(</span>ThreadFactoryClient.java:56<span class="token punctuation">)</span>
<span class="token assign-left variable">xxxxxxx31891613408362</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>BBBBBBBBBB

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到触发了设置的拒绝策略，任务超出时直接抛出异常</p><h4 id="_3-2-3-几种线程池的实现" tabindex="-1"><a class="header-anchor" href="#_3-2-3-几种线程池的实现" aria-hidden="true">#</a> 3.2.3 几种线程池的实现</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//缓存池，初始化0个线程，使用SynchronousQueue队列每次来了新任务马上起一个新的线程，而不是缓存下来，最大可以起Integer.MAX_VALUE个线程（内存够用前提下）  </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span>
                                      <span class="token number">60L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
                                      <span class="token keyword">new</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//单个线程池，相当于把固定池的线程数设置成1个  public static ExecutorService newSingleThreadExecutor() {</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FinalizableDelegatedExecutorService</span>
            <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                                    <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
                                    <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//固定线程数的线程池，注意他的初始化线程数和最大线程数是一样，一旦任务超过线程数就开始无限缓存，等线程处理完其他任务后再从无界队列中取任务来处理  </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> nThreads<span class="token punctuation">,</span>
                                      <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
                                      <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-3-线程池中任务执行流程" tabindex="-1"><a class="header-anchor" href="#_3-2-3-线程池中任务执行流程" aria-hidden="true">#</a> 3.2.3 线程池中任务执行流程</h4><p><img src="https://img2018.cnblogs.com/blog/940289/201903/940289-20190317152802067-348051138.png" alt=""></p><h3 id="_3-3-线程池中的异常处理" tabindex="-1"><a class="header-anchor" href="#_3-3-线程池中的异常处理" aria-hidden="true">#</a> 3.3 线程池中的异常处理</h3><p>线程池中提交任务的两种方法：<code>submit</code>、<code>execute</code>，submit方法的参数可以是<code>Runnable</code>、<code>Caller</code>，execute的参数类型只有<code>Runnable</code>，submit提交的方法可以获取返回值，要想获取返回值需要传递Caller类型</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//java.util.concurrent.ThreadPoolExecutor#execute</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*
         * Proceed in 3 steps:
         *
         * 1. If fewer than corePoolSize threads are running, try to
         * start a new thread with the given command as its first
         * task.  The call to addWorker atomically checks runState and
         * workerCount, and so prevents false alarms that would add
         * threads when it shouldn&#39;t, by returning false.
         *
         * 2. If a task can be successfully queued, then we still need
         * to double-check whether we should have added a thread
         * (because existing ones died since last checking) or that
         * the pool shut down since entry into this method. So we
         * recheck state and if necessary roll back the enqueuing if
         * stopped, or start a new thread if there are none.
         *
         * 3. If we cannot queue task, then we try to add a new
         * thread.  If it fails, we know we are shut down or saturated
         * and so reject the task.
         */</span>
        <span class="token keyword">int</span> c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">workerCountOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">&lt;</span> corePoolSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">addWorker</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRunning</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> workQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> recheck <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">isRunning</span><span class="token punctuation">(</span>recheck<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">remove</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">workerCountOf</span><span class="token punctuation">(</span>recheck<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token function">addWorker</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">addWorker</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
<span class="token comment">//继承自AbstractExecutorService</span>
<span class="token comment">//java.util.concurrent.AbstractExecutorService#submit(java.util.concurrent.Callable&lt;T&gt;)</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>task <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RunnableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> ftask <span class="token operator">=</span> <span class="token function">newTaskFor</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">execute</span><span class="token punctuation">(</span>ftask<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ftask<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//继承自AbstractExecutorService</span>
<span class="token comment">//java.util.concurrent.AbstractExecutorService#submit(java.lang.Runnable)</span>
    <span class="token keyword">public</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>task <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RunnableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> ftask <span class="token operator">=</span> <span class="token function">newTaskFor</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">execute</span><span class="token punctuation">(</span>ftask<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ftask<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-1-使用execute时的异常处理" tabindex="-1"><a class="header-anchor" href="#_3-2-1-使用execute时的异常处理" aria-hidden="true">#</a> 3.2.1 使用execute时的异常处理</h4><p>使用execute提交有异常会正常的抛出，当然也可以自定义异常处理器</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThreadFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ThreadFactory</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">&quot;xxxxxxx&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">setUncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;enter into uncaughtException&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;异常信息:&quot;</span><span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> thread<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">100L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MyThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;enter into submit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;我是一个异常信息。。。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;eee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-2-使用submit时的异常处理" tabindex="-1"><a class="header-anchor" href="#_3-2-2-使用submit时的异常处理" aria-hidden="true">#</a> 3.2.2 使用submit时的异常处理</h4><p>submit会返回一个future,需要主动调用这个future的get方法才会触发异常，如果正常执行传递的runnable类型，则返回null,如果是caller类型参数，会返回相应的值</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThreadFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ThreadFactory</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token string">&quot;xxxxxxx&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">setUncaughtExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;enter into uncaughtException&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;异常信息:&quot;</span><span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> thread<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">100L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MyThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token class-name">Future</span> future<span class="token operator">=</span> threadPoolExecutor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;enter into submit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;我是一个异常信息。。。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;eee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-补充说明" tabindex="-1"><a class="header-anchor" href="#_3-4-补充说明" aria-hidden="true">#</a> 3.4 补充说明</h3><p>关于<code>ThreadPoolExecutor</code>的构造方法中的<code>keepAliveTime</code>说明</p><p>[在前面有说明](#3.2.1 构造方法)，在举例罗嗦一边，代码如下，第一个任务进来，直接启动一个线程，也就是corePoolSize设置的那个线程，第二个任务进来直接缓存到<code>LinkedBlockingQueue</code>中，第三个线程进来，发现<code>LinkedBlockingQueue</code>已经满了（因为示例代码缓存长度是1）直接再启动一个线程，这个占用的是maxmumPoolSize设置的线程，第4个、第5个任务进来和第三个一样，再各自启动一个线程，此时池中一共有4个线程了，再有任务进来就会触发拒绝策略，此处不做描述了。当池子中的数量超过了corePoolSize设置的数量是，这个keepAliveTime参数就起作用了，假如任务都执行完了，4个线程都是空闲（idle），则先空闲满keepAliveTime这么长时间的线程就会被回收，最后剩下corePoolSize个时不再回收，这corePoolSize个线程一直缓存在池子中。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
 <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MyThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>测试代码如下，我设置<code>keepAliveTime</code>是10s,</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MyThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Future</span> future <span class="token operator">=</span> threadPoolExecutor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//一定不要打开future.get()，这个方法会触发同步操作，导致永远只有一个线程在工作</span>
<span class="token comment">//                future.get();</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试结果，发现刚开始有4个线程，</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220329212937714.png" alt="image-20220329212937714"></p><p>过了10s后，发现只有一个了，符合我们的预期</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220329213033143.png" alt="image-20220329213033143"></p><p><code>java.util.concurrent.Future#get()</code>有说明，get是会一直等到此线程结束</p><p><img src="https://afatpig.oss-cn-chengdu.aliyuncs.com/blog/image-20220329213244994.png" alt="image-20220329213244994"></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/ChenSino/ChenSino.github.io/edit/dev/docs/java/advance/ThreadPool.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/8/1 13:56:59</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 462488588@qq.com">chenkun</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/java/advance/ProxyInJava.html" class="nav-link prev" aria-label="彻底理清Java中的几种代理"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><FontIcon></FontIcon>彻底理清Java中的几种代理</div></a><a href="/java/advance/ParentDelegationClassLoader.html" class="nav-link next" aria-label="证明SPI打破双亲委派模式"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">证明SPI打破双亲委派模式<FontIcon></FontIcon></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">除了自渡，其他人爱莫能助</div><div class="copyright">Copyright © 2022 chenkun</div></footer><!--]--></div><!--]--><!--]--></div>
    <script type="module" src="/assets/app.6dfcc30b.js" defer></script>
  </body>
</html>
